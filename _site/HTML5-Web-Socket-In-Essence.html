<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>HTML5 Web Socket in Essence - Wayne’s Geek Life</title>
<meta name="description" content="HTML5 WebSocket defines a bi-directional, full-duplex communication channel operates through a single TCP connection, this article discusses its fantastic performance, the WebSocket protocol principle and its handshake mechanism, and develop a WebSocket application in action (Team Poker).&lt;/embed&gt;Embeded youku video link because Youtube is outside of the largest &quot;intranet&quot; in the entire universe!!Table of ContentIntroductionBackgroundWebSocket In EssenceExperimental DemosBrowser SupportWebSocket JavaScript APIDevelop WebSocket In Action - Team PokerOpen IssuesConclusionReferences &amp; Resources&nbsp;IntroductionHTML5 WebSocket&nbsp;defines a bi-directional, full-duplex communication channel that operates through a single TCP socket over the Web, it provides efficient, low-latency and low cost connection between web client and server, based on WebSocket, developers can build&nbsp;scalable,&nbsp;real-time&nbsp;web applications in the future. Section below is the official definition of WebSocket copied from&nbsp;IETF WebSocket protocol&nbsp;page:&nbsp;The WebSocket protocol enables two-way communication between a user agent running untrusted code running in a controlled environment to a remote host that has opted-in to communications from that code. &nbsp;The security model used for this is the Origin-based security model commonly used by Web browsers. &nbsp;The protocol consists of an initial handshake followed by basic message framing, layered over TCP. &nbsp;The goal of this technology is to provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections (e.g. using XMLHttpRequest or &lt;iframe&gt;s and long polling).This article is trying to go through WebSocket basic concept, the problems it is going to solve, explain it in essence,&nbsp;watch some experimental Demos, develop a simple WebSocket&nbsp;application in action (Team Poker), and describe current open issues of WebSocket. I sincerely hope it will be&nbsp;systematically,&nbsp;easy to understand,&nbsp;from surface to deep&nbsp;so that eventually readers would not only learn what WebSocket is from high level but also&nbsp;understand it in depth!&nbsp;Any thoughts, suggestions or criticism&nbsp;you may have after reading this article will help me to improve in the future, i would appreciate it if you could leave a comment.BackgroundIn traditional web applications, in order to achieve some real-time interaction with server, developers had to employ several tricky ways such as Ajax polling,&nbsp;Comet&nbsp;(A.K.A Ajax push,&nbsp;Full Duplex Ajax,&nbsp;HTTP Streaming, etc.),&nbsp;those technologies either periodically fire HTTP requests to server or hold the HTTP connection with server for a long time, which&nbsp;&quot;contain lots of additional, unnecessary header data and introduce latency&quot; and resulted in &quot;an outrageously high price tag&quot;.&nbsp;websocket.org explained the problems exhaustively, compared the performance&nbsp;of Ajax polling and WebSocket in detail, built up two simple web pages, one periodically communicated with server using traditional HTTP and the other used HTML5 WebSocket, in the testing each HTTP&nbsp;request/response header is approximate 871 byte, while data length of WebSocket connection is much shorter: 2 bytes after connection established, as the transfer count getting larger, the result will be:Traditional HTTP Request&nbsp;Use case A: 1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)Use case B: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)Use case C: 100,000 clients polling every 1 second: Network throughput is (871 x 100,000) = 87,100,000 bytes = 696,800,000 bits per second (665 Mbps)HTML5 WebSocketUse case A: 1,000 clients receive 1 message per second: Network throughput is (2 x 1,000) = 2,000 bytes = 16,000 bits per second (0.015 Mbps)Use case B: 10,000 clients receive 1 message per second: Network throughput is (2 x 10,000) = 20,000 bytes = 160,000 bits per second (0.153 Kbps)Use case C: 100,000 clients receive 1 message per second: Network throughput is (2 x 100,000) = 200,000 bytes = 1,600,000 bits per second (1.526 Kbps)Finally a more readable diagram:&nbsp;&quot;HTML5 Web Sockets can provide a 500:1 or &mdash; depending on the size of the HTTP headers &mdash; even a 1000:1 reduction in unnecessary HTTP header traffic and 3:1 reduction in latency&quot;. &nbsp;--WebSocket.orgWebSocket In EssenceThe motivation of creating WebSocket is to replace polling and long polling(Comet), and endow HTML5 web application the ability of real-time communication. Browser based web application can fire WebSocket connection request through JavaScript API, and then transfer data with server over only one TCP connection.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Wayne's Geek Life">
<meta property="og:title" content="HTML5 Web Socket in Essence">
<meta property="og:url" content="https://wayneye.me/HTML5-Web-Socket-In-Essence">


  <meta property="og:description" content="HTML5 WebSocket defines a bi-directional, full-duplex communication channel operates through a single TCP connection, this article discusses its fantastic performance, the WebSocket protocol principle and its handshake mechanism, and develop a WebSocket application in action (Team Poker).&lt;/embed&gt;Embeded youku video link because Youtube is outside of the largest &quot;intranet&quot; in the entire universe!!Table of ContentIntroductionBackgroundWebSocket In EssenceExperimental DemosBrowser SupportWebSocket JavaScript APIDevelop WebSocket In Action - Team PokerOpen IssuesConclusionReferences &amp; Resources&nbsp;IntroductionHTML5 WebSocket&nbsp;defines a bi-directional, full-duplex communication channel that operates through a single TCP socket over the Web, it provides efficient, low-latency and low cost connection between web client and server, based on WebSocket, developers can build&nbsp;scalable,&nbsp;real-time&nbsp;web applications in the future. Section below is the official definition of WebSocket copied from&nbsp;IETF WebSocket protocol&nbsp;page:&nbsp;The WebSocket protocol enables two-way communication between a user agent running untrusted code running in a controlled environment to a remote host that has opted-in to communications from that code. &nbsp;The security model used for this is the Origin-based security model commonly used by Web browsers. &nbsp;The protocol consists of an initial handshake followed by basic message framing, layered over TCP. &nbsp;The goal of this technology is to provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections (e.g. using XMLHttpRequest or &lt;iframe&gt;s and long polling).This article is trying to go through WebSocket basic concept, the problems it is going to solve, explain it in essence,&nbsp;watch some experimental Demos, develop a simple WebSocket&nbsp;application in action (Team Poker), and describe current open issues of WebSocket. I sincerely hope it will be&nbsp;systematically,&nbsp;easy to understand,&nbsp;from surface to deep&nbsp;so that eventually readers would not only learn what WebSocket is from high level but also&nbsp;understand it in depth!&nbsp;Any thoughts, suggestions or criticism&nbsp;you may have after reading this article will help me to improve in the future, i would appreciate it if you could leave a comment.BackgroundIn traditional web applications, in order to achieve some real-time interaction with server, developers had to employ several tricky ways such as Ajax polling,&nbsp;Comet&nbsp;(A.K.A Ajax push,&nbsp;Full Duplex Ajax,&nbsp;HTTP Streaming, etc.),&nbsp;those technologies either periodically fire HTTP requests to server or hold the HTTP connection with server for a long time, which&nbsp;&quot;contain lots of additional, unnecessary header data and introduce latency&quot; and resulted in &quot;an outrageously high price tag&quot;.&nbsp;websocket.org explained the problems exhaustively, compared the performance&nbsp;of Ajax polling and WebSocket in detail, built up two simple web pages, one periodically communicated with server using traditional HTTP and the other used HTML5 WebSocket, in the testing each HTTP&nbsp;request/response header is approximate 871 byte, while data length of WebSocket connection is much shorter: 2 bytes after connection established, as the transfer count getting larger, the result will be:Traditional HTTP Request&nbsp;Use case A: 1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)Use case B: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)Use case C: 100,000 clients polling every 1 second: Network throughput is (871 x 100,000) = 87,100,000 bytes = 696,800,000 bits per second (665 Mbps)HTML5 WebSocketUse case A: 1,000 clients receive 1 message per second: Network throughput is (2 x 1,000) = 2,000 bytes = 16,000 bits per second (0.015 Mbps)Use case B: 10,000 clients receive 1 message per second: Network throughput is (2 x 10,000) = 20,000 bytes = 160,000 bits per second (0.153 Kbps)Use case C: 100,000 clients receive 1 message per second: Network throughput is (2 x 100,000) = 200,000 bytes = 1,600,000 bits per second (1.526 Kbps)Finally a more readable diagram:&nbsp;&quot;HTML5 Web Sockets can provide a 500:1 or &mdash; depending on the size of the HTTP headers &mdash; even a 1000:1 reduction in unnecessary HTTP header traffic and 3:1 reduction in latency&quot;. &nbsp;--WebSocket.orgWebSocket In EssenceThe motivation of creating WebSocket is to replace polling and long polling(Comet), and endow HTML5 web application the ability of real-time communication. Browser based web application can fire WebSocket connection request through JavaScript API, and then transfer data with server over only one TCP connection.">





  <meta name="twitter:site" content="@wayneye">
  <meta name="twitter:title" content="HTML5 Web Socket in Essence">
  <meta name="twitter:description" content="HTML5 WebSocket defines a bi-directional, full-duplex communication channel operates through a single TCP connection, this article discusses its fantastic performance, the WebSocket protocol principle and its handshake mechanism, and develop a WebSocket application in action (Team Poker).&lt;/embed&gt;Embeded youku video link because Youtube is outside of the largest &quot;intranet&quot; in the entire universe!!Table of ContentIntroductionBackgroundWebSocket In EssenceExperimental DemosBrowser SupportWebSocket JavaScript APIDevelop WebSocket In Action - Team PokerOpen IssuesConclusionReferences &amp; Resources&nbsp;IntroductionHTML5 WebSocket&nbsp;defines a bi-directional, full-duplex communication channel that operates through a single TCP socket over the Web, it provides efficient, low-latency and low cost connection between web client and server, based on WebSocket, developers can build&nbsp;scalable,&nbsp;real-time&nbsp;web applications in the future. Section below is the official definition of WebSocket copied from&nbsp;IETF WebSocket protocol&nbsp;page:&nbsp;The WebSocket protocol enables two-way communication between a user agent running untrusted code running in a controlled environment to a remote host that has opted-in to communications from that code. &nbsp;The security model used for this is the Origin-based security model commonly used by Web browsers. &nbsp;The protocol consists of an initial handshake followed by basic message framing, layered over TCP. &nbsp;The goal of this technology is to provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections (e.g. using XMLHttpRequest or &lt;iframe&gt;s and long polling).This article is trying to go through WebSocket basic concept, the problems it is going to solve, explain it in essence,&nbsp;watch some experimental Demos, develop a simple WebSocket&nbsp;application in action (Team Poker), and describe current open issues of WebSocket. I sincerely hope it will be&nbsp;systematically,&nbsp;easy to understand,&nbsp;from surface to deep&nbsp;so that eventually readers would not only learn what WebSocket is from high level but also&nbsp;understand it in depth!&nbsp;Any thoughts, suggestions or criticism&nbsp;you may have after reading this article will help me to improve in the future, i would appreciate it if you could leave a comment.BackgroundIn traditional web applications, in order to achieve some real-time interaction with server, developers had to employ several tricky ways such as Ajax polling,&nbsp;Comet&nbsp;(A.K.A Ajax push,&nbsp;Full Duplex Ajax,&nbsp;HTTP Streaming, etc.),&nbsp;those technologies either periodically fire HTTP requests to server or hold the HTTP connection with server for a long time, which&nbsp;&quot;contain lots of additional, unnecessary header data and introduce latency&quot; and resulted in &quot;an outrageously high price tag&quot;.&nbsp;websocket.org explained the problems exhaustively, compared the performance&nbsp;of Ajax polling and WebSocket in detail, built up two simple web pages, one periodically communicated with server using traditional HTTP and the other used HTML5 WebSocket, in the testing each HTTP&nbsp;request/response header is approximate 871 byte, while data length of WebSocket connection is much shorter: 2 bytes after connection established, as the transfer count getting larger, the result will be:Traditional HTTP Request&nbsp;Use case A: 1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)Use case B: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)Use case C: 100,000 clients polling every 1 second: Network throughput is (871 x 100,000) = 87,100,000 bytes = 696,800,000 bits per second (665 Mbps)HTML5 WebSocketUse case A: 1,000 clients receive 1 message per second: Network throughput is (2 x 1,000) = 2,000 bytes = 16,000 bits per second (0.015 Mbps)Use case B: 10,000 clients receive 1 message per second: Network throughput is (2 x 10,000) = 20,000 bytes = 160,000 bits per second (0.153 Kbps)Use case C: 100,000 clients receive 1 message per second: Network throughput is (2 x 100,000) = 200,000 bytes = 1,600,000 bits per second (1.526 Kbps)Finally a more readable diagram:&nbsp;&quot;HTML5 Web Sockets can provide a 500:1 or &mdash; depending on the size of the HTTP headers &mdash; even a 1000:1 reduction in unnecessary HTTP header traffic and 3:1 reduction in latency&quot;. &nbsp;--WebSocket.orgWebSocket In EssenceThe motivation of creating WebSocket is to replace polling and long polling(Comet), and endow HTML5 web application the ability of real-time communication. Browser based web application can fire WebSocket connection request through JavaScript API, and then transfer data with server over only one TCP connection.">
  <meta name="twitter:url" content="https://wayneye.me/HTML5-Web-Socket-In-Essence">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2011-06-10T00:00:00-07:00">






<link rel="canonical" href="https://wayneye.me/HTML5-Web-Socket-In-Essence">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Wayne's Geek Life Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">Wayne's Geek Life</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/search/">Search</a>
            </li>
<li class="masthead__menu-item">
              <a href="/gallery/">Gallery</a>
            </li>
<li class="masthead__menu-item">
              <a href="/vlog/">Vlog</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/me.jpg" alt="Wayne Ye" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Wayne Ye</h3>
    
    
      <p class="author__bio" itemprop="description">
        Whatever is worth doing is worth doing well!
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco</span>
        </li>
      

      
        
          
            <li><a href="mailto:hi@wayneye.me" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://wayneye.me" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/WayneYe/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://twitter.com/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="HTML5 Web Socket in Essence">
    <meta itemprop="description" content='HTML5 WebSocket defines a bi-directional, full-duplex communication channel operates through a single TCP connection, this article discusses its fantastic performance, the WebSocket protocol principle and its handshake mechanism, and develop a WebSocket application in action (Team Poker).&lt;/embed&gt;Embeded youku video link because Youtube is outside of the largest "intranet" in the entire universe!!Table of ContentIntroductionBackgroundWebSocket In EssenceExperimental DemosBrowser SupportWebSocket JavaScript APIDevelop WebSocket In Action - Team PokerOpen IssuesConclusionReferences &amp; Resources IntroductionHTML5 WebSocket defines a bi-directional, full-duplex communication channel that operates through a single TCP socket over the Web, it provides efficient, low-latency and low cost connection between web client and server, based on WebSocket, developers can build scalable, real-time web applications in the future. Section below is the official definition of WebSocket copied from IETF WebSocket protocol page: The WebSocket protocol enables two-way communication between a user agent running untrusted code running in a controlled environment to a remote host that has opted-in to communications from that code.  The security model used for this is the Origin-based security model commonly used by Web browsers.  The protocol consists of an initial handshake followed by basic message framing, layered over TCP.  The goal of this technology is to provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections (e.g. using XMLHttpRequest or &lt;iframe&gt;s and long polling).This article is trying to go through WebSocket basic concept, the problems it is going to solve, explain it in essence, watch some experimental Demos, develop a simple WebSocket application in action (Team Poker), and describe current open issues of WebSocket. I sincerely hope it will be systematically, easy to understand, from surface to deep so that eventually readers would not only learn what WebSocket is from high level but also understand it in depth! Any thoughts, suggestions or criticism you may have after reading this article will help me to improve in the future, i would appreciate it if you could leave a comment.BackgroundIn traditional web applications, in order to achieve some real-time interaction with server, developers had to employ several tricky ways such as Ajax polling, Comet (A.K.A Ajax push, Full Duplex Ajax, HTTP Streaming, etc.), those technologies either periodically fire HTTP requests to server or hold the HTTP connection with server for a long time, which "contain lots of additional, unnecessary header data and introduce latency" and resulted in "an outrageously high price tag". websocket.org explained the problems exhaustively, compared the performance of Ajax polling and WebSocket in detail, built up two simple web pages, one periodically communicated with server using traditional HTTP and the other used HTML5 WebSocket, in the testing each HTTP request/response header is approximate 871 byte, while data length of WebSocket connection is much shorter: 2 bytes after connection established, as the transfer count getting larger, the result will be:Traditional HTTP Request Use case A: 1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)Use case B: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)Use case C: 100,000 clients polling every 1 second: Network throughput is (871 x 100,000) = 87,100,000 bytes = 696,800,000 bits per second (665 Mbps)HTML5 WebSocketUse case A: 1,000 clients receive 1 message per second: Network throughput is (2 x 1,000) = 2,000 bytes = 16,000 bits per second (0.015 Mbps)Use case B: 10,000 clients receive 1 message per second: Network throughput is (2 x 10,000) = 20,000 bytes = 160,000 bits per second (0.153 Kbps)Use case C: 100,000 clients receive 1 message per second: Network throughput is (2 x 100,000) = 200,000 bytes = 1,600,000 bits per second (1.526 Kbps)Finally a more readable diagram: "HTML5 Web Sockets can provide a 500:1 or — depending on the size of the HTTP headers — even a 1000:1 reduction in unnecessary HTTP header traffic and 3:1 reduction in latency".  --WebSocket.orgWebSocket In EssenceThe motivation of creating WebSocket is to replace polling and long polling(Comet), and endow HTML5 web application the ability of real-time communication. Browser based web application can fire WebSocket connection request through JavaScript API, and then transfer data with server over only one TCP connection.'>
    <meta itemprop="datePublished" content="June 10, 2011">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">HTML5 Web Socket in Essence
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-cog"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#">Table of Content</a></li>
  <li><a href="#Introduction">Introduction</a></li>
  <li><a href="#Background">Background</a></li>
  <li><a href="#WebSocketInEssence">WebSocket In Essence</a></li>
  <li><a href="#ExperimentalDemos">Experimental Demos</a></li>
  <li><a href="#BrowserSupport">Browser/Server Support</a></li>
  <li><a href="#WebSocketJavaScriptAPI">WebSocket JavaScript API</a></li>
  <li><a href="#DevelopWebSocketInAction">Develop WebSocket In Action - Team Poker Demo </a></li>
</ul>
            </nav>
          </aside>
        
        <blockquote>
HTML5 WebSocket defines a bi-directional, full-duplex communication channel operates through a single TCP connection, this article discusses its fantastic performance, the WebSocket protocol principle and its handshake mechanism, and develop a WebSocket application in action (Team Poker).
</blockquote>
<p style="text-align:center">
<embed src="http://player.youku.com/player.php/sid/XMjc2ODM2NjU2/v.swf" quality="high" width="480" height="400" align="middle" allowscriptaccess="sameDomain" type="application/x-shockwave-flash"></embed>
<br>
<strong style="color:red">Embeded youku video link because Youtube is outside of the largest "intranet" in the entire universe!!</strong></p>
<h3>Table of Content</h3>
<ol>
<li><a href="#Introduction">Introduction</a></li>
<li><a href="#Background">Background</a></li>
<li><a href="#WebSocketInEssence">WebSocket In Essence</a></li>
<li><a href="#ExperimentalDemos">Experimental Demos</a></li>
<li><a href="#BrowserSupport">Browser Support</a></li>
<li><a href="#WebSocketJavaScriptAPI">WebSocket JavaScript API</a></li>
<li><a href="#DevelopWebSocketInAction">Develop WebSocket In Action - Team Poker</a></li>
<li><a href="#OpenIssues">Open Issues</a></li>
<li><a href="#Conclusion">Conclusion</a></li>
<li>
<a href="#References">References &amp; Resources</a> </li>
</ol>
<h3 id="Introduction">Introduction</h3>
<p><a title="HTML5 Web Socket" href="http://www.whatwg.org/specs/web-apps/current-work/complete/network.html#network" target="_blank">HTML5 WebSocket</a> defines a bi-directional, full-duplex communication channel that operates through a single TCP socket over the Web, it provides efficient, low-latency and low cost connection between web client and server, based on WebSocket, developers can build <strong>scalable</strong>, <strong>real-time</strong> web applications in the future. Section below is the official definition of WebSocket copied from <a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-08" target="_blank">IETF WebSocket protocol</a> page: </p>
<blockquote>
<p>The WebSocket protocol enables two-way communication between a user agent running untrusted code running in a controlled environment to a remote host that has opted-in to communications from that code.  The security model used for this is the Origin-based security model commonly used by Web browsers.  The protocol consists of an initial handshake followed by basic message framing, layered over TCP.  The goal of this technology is to provide a mechanism for browser-based applications that need two-way communication with servers that does not rely on opening multiple HTTP connections (e.g. using XMLHttpRequest or &lt;iframe&gt;s and long polling).</p>
</blockquote>
<p>This article is trying to go through WebSocket basic concept, the problems it is going to solve, explain it in essence, watch some experimental Demos, develop a simple WebSocket application in action (Team Poker), and describe current open issues of WebSocket. I sincerely hope it will be <strong>systematically</strong>, <strong>easy to understand</strong>, <strong>from surface to deep </strong>so that eventually readers would not only learn what WebSocket is from high level but also <strong>understand it in depth!</strong> Any thoughts, suggestions or criticism you may have after reading this article will help me to improve in the future, i would appreciate it if you could leave a comment.</p>
<h3 id="Background">Background</h3>
<p>In traditional web applications, in order to achieve some real-time interaction with server, developers had to employ several tricky ways such as <a href="http://plugins.jquery.com/plugin-tags/polling">Ajax polling</a>, <a title="Comet" href="http://en.wikipedia.org/wiki/Comet_(programming)">Comet</a> (A.K.A <a href="http://en.wikipedia.org/wiki/Ajax_Push">Ajax push</a>, Full Duplex Ajax, HTTP Streaming, etc.), those technologies either periodically fire HTTP requests to server or hold the HTTP connection with server for a long time, which "<strong>contain lots of additional, unnecessary header data and introduce latency</strong>" and resulted in "<strong>an outrageously high price tag</strong>". <a href="http://websocket.org/quantum.html">websocket.org</a> explained the problems exhaustively, compared the performance of Ajax polling and WebSocket in detail, built up two simple web pages, one periodically communicated with server using traditional HTTP and the other used HTML5 WebSocket, in the testing each HTTP request/response header is approximate <strong>871 byte</strong>, while data length of WebSocket connection is much shorter: <strong>2 bytes</strong> after connection established, as the transfer count getting larger, the result will be:</p>
<blockquote>
<p><strong>Traditional HTTP Request </strong></p>
<ul>
<li>
<p class="bodytext"><strong>Use case A</strong>: 1,000 clients polling every second: Network throughput is (871 x 1,000) = 871,000 bytes = 6,968,000 bits per second (6.6 Mbps)</p>
</li>
<li>
<p class="bodytext"><strong>Use case B</strong>: 10,000 clients polling every second: Network throughput is (871 x 10,000) = 8,710,000 bytes = 69,680,000 bits per second (66 Mbps)</p>
</li>
<li>
<p class="bodytext"><strong>Use case C</strong>: 100,000 clients polling every 1 second: Network throughput is (871 x 100,000) = 87,100,000 bytes = 696,800,000 bits per second (665 Mbps)</p>
</li>
</ul>
<p><strong>HTML5 WebSocket</strong></p>
<ul>
<li>
<p class="bodytext"><strong>Use case A</strong>: 1,000 clients receive 1 message per second: Network throughput is (2 x 1,000) = 2,000 bytes = 16,000 bits per second (0.015 Mbps)</p>
</li>
<li>
<p class="bodytext"><strong>Use case B</strong>: 10,000 clients receive 1 message per second: Network throughput is (2 x 10,000) = 20,000 bytes = 160,000 bits per second (0.153 Kbps)</p>
</li>
<li>
<p class="bodytext"><strong>Use case C</strong>: 100,000 clients receive 1 message per second: Network throughput is (2 x 100,000) = 200,000 bytes = 1,600,000 bits per second (1.526 Kbps)</p>
</li>
</ul>
</blockquote>
<p>Finally a more readable diagram:</p>
<p><img title="Polling VS WebSocket" src="http://websocket.org/img/poll-ws-compare.gif" alt="Polling VS WebSocket" width="503" height="360"></p>
<blockquote>
<p> "HTML5 Web Sockets can provide a 500:1 or — depending on the size of the HTTP headers — even a 1000:1 reduction in unnecessary HTTP header traffic and 3:1 reduction in latency".  --<a href="http://websocket.org">WebSocket.org</a></p>
</blockquote>
<h3 id="WebSocketInEssence">WebSocket In Essence</h3>
<p>The motivation of creating WebSocket is to replace polling and long polling(Comet), and endow HTML5 web application the ability of real-time communication. Browser based web application can fire WebSocket connection request through JavaScript API, and then transfer data with server <strong>over only one TCP connection</strong>.</p>
<!--more-->
<p>This is achieved by the new protocol - The <strong>WebSocket Protocol</strong>, which is essentially an <strong>independent TCP-based protocol.</strong> To establish a WebSocket connection client/browser forms an HTTP request with "<strong>Upgrade: WebSocket</strong>" header which indicates a protocol upgrade request, and the handshake key(s) will be interpreted by HTTP servers and handshake response will be returned (the detailed handshake mechanism will be described below), afterwards the connection is established (figuratively speaking, the 'sockets' have been plugged in at both client and server ends), both sides can transfer/receive data <strong>independently</strong>, no more redundant header information, and the connection <strong>won't be closed until one side sends close signal</strong>, that's why WebSocket is <strong>bidirectional </strong>and <strong>full duplex</strong>, in additional, comparing the request/response paradigm of HTTP, WebSocket layers a framing mechanism on top on TCP, each data frame is minimally just 2 bytes.  </p>
<p>Now it is time for us to delve deep into this protocol, let's start with WebSocket version <strong><a href="https://tools.ietf.org/html/rfc6455">RFC6455 - The WebSocket Protocol</a></strong> which is now <a href="https://www.internetadvisor.com/best-internet-browser?msID=f3fcb92f-191b-4cb1-bdf0-fe8e9e51514e" target="_blank">support in all popular browsers</a> and many WebSocket servers (please refer to <a href="#BrowserSupport">Browser/Server Support</a> section below for details). A typical WebSocket request/response example is shown below:</p>
<p>WebSocket is not only designed for browser/server communication, client application can also use it.  WebSocket protocol is <a href="https://www.internetadvisor.com/best-internet-browser?msID=f3fcb92f-191b-4cb1-bdf0-fe8e9e51514e" target="_blank">support in all popular browsers</a>.</p>
<p>The entire process could be described as: the client raise a "special" HTTP request which request "Upgrade" connecting protocol to "WebSocket", on domain "example.com" with path "/demo", with three "<strong>handshake</strong>" fields: <strong>Sec-WebSocket-Key1</strong>, <strong>Sec-WebSocket-Key2</strong> and <strong>8 bytes</strong> ({^n:ds[4U}) after the fields are random tokens which the WebSocket server uses to construct a <strong>16-byte security hash</strong> at the end of its handshake to prove that it has read the client's handshake.</p>
<p>WebSocket protocol is currently published and is "PROPOSED STANDARD", at the time I wrote this article, the latest WebSocket version is "<strong><a href="https://tools.ietf.org/html/rfc6455">RFC6455 - The WebSocket Protocol</a></strong>" lasted updated by<strong> Ian Fette on Dec, 2011</strong>.</p>
<p>WebSocket request/response in the latest <strong><a href="https://tools.ietf.org/html/rfc6455">RFC6455 - The WebSocket Protocol</a></strong></p>
<blockquote>
<strong>Request</strong><br>GET /demo HTTP/1.1<br>Host: example.com<br>Upgrade: websocket<br>Connection: Upgrade<br>Sec-WebSocket-Key: V2ViU29ja2V0IHJvY2tzIQ==<br>Sec-WebSocket-Origin: http://example.com<br>Sec-WebSocket-Protocol: chat, superchat<br>Sec-WebSocket-Version: 13<br><br><strong>Response</strong><br>HTTP/1.1 101 Switching Protocols<br>Upgrade: websocket<br>Connection: Upgrade<br>Sec-WebSocket-Accept: VAuGgaNDB/reVQpGfDF8KXeZx5o=<br>Sec-WebSocket-Protocol: chat</blockquote>
<p>The <strong>Sec-WebSocket-Key</strong> is a base64 encoded randomly generated 16-byte value, in the case above it is "<strong>WebSocket rocks!</strong>", the server reads the key, concats with a magic GUID "258EAFA5-E914-47DA-95CA-C5AB0DC85B11", to "V2ViU29ja2V0IHJvY2tzIQ==258EAFA5-E914-47DA-95CA-C5AB0DC85B11", then compute its SHA1 hash, get result "540b8681a34307fade550a467c317c297799c79a", finally based64 encodes the hash and append the value to header "<strong>Sec-WebSocket-Accept</strong>".</p>
<p>I've written C# code below to demonstrate how to compute the Sec-WebSocket-Accept conforming to <strong>draft-ietf-hybi-thewebsocketprotocol-08</strong>: </p>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #7f9f7f;">/// <span style="color: #c0c0c0;">&lt;summary&gt;</span></span><br> <span style="color: #7f9f7f;">/// Computes server security hash for HTML5 WebSocket, handshake mechanism </span><br> <span style="color: #7f9f7f;">/// based on draft-ietf-hybi-thewebsocketprotocol-08</span><br> <span style="color: #7f9f7f;">/// <span style="color: #cc99ff;"><a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-08#page-27"><span style="color: #cc99ff;">http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-08#page-27</span></a></span></span><br> <span style="color: #7f9f7f;">/// <span style="color: #c0c0c0;">&lt;/summary&gt;</span></span><br> <span style="color: #7f9f7f;">/// <span style="color: #c0c0c0;">&lt;param name="secWebSocketKey"&gt;</span>The handshake key "Sec-WebSocket-Key" from client.<span style="color: #c0c0c0;">&lt;/param&gt;</span></span><br> <span style="color: #7f9f7f;">/// <span style="color: #c0c0c0;">&lt;returns&gt;</span>The computed security hash to fill "Sec-WebSocket-Accept" header.<span style="color: #c0c0c0;">&lt;/returns&gt;</span></span><br> <span style="color: #e3ceab;">public</span> <span style="color: #e3ceab;">static</span> <span style="color: #dcdccc;">String</span> <span style="color: #efef8f;">ComputeWebSocketHandshakeSecurityHash08</span>(<span style="color: #dcdccc;">String</span> <span style="color: #dcdccc;">secWebSocketKey</span>)<br> <span style="color: #dcdccc;">{</span><br>     <span style="color: #e3ceab;">const</span> <span style="color: #dcdccc;">String</span> <span style="color: #dcdccc;">MagicKEY</span> <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">"258EAFA5-E914-47DA-95CA-C5AB0DC85B11"</span>;<br>     <span style="color: #dcdccc;">String</span> <span style="color: #dcdccc;">secWebSocketAccept</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">String</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">Empty</span>;<br> <br>     <span style="color: #7f9f7f;">// 1. Combine the request Sec-WebSocket-Key with magic key.</span><br>     <span style="color: #dcdccc;">String</span> <span style="color: #dcdccc;">ret</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">secWebSocketKey</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">MagicKEY</span>;<br> <br>     <span style="color: #7f9f7f;">// 2. Compute the SHA1 hash</span><br>     <span style="color: #dcdccc;">SHA1</span> <span style="color: #dcdccc;">sha</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">new</span> <span style="color: #dcdccc;">SHA1CryptoServiceProvider</span>(); <br>     <span style="color: #dfdfbf; font-weight: bold;">byte</span><span style="color: #dcdccc;">[]</span> <span style="color: #dcdccc;">sha1Hash</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">sha</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ComputeHash</span>(<span style="color: #dcdccc;">Encoding</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">UTF8</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">GetBytes</span>(<span style="color: #dcdccc;">ret</span>));<br> <br>     <span style="color: #7f9f7f;">// 3. Base64 encode the hash</span><br>     <span style="color: #dcdccc;">secWebSocketAccept</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">Convert</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ToBase64String</span>(<span style="color: #dcdccc;">sha1Hash</span>);<br> <br>     <span style="color: #e3ceab;">return</span> <span style="color: #dcdccc;">secWebSocketAccept</span>;<br> <span style="color: #dcdccc;">}</span></pre>
<p>Unit test code:</p>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #dcdccc;">String</span> <span style="color: #dcdccc;">secWebSocketKey</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">Convert</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ToBase64String</span>(<span style="color: #dcdccc;">Encoding</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">UTF8</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">GetBytes</span>(<span style="color: #cc9393;">"WebSocket rocks!"</span>));<br> <span style="color: #dcdccc;">Console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WriteLine</span>(<span style="color: #cc9393;">"Sec-WebSocket-Key: {0}"</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">secWebSocketKey</span>);<br> <br> <span style="color: #dcdccc;">String</span> <span style="color: #dcdccc;">secWebSocketAccept</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">ComputeWebSocketHandshakeSecurityHash08</span>(<span style="color: #dcdccc;">secWebSocketKey</span>);<br> <span style="color: #dcdccc;">Console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WriteLine</span>(<span style="color: #cc9393;">"Sec-WebSocket-Accept: "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">secWebSocketAccept</span>);</pre>
<p>We would see the result by running code above:</p>
<pre>Sec-WebSocket-Key: V2ViU29ja2V0IHJvY2tzIQ==<br>Sec-WebSocket-Accept: VAuGgaNDB/reVQpGfDF8KXeZx5o=</pre>
<h3 id="ExperimentalDemos">Experimental Demos</h3>
<p>So far there are already many experimental WebSocket Demos built based on RFC6455 - The WebSocket Protocol.<br><br><a href="http://rumpetroll.com/" target="_blank">http://rumpetroll.com/</a> <br>Play a tadpole in canvas and can chat with other tadpoles, tadpoles location and char messages could be seen by everyone in real-time. <br><br><a href="http://html5labs.interoperabilitybridges.com/prototypes/websockets/websockets/info">http://html5labs.interoperabilitybridges.com/prototypes/websockets/websockets/info</a> <br>WebSocket Demos in Microsoft HTML5 Labs<br><br> <a href="http://html5demos.com/web-socket">http://html5demos.com/web-socket<br></a>A very simple "Chat room" demo using WebSocket.<br> <br> <a href="http://kaazing.me/">http://kaazing.me/<br></a>Refresh stock, weather, news and twits in real-time powered by Kaazing's real-time message delivery network solution.<br> <br><a href="http://mrdoob.com/projects/multiuserpad/">Mr. Doob's Multiuser Sketchpad<br></a>In this multi-user <code>&lt;canvas&gt;</code> drawing application, Web Sockets are used to pass along the coordinates of the lines that other users draw back to each client as they happen.</p>
<p>And so on.. You will also see <a href="#DevelopWebSocketInAction">a simple demo developed by me below</a>.</p>
<h3 id="BrowserSupport">Browser/Server Support</h3>
<p>WebSocket is not only designed for browser/server communication, client application can also use it.  At the time I wrote this article, WebSocket protocol is <a href="https://www.internetadvisor.com/best-internet-browser?msID=f3fcb92f-191b-4cb1-bdf0-fe8e9e51514e" target="_blank">support in all popular browsers</a>.</p>
<p>The awesome <a href="http://caniuse.com/#search=websocket">Can I uses it</a> is maintaining HTML5 new features support in all popular browsers, screenshot below shows WebSocket support:</p>
<p><a title="Click to enlarge" href="http://a1rvha.bay.livefilestore.com/y1p6ecKygtANGqAnIDS7zapwe9zUQgFB__gBeXmF6VF-dKBRn__thLJh3puXV-2rToxke3ufkf3ZLSXkUjBzfMo9DHPSRlvKoo8/WebSocketBrowsersupport.png?psid=1"><img title="WebSocket Browser Support Table" src="http://a1rvha.bay.livefilestore.com/y1p6ecKygtANGqAnIDS7zapwe9zUQgFB__gBeXmF6VF-dKBRn__thLJh3puXV-2rToxke3ufkf3ZLSXkUjBzfMo9DHPSRlvKoo8/WebSocketBrowsersupport.png?psid=1" alt="WebSocket Browser Support Table" width="640" height="212"></a></p>
<p>There are also a number of WebSocket servers available:</p>
<p><a href="http://socket.io">http://socket.io</a>  - Provides seamless support for a variety of transports (WebSocket, WebSocket over Flash, XHR polling, JSONP polling, etc.) intended for real-time communication developed by <a href="http://devthought.com/">Guillermo Rauch</a> </p>
<p><a href="https://github.com/ncr/node.ws.js">node.ws.js</a> - A simple WebSocket server (support both <span class="Apple-style-span" style="white-space: pre;">draft-hixie-thewebsocketprotocol-75 and </span><span class="Apple-style-span" style="white-space: pre;">draft-hixie-thewebsocketprotocol-76</span>) developed based on <a href="http://github.com/Guille/node.websocket.js">node.websocket.js</a>.</p>
<p><a href="https://github.com/gimite/web-socket-js" rel="nofollow">web-socket-js</a> - HTML5 Web Socket implementation powered by Flash</p>
<p><a href="http://nugget.codeplex.com/">http://nugget.codeplex.com</a> - A web socket server implemented in C#.</p>
<p><a href="http://jWebSocket">jWebSocket.org</a> - The Open Source Java WebSocket Server</p>
<p><a href="http://code.google.com/p/phpwebsocket">phpwebsocket</a> - PHP version of WebSocket server.</p>
<h3 id="WebSocketJavaScriptAPI">WebSocket JavaScript API</h3>
<p>W3C defined <a href="http://www.w3.org/TR/websockets/#the-websocket-interface">WebSocket interface</a> as below:</p>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #dcdccc;">[</span><span style="color: #dcdccc;">Constructor</span>(<span style="color: #e3ceab;">in</span> <span style="color: #dcdccc;">DOMString</span> <span style="color: #dcdccc;">url</span><span style="color: #dcdccc;">,</span> <span style="color: #e3ceab;">in</span> <span style="color: #dcdccc;">optional</span> <span style="color: #dcdccc;">DOMString</span> <span style="color: #dcdccc;">protocols</span><span style="color: #dcdccc;">)]</span><br> <span style="color: #dcdccc;">[</span><span style="color: #dcdccc;">Constructor</span>(<span style="color: #e3ceab;">in</span> <span style="color: #dcdccc;">DOMString</span> <span style="color: #dcdccc;">url</span><span style="color: #dcdccc;">,</span> <span style="color: #e3ceab;">in</span> <span style="color: #dcdccc;">optional</span> <span style="color: #dcdccc;">DOMString</span><span style="color: #dcdccc;">[]</span> <span style="color: #dcdccc;">protocols</span><span style="color: #dcdccc;">)]</span><br> <span style="color: #e3ceab;">interface</span> <span style="color: #dcdccc;">WebSocket</span> <span style="color: #dcdccc;">{</span><br>   <span style="color: #dcdccc;">readonly</span> <span style="color: #dcdccc;">attribute</span> <span style="color: #dcdccc;">DOMString</span> <span style="color: #dcdccc;">url</span>;<br> <br>   <span style="color: #7f9f7f;">// ready state</span><br>   <span style="color: #e3ceab;">const</span> <span style="color: #dcdccc;">unsigned</span> <span style="color: #e3ceab;">short</span> <span style="color: #dcdccc;">CONNECTING</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;">0</span>;<br>   <span style="color: #e3ceab;">const</span> <span style="color: #dcdccc;">unsigned</span> <span style="color: #e3ceab;">short</span> <span style="color: #dcdccc;">OPEN</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;">1</span>;<br>   <span style="color: #e3ceab;">const</span> <span style="color: #dcdccc;">unsigned</span> <span style="color: #e3ceab;">short</span> <span style="color: #dcdccc;">CLOSING</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;">2</span>;<br>   <span style="color: #e3ceab;">const</span> <span style="color: #dcdccc;">unsigned</span> <span style="color: #e3ceab;">short</span> <span style="color: #dcdccc;">CLOSED</span> <span style="color: #dcdccc;">=</span> <span style="color: #8cd0d3;">3</span>;<br>   <span style="color: #dcdccc;">readonly</span> <span style="color: #dcdccc;">attribute</span> <span style="color: #dcdccc;">unsigned</span> <span style="color: #e3ceab;">short</span> <span style="color: #dcdccc;">readyState</span>;<br>   <span style="color: #dcdccc;">readonly</span> <span style="color: #dcdccc;">attribute</span> <span style="color: #dcdccc;">unsigned</span> <span style="color: #e3ceab;">long</span> <span style="color: #dcdccc;">bufferedAmount</span>;<br> <br>   <span style="color: #7f9f7f;">// networking</span><br>   <span style="color: #dcdccc;">attribute</span> <span style="color: #f0dfaf; font-weight: bold;">Function</span> <span style="color: #dcdccc;">onopen</span>;<br>   <span style="color: #dcdccc;">attribute</span> <span style="color: #f0dfaf; font-weight: bold;">Function</span> <span style="color: #dcdccc;">onmessage</span>;<br>   <span style="color: #dcdccc;">attribute</span> <span style="color: #f0dfaf; font-weight: bold;">Function</span> <span style="color: #dcdccc;">onerror</span>;<br>   <span style="color: #dcdccc;">attribute</span> <span style="color: #f0dfaf; font-weight: bold;">Function</span> <span style="color: #dcdccc;">onclose</span>;<br>   <span style="color: #dcdccc;">readonly</span> <span style="color: #dcdccc;">attribute</span> <span style="color: #dcdccc;">DOMString</span> <span style="color: #dcdccc;">protocol</span>;<br>   <span style="color: #e3ceab;">void</span> <span style="color: #dcdccc;">send</span>(<span style="color: #e3ceab;">in</span> <span style="color: #dcdccc;">DOMString</span> <span style="color: #dcdccc;">data</span>);<br>   <span style="color: #e3ceab;">void</span> <span style="color: #dcdccc;">close</span>();<br> <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">WebSocket</span> <span style="color: #e3ceab;">implements</span> <span style="color: #dcdccc;">EventTarget</span>;</pre>
<p>The <em>url </em>attribute is the WebSocket server Url, the <em>protocol </em>is usually "ws" (for unencrypted plain text WebSocket) or "wss" (for secure WebSocket), <em>send</em> method sends data to server after connected, <em>close </em>is to send close signal, besides there are four important events: onopen, onmessage, onerror and onclose, I borrowed a nice picture below from <a href="http://net.tutsplus.com/tutorials/javascript-ajax/start-using-html5-websockets-today/">nettuts</a>.</p>
<p><img title="WebSocket Events" src="http://d2o0t5hpnwv4c1.cloudfront.net/751_webSocketsStarter/events.jpg" alt="WebSocket Events" width="600" height="300"></p>
<ul>
<li>
<strong>onopen</strong>: When a socket has opened, i.e. after TCP three-way handshake and WebSocket handshake.</li>
<li>
<strong>onmessage</strong>: When a message has been received from WebSocket server.</li>
<li>
<strong>onerror</strong>: Triggered when error occurred.</li>
<li>
<strong>onclose</strong>: When a socket has been closed.</li>
</ul>
<p>JavaScript code below is to setup WebSocket connection and retrieve data:</p>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">wsUrl</span> <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">'ws://localhost:8888/DummyPath'</span>;<br> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">websocket</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">new</span> <span style="color: #dcdccc;">WebSocket</span>(<span style="color: #dcdccc;">wsUrl</span>);<br> <span style="color: #dcdccc;">websocket</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onopen</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">onOpen</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">websocket</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onclose</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">onClose</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">websocket</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onmessage</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">onMessage</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">websocket</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onerror</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">onError</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">};</span><br> <br>     <br> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">onOpen</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br>     <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">"Connected to WebSocket server."</span>);<br>     <br>     <span style="color: #dcdccc;">websocket</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">send</span>(<span style="color: #cc9393;">"HTML5 WebSocket rocks!"</span>);<br> <span style="color: #dcdccc;">}</span><br> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">onClose</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">"Disconnected"</span>); <span style="color: #dcdccc;">}</span><br> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">onMessage</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br>     <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">'Retrieved data from server: '</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span>); <br>     <br>     <span style="color: #7f9f7f;">// Update UI...</span><br> <span style="color: #dcdccc;">}</span><br> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">onError</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">'Error occured: '</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span>); <span style="color: #dcdccc;">}</span></pre>
<h3 id="DevelopWebSocketInAction">Develop WebSocket In Action - Team Poker Demo<span class="Apple-style-span" style="font-size: 10px; font-weight: normal;"> </span>
</h3>
<p>Estimating user story effort by using <a href="http://www.crisp.se/planningpoker/">Planning Poker Cards</a> is well-known and widely used in Agile/Scrum development, Program Manager/Scrum Master prepare user stories beforehand, hold meeting with stake holders and have them play poker to represent one's estimation on each story, the higher the card value is, the harder to implement, on the contrary, the lower the value is, the easier to implement, "0" indicates "no effort" or "has been done", "?" indicates "mission impossible" or "unclear requirement".</p>
<p>Actually there is a website - <a title="Poker Planning" href="http://pokerplanning.com">http://pokerplanning.com</a> does the exact work described above, my co-workers and I used it for several times, however, we found it is getting slower and slower as more team members joining the game or after several rounds of voting, we did experience the worst result: no one can vote anymore because everyone's voting page got stucked. I strongly suspect the major reason for this is its Ajax Polling strategy in order to ensure everyone got real-time voting status. By tracking its network activities I guess I was right.</p>
<p>Ajax polling in <a title="Poker Planning" href="http://pokerplanning.com">http://pokerplanning.com</a>:<br><img title="Ajax Polling" src="http://a1rvha.bay.livefilestore.com/y1pa2JzUcKtaGjtoIXjpWoiEA17Mq5w75kRsegCjqdvOZ_G4GoKzbzy6wol_zvpR09erNYzURiWOedM3paxsWSNGVSoebfN5VH4/AJaxPolling.png?psid=1" alt="Ajax Polling" width="640" height="318"></p>
<p>I believe HTML5 WebSocket will solve the problem! So I developed a simple demo (I named it <strong>Team Poker</strong>) which currently only has limited and basic functionalities described as below:</p>
<ol>
<li>User can login to poker room after inputting his/her nickname.</li>
<li>Everyone gets notified when one user players a poker.</li>
<li>Everyone gets notified when new player joins.</li>
<li>Newly joined player can see the current participants and voting status.</li>
</ol>
<p>The login screenshot for requirement #1:</p>
<p><img title="TeamPoker - Login" src="http://a1rvha.bay.livefilestore.com/y1pPoZ5fyE2aQNYii7Ebnl1A4FljhylbIQVLX4XXz_zKuXnGerroSBQJr7pcograDIZOPuJz_s2j4I7OWoEjhpwIbOCLsHMltiR/TeamPoker-Login.png?psid=1" alt="TeamPoker - Login" width="640" height="516"></p>
<p>New participant(s), new voted poker(s) status update screenshot for requirement #2 and #3 (please click on the image to enlarge):</p>
<p><a title="Click to enlarge" href="http://a1rvha.bay.livefilestore.com/y1plgEc-4xlEcANc_McjugrixSwHuleRSc0sxEm8W4nShfEECx50rK_9cpvZcgbG85R5V38tq-EuJgMksFGbwVjnhwr-mk6DfI0/TeamPoker-Vote.png?psid=1"><img title="TeamPoker - Voting - Click to enlarge" src="http://a1rvha.bay.livefilestore.com/y1plgEc-4xlEcANc_McjugrixSwHuleRSc0sxEm8W4nShfEECx50rK_9cpvZcgbG85R5V38tq-EuJgMksFGbwVjnhwr-mk6DfI0/TeamPoker-Vote.png?psid=1" alt="TeamPoker - Voting" width="640" height="317"></a></p>
<p>Newly joined participant(s) can see current game status, story #4:</p>
<p><a href="http://a1rvha.bay.livefilestore.com/y1pMaywJvAp-OoJh6hHJGO31UGfYqJu0n9z0tGGWBRCu5jS0PKE61qepvIoBge326IVyencTn8kCPk5AoQj4fkZzPxbFFPasFYC/TeamPoker-VoteFinished.png?psid=1" title="Click to enlarge"><img title="TeamPoker-Vote Status" src="http://a1rvha.bay.livefilestore.com/y1pMaywJvAp-OoJh6hHJGO31UGfYqJu0n9z0tGGWBRCu5jS0PKE61qepvIoBge326IVyencTn8kCPk5AoQj4fkZzPxbFFPasFYC/TeamPoker-VoteFinished.png?psid=1" alt="TeamPoker-Vote Status" width="640" height="337"></a></p>
<blockquote>
<p>Please note the Team Poker demo is concentrated on demonstrating the power of WebSocket, in real world, player shouldn't see the poker values played by other players, and there is functionalities like moderator customizing user stories, storing game status on server side, and there is no fancy UI/animation. However, I've share all the source code at the beginning of this article, in additional, I've uploaded the source code on github: <a href="https://github.com/WayneYe/TeamPoker">https://github.com/WayneYe/TeamPoker</a>, wish some people make it better and productive, will you fork it with me? Dear reader:).</p>
</blockquote>
<p>Ok, now coding time, since all clients need to get notified about other client's changes (new player joining or new poker played), in additional, new joint player needs to know current status, I defined two communication contracts:</p>
<ul>
<li>
<em>ClientMessage</em> indicates message sent from client, contains a Type property reflects enumeration class <em>MessageType - NewParticipaint, NewVoteInfo, and a Data</em> property to store data<em>.</em>
</li>
<li>
<em>ServerStatus</em>, stores current playing players as well as current voting status - a hashtable [{PlayerName}, {VoteValue}], broadcast to all clients once receiving new client message.</li>
</ul>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">TeamPoker</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">TeamPoker</span> || <span style="color: #efefaf; font-weight: bold;">function</span> () <span style="color: #dcdccc;">{</span> <span style="color: #dcdccc;">};</span><br> <br> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">VoteInfo</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">playerName</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">voteValue</span>) <span style="color: #dcdccc;">{</span><br>     <span style="color: #e3ceab;">this</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">PlayerName</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">playerName</span>;<br>     <span style="color: #e3ceab;">this</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">VoteValue</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">voteValue</span>;<br> <span style="color: #dcdccc;">}</span><br> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">MessageType</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">{</span><br>     <span style="color: #dcdccc;">NewParticipaint</span><span style="color: #dcdccc;">:</span> <span style="color: #cc9393;">'NewParticipaint'</span><span style="color: #dcdccc;">,</span><br>     <span style="color: #dcdccc;">NewVoteInfo</span><span style="color: #dcdccc;">:</span> <span style="color: #cc9393;">'NewVoteInfo'</span><br> <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ClientMessage</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">type</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">data</span>) <span style="color: #dcdccc;">{</span><br>     <span style="color: #e3ceab;">this</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">Type</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">type</span>;<br>     <span style="color: #e3ceab;">this</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">Data</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">data</span>;<br> <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ServerStatus</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> () <span style="color: #dcdccc;">{</span><br>     <span style="color: #e3ceab;">this</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">Players</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">[];</span><br>     <span style="color: #e3ceab;">this</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">VoteStatus</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">[];</span><br> <span style="color: #dcdccc;">};</span></pre>
<p> On client side, a WebSocket connection will be established after user clicking "Login" button, the nickname will be sent to WebSocket server running on nodejs, the kernal client code is shown below:</p>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">connectToWsServer</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> () <span style="color: #dcdccc;">{</span><br>     <span style="color: #7f9f7f;">// Init Web Socket connect</span><br>     <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">WSURI</span> <span style="color: #dcdccc;">=</span> <span style="color: #cc9393;">"ws://192.168.1.6:8888"</span>;<br>     <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WsClient</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">new</span> <span style="color: #dcdccc;">WebSocket</span>(<span style="color: #dcdccc;">WSURI</span>);<br> <br>     <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WsClient</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onopen</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br>         <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">'Successfully connected to WebSocket server.'</span>);<br>         <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">joinGame</span>();<br>     <span style="color: #dcdccc;">};</span><br>     <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WsClient</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onclose</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br>         <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">'Connection closed.'</span>);<br>     <span style="color: #dcdccc;">};</span><br>     <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WsClient</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onmessage</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br>         <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">'Retrived msg from server: '</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span>);<br>         <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">updateGameStatus</span>(<span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span>);<br>     <span style="color: #dcdccc;">};</span><br>     <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WsClient</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onerror</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br>         <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">'An error occured: '</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span>);<br>     <span style="color: #dcdccc;">};</span><br> <span style="color: #dcdccc;">};</span><br> <br> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">joinGame</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> () <span style="color: #dcdccc;">{</span><br>     <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">joinGameMsg</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">new</span> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ClientMessage</span>(<span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">MessageType</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">NewParticipaint</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">CurrentPlayerName</span>);<br> <br>     <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">WsClient</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">send</span>(<span style="color: #dcdccc;">JSON</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">stringify</span>(<span style="color: #dcdccc;">joinGameMsg</span>));<br> <span style="color: #dcdccc;">}</span><br> <span style="color: #dcdccc;">TeamPoker</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">updateGameStatus</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">data</span>) <span style="color: #dcdccc;">{</span><br>     <span style="color: #7f9f7f;">// Format/fill the data from server side to HTML</span><br> <span style="color: #dcdccc;">}</span></pre>
<p>On server side, one important task is to maintain all active client WebSocket connections so that it can "broadcast" messages to every client, and remove the closed client to avoid sending message to "dead" client. Other than this, the logic is very simple, validate message type sent from client, update players/vote status repository and then broadcast to all client:</p>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"><span></span><span style="color: #586e75; font-style: italic">/*</span>
<span style="color: #586e75; font-style: italic">WebSocket server based on</span>
<span style="color: #586e75; font-style: italic">https://github.com/ncr/node.ws.js</span>
<span style="color: #586e75; font-style: italic">Written By Wayne Ye 6/4/2011</span>
<span style="color: #586e75; font-style: italic">http://wayneye.com</span>
<span style="color: #586e75; font-style: italic">*/</span>

<span style="color: #2aa198">var</span> <span style="color: #839496">sys</span> <span style="color: #586e75">=</span> <span style="color: #839496">require(</span><span style="color: #2aa198">"sys"</span><span style="color: #839496">),</span>
    <span style="color: #839496">ws</span> <span style="color: #586e75">=</span> <span style="color: #839496">require(</span><span style="color: #2aa198">"./ws"</span><span style="color: #839496">);</span>

<span style="color: #2aa198">var</span> <span style="color: #839496">wsClients</span> <span style="color: #586e75">=</span> <span style="color: #839496">[],</span> <span style="color: #839496">players</span> <span style="color: #586e75">=</span> <span style="color: #839496">[],</span> <span style="color: #839496">votedPlayers</span> <span style="color: #586e75">=</span> <span style="color: #839496">[],</span> <span style="color: #839496">voteStatus</span> <span style="color: #586e75">=</span> <span style="color: #839496">[];</span>

<span style="color: #839496">ws.createServer(</span><span style="color: #2aa198">function</span> <span style="color: #839496">(websocket)</span> <span style="color: #839496">{</span>
    <span style="color: #839496">websocket.addListener(</span><span style="color: #2aa198">"connect"</span><span style="color: #839496">,</span> <span style="color: #2aa198">function</span> <span style="color: #839496">(resource)</span> <span style="color: #839496">{</span>
        <span style="color: #586e75; font-style: italic">// emitted after handshake</span>
        <span style="color: #839496">sys.debug(</span><span style="color: #2aa198">"Client connected on path: "</span> <span style="color: #586e75">+</span> <span style="color: #839496">resource);</span>

        <span style="color: #586e75; font-style: italic">// # Add to our list of wsClients</span>
        <span style="color: #839496">wsClients.push(websocket);</span>

        <span style="color: #586e75; font-style: italic">//sys.debug(traverseObj(websocket));</span>

    <span style="color: #839496">}).addListener(</span><span style="color: #2aa198">"data"</span><span style="color: #839496">,</span> <span style="color: #2aa198">function</span> <span style="color: #839496">(data)</span> <span style="color: #839496">{</span>
        <span style="color: #2aa198">var</span> <span style="color: #839496">clinetMsg</span> <span style="color: #586e75">=</span> <span style="color: #839496">JSON.parse(data);</span>

        <span style="color: #859900">switch</span> <span style="color: #839496">(clinetMsg.Type)</span> <span style="color: #839496">{</span>
            <span style="color: #859900">case</span> <span style="color: #839496">ClientMsgType.NewParticipaint</span><span style="color: #586e75">:</span>
                <span style="color: #2aa198">var</span> <span style="color: #839496">newPlayer</span> <span style="color: #586e75">=</span> <span style="color: #839496">clinetMsg.Data;</span>
                <span style="color: #839496">sys.debug(</span><span style="color: #2aa198">'New Participaint: '</span> <span style="color: #586e75">+</span> <span style="color: #839496">newPlayer);</span>
                <span style="color: #839496">players.push(newPlayer);</span>

                <span style="color: #2aa198">var</span> <span style="color: #839496">gameStatus</span> <span style="color: #586e75">=</span> <span style="color: #859900">new</span> <span style="color: #839496">GameStatus();</span>
                <span style="color: #839496">gameStatus.Players</span> <span style="color: #586e75">=</span> <span style="color: #839496">players;</span>
                <span style="color: #839496">gameStatus.VotedPlayers</span> <span style="color: #586e75">=</span> <span style="color: #839496">votedPlayers;</span>

                <span style="color: #2aa198">var</span> <span style="color: #839496">serverMsg</span> <span style="color: #586e75">=</span> <span style="color: #859900">new</span> <span style="color: #839496">ServerMessage(ServerMsgType.NewParticipaint,</span> <span style="color: #839496">newPlayer);</span>
                <span style="color: #839496">broadCast(JSON.stringify(serverMsg));</span>

                <span style="color: #586e75; font-style: italic">// Notify the new client current game status</span>
                <span style="color: #2aa198">var</span> <span style="color: #839496">notifyCurrentStatus</span> <span style="color: #586e75">=</span> <span style="color: #859900">new</span> <span style="color: #839496">ServerMessage(ServerMsgType.NotifyCurrentStatus,</span> <span style="color: #839496">gameStatus);</span>
                <span style="color: #839496">wsClients[wsClients.length</span> <span style="color: #586e75">-</span> <span style="color: #2aa198">1</span><span style="color: #839496">].write(JSON.stringify(notifyCurrentStatus));</span>

                <span style="color: #859900">break</span><span style="color: #839496">;</span>
            <span style="color: #859900">case</span> <span style="color: #839496">ClientMsgType.NewVoteInfo</span><span style="color: #586e75">:</span>
                <span style="color: #2aa198">var</span> <span style="color: #839496">newVoteInfo</span> <span style="color: #586e75">=</span> <span style="color: #839496">clinetMsg.Data;</span>
                <span style="color: #839496">sys.debug(</span><span style="color: #2aa198">'New VoteInfo: '</span> <span style="color: #586e75">+</span> <span style="color: #839496">newVoteInfo.PlayerName</span> <span style="color: #586e75">+</span> <span style="color: #2aa198">' voted '</span> <span style="color: #586e75">+</span> <span style="color: #839496">newVoteInfo.VoteValue);</span>

                <span style="color: #839496">votedPlayers.push(newVoteInfo.PlayerName);</span>
                <span style="color: #839496">voteStatus.push(</span><span style="color: #859900">new</span> <span style="color: #839496">VoteInfo(newVoteInfo.PlayerName,</span> <span style="color: #839496">newVoteInfo.VoteValue));</span>

                <span style="color: #2aa198">var</span> <span style="color: #839496">notifyCurrentStatus</span> <span style="color: #586e75">=</span> <span style="color: #859900">new</span> <span style="color: #839496">ServerMessage(ServerMsgType.NewVoteInfo,</span> <span style="color: #839496">newVoteInfo.PlayerName);</span>
                <span style="color: #839496">broadCast(JSON.stringify(notifyCurrentStatus));</span>
                <span style="color: #859900">break</span><span style="color: #839496">;</span>
            <span style="color: #859900">case</span> <span style="color: #839496">ClientMsgType.ViewVoteResult</span><span style="color: #586e75">:</span>
                <span style="color: #839496">sys.debug(</span><span style="color: #2aa198">'Broadcast vote result to client(s)..'</span><span style="color: #839496">);</span>
                <span style="color: #2aa198">var</span> <span style="color: #839496">viewVoteResultMsg</span> <span style="color: #586e75">=</span> <span style="color: #859900">new</span> <span style="color: #839496">ServerMessage(ServerMsgType.ViewVoteResult,</span> <span style="color: #839496">voteStatus);</span>
                <span style="color: #839496">broadCast(JSON.stringify(viewVoteResultMsg));</span>
                <span style="color: #859900">break</span><span style="color: #839496">;</span>
            <span style="color: #859900">default</span><span style="color: #586e75">:</span>
                <span style="color: #859900">break</span><span style="color: #839496">;</span>
        <span style="color: #839496">}</span>

    <span style="color: #839496">}).addListener(</span><span style="color: #2aa198">"close"</span><span style="color: #839496">,</span> <span style="color: #2aa198">function</span> <span style="color: #839496">()</span> <span style="color: #839496">{</span>
        <span style="color: #586e75; font-style: italic">// emitted when server or client closes connection</span>

        <span style="color: #859900">for</span> <span style="color: #839496">(</span><span style="color: #2aa198">var</span> <span style="color: #839496">i</span> <span style="color: #586e75">=</span> <span style="color: #2aa198">0</span><span style="color: #839496">;</span> <span style="color: #839496">i</span> <span style="color: #586e75">&lt;</span> <span style="color: #839496">wsClients.length;</span> <span style="color: #839496">i</span><span style="color: #586e75">++</span><span style="color: #839496">)</span> <span style="color: #839496">{</span>
            <span style="color: #586e75; font-style: italic">// # Remove from our connections list so we don't send</span>
            <span style="color: #586e75; font-style: italic">// # to a dead socket</span>
            <span style="color: #859900">if</span> <span style="color: #839496">(wsClients[i]</span> <span style="color: #586e75">==</span> <span style="color: #839496">websocket)</span> <span style="color: #839496">{</span>
                <span style="color: #839496">sys.debug(</span><span style="color: #2aa198">"close with client: "</span> <span style="color: #586e75">+</span> <span style="color: #839496">websocket);</span>
                <span style="color: #839496">wsClients.splice(i);</span>
                <span style="color: #859900">break</span><span style="color: #839496">;</span>
            <span style="color: #839496">}</span>
        <span style="color: #839496">}</span>
    <span style="color: #839496">});</span>
<span style="color: #839496">}).listen(</span><span style="color: #2aa198">8888</span><span style="color: #839496">);</span>

<span style="color: #2aa198">function</span> <span style="color: #839496">broadCast(msg)</span> <span style="color: #839496">{</span>
    <span style="color: #839496">sys.debug(</span><span style="color: #2aa198">'Broadcast server status to all wsClients: '</span> <span style="color: #586e75">+</span> <span style="color: #839496">msg);</span>
    <span style="color: #859900">for</span> <span style="color: #839496">(</span><span style="color: #2aa198">var</span> <span style="color: #839496">i</span> <span style="color: #586e75">=</span> <span style="color: #2aa198">0</span><span style="color: #839496">;</span> <span style="color: #839496">i</span> <span style="color: #586e75">&lt;</span> <span style="color: #839496">wsClients.length;</span> <span style="color: #839496">i</span><span style="color: #586e75">++</span><span style="color: #839496">)</span>
        <span style="color: #839496">wsClients[i].write(msg);</span>
<span style="color: #839496">}</span>

<span style="color: #2aa198">var</span> <span style="color: #839496">ClientMsgType</span> <span style="color: #586e75">=</span> <span style="color: #839496">{</span>
    <span style="color: #839496">NewParticipaint</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'NewParticipaint'</span><span style="color: #839496">,</span>
    <span style="color: #839496">NewVoteInfo</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'NewVoteInfo'</span><span style="color: #839496">,</span>
    <span style="color: #839496">ViewVoteResult</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'ViewVoteResult'</span>
<span style="color: #839496">};</span>
<span style="color: #2aa198">function</span> <span style="color: #839496">ClientMessage(type,</span> <span style="color: #839496">data)</span> <span style="color: #839496">{</span>
    <span style="color: #859900">this</span><span style="color: #839496">.Type</span> <span style="color: #586e75">=</span> <span style="color: #839496">type;</span>
    <span style="color: #859900">this</span><span style="color: #839496">.Data</span> <span style="color: #586e75">=</span> <span style="color: #839496">data;</span>
<span style="color: #839496">};</span>
<span style="color: #2aa198">var</span> <span style="color: #839496">ServerMsgType</span> <span style="color: #586e75">=</span> <span style="color: #839496">{</span>
    <span style="color: #839496">NewParticipaint</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'NewParticipaint'</span><span style="color: #839496">,</span>
    <span style="color: #839496">NewVoteInfo</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'NewVoteInfo'</span><span style="color: #839496">,</span>
    <span style="color: #839496">NotifyCurrentStatus</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'NotifyCurrentStatus'</span><span style="color: #839496">,</span>
    <span style="color: #839496">ViewVoteResult</span><span style="color: #586e75">:</span> <span style="color: #2aa198">'ViewVoteResult'</span>
<span style="color: #839496">};</span>
<span style="color: #2aa198">function</span> <span style="color: #839496">ServerMessage(type,</span> <span style="color: #839496">data)</span> <span style="color: #839496">{</span>
    <span style="color: #859900">this</span><span style="color: #839496">.Type</span> <span style="color: #586e75">=</span> <span style="color: #839496">type;</span>
    <span style="color: #859900">this</span><span style="color: #839496">.Data</span> <span style="color: #586e75">=</span> <span style="color: #839496">data;</span>
<span style="color: #839496">};</span>
<span style="color: #2aa198">function</span> <span style="color: #839496">VoteInfo(playerName,</span> <span style="color: #839496">voteValue)</span> <span style="color: #839496">{</span>
    <span style="color: #859900">this</span><span style="color: #839496">.PlayerName</span> <span style="color: #586e75">=</span> <span style="color: #839496">playerName;</span>
    <span style="color: #859900">this</span><span style="color: #839496">.VoteValue</span> <span style="color: #586e75">=</span> <span style="color: #839496">voteValue;</span>
<span style="color: #839496">}</span>
<span style="color: #2aa198">function</span> <span style="color: #839496">GameStatus()</span> <span style="color: #839496">{</span>
    <span style="color: #859900">this</span><span style="color: #839496">.Players</span> <span style="color: #586e75">=</span> <span style="color: #839496">[];</span>
    <span style="color: #859900">this</span><span style="color: #839496">.VotedPlayers</span> <span style="color: #586e75">=</span> <span style="color: #839496">[];</span>
<span style="color: #839496">};</span>
</pre>
<p>Complete source code could be found at github: <a href="https://github.com/WayneYe/TeamPoker">https://github.com/WayneYe/TeamPoker</a>.</p>
<p>After going through the code let's see <strong>what happens underneath:</strong> screenshot below was snapped while I was developing the Team Poker WebSocket demo, it recorded the entire process of the WebSocket communication, in this picture
  192.168.1.2 is the host of TeamPoker page which fires WebSocket request, 192.168.1.6 is the WebSocket server based on nodejs which exposes port 8888 running on ubuntu 11.04.</p>
<p>All packets behind WebSocket connection:<br><img width="639" height="378" alt="WebSocketProtocol.png" src="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketProtocol.png" data-src="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketProtocol.png" class="lazyautosizes lazyloaded" data-sizes="auto" data-srcset="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketProtocol-r-400.png 400w, https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketProtocol.png 639w" sizes="639px" srcset="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketProtocol-r-400.png 400w, https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketProtocol.png 639w"></p>
<p>WebSocket request &amp; response headers:<br><img width="632" height="304" alt="WebSocketStream.png" src="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketStream.png" data-src="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketStream.png" class="lazyautosizes lazyloaded" data-sizes="auto" data-srcset="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketStream-r-400.png 400w, https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketStream.png 632w" sizes="632px" srcset="https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketStream-r-400.png 400w, https://www.codeproject.com/KB/HTML/Web-Socket-in-Essence/WebSocketStream.png 632w"></p>
<p>So see the power of WebSocket?</p>
<ol>
  <li>Data transfer is done within one TCP connection lifecycle.</li>
  <li>No extra headers after handshake. You might notice that the "<strong>length</strong>" column represents each packet's size, it is less than 100 bytes by average in my case and it only depend on exact transferred data size.</li>
</ol>
<p>In Ajax polling or Comet, HTTP requests/responses with header information is<strong> impossible to achieve same level performance as WebSocket</strong>, both of them created new HTTP (TCP) connections to transfer data, and each connection's size is relatively
  larger than WebSocket, especially when there are cookies stored in header or long headers such as "User-Agent", "If-Modified-Since", "If-Match", "X-Powered-By", etc. </p>
<p>One thing deserves to be mentioned is the TCP keep alive signals, we should consider close the WebSocket connection as soon as we don't need it any more, otherwise bandwidth will be wasted. </p>
<h2 id="OpenIssues">Open Issues</h2>
<p>Adam Barth and his co-workers had found a security vulnerability of WebSocket, he pointed out many routers do not recognize HTTP "Upgrade" mechanism, those routers treat WebSocket packet after handshake as subsequent HTTP packets, as a result the attackers
  can poison the proxy's HTTP cache (you can refer their <a href="http://www.ietf.org/mail-archive/web/hybi/current/msg04744.html">exhaustive description</a>), they suggest using CONNECT-based handshake, most proxies appear to understand the
  semantics of CONNECT requests than understand the semantics of the Upgrade mechanism, and after simulating CONNECT-based handshake they found there was no way to poison the proxy's HTTP cache.</p>
<p>Because of the security issue, Firefox 4.0 and Opera 11 disabled WebSocket by default, we can enable it in <em>about:config</em>, please refer more details <a href="https://developer.mozilla.org/en/WebSockets">here </a>and <a href="http://my.opera.com/chooseopera/blog/2010/12/10/regarding-websocket">here</a>.</p>
<h2>Conclusion</h2>
<p>WebSocket is a revolutionary feature in HTML5, it defines a full-duplex communication channel that operates through a single socket over the Web, real-time data transferring was never being so easy and efficient with relatively low bandwidth and
  server cost comparing to Ajax polling or Comet. Although it is now not standardized and has security issue mentioned in above section, hence at this time is not recommended to use it in enterprise solutions or data sensitive applications, developers
  should learn it, watch it, The only thing that never changes is change, the WebSocket protocol draft version numbers changes fast, you might have noticed that after reading my article, wish it becomes normative and standardized soon!  </p>
<p><strong>Are you plugged? If you are, happy WebSocketing!</strong> </p>
<h2 id="References">References &amp; Resources</h2>
<p>
</p>
<p>HTML5 Web Sockets: A Quantum Leap in Scalability for the Web<br><a href="http://websocket.org/quantum.html">http://websocket.org/quantum.html</a><br><br>Wikipedia: Web Socket<br><a href="http://en.wikipedia.org/wiki/WebSockets">http://en.wikipedia.org/wiki/WebSockets</a> <br><br>The
  Web Socket Protocol<br><a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-07">http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-07</a><br><br>The WebSocket API<br><a href="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</a><br><br>Web
  Applications 1.0 - Web sockets<br><a href="http://www.whatwg.org/specs/web-apps/current-work/complete/network.html#network">http://www.whatwg.org/specs/web-apps/current-work/complete/network.html#network</a><br><br>Introducing Web Sockets<br><a href="http://dev.opera.com/articles/view/introducing-web-sockets/">http://dev.opera.com/articles/view/introducing-web-sockets/</a><br><br>WebSockets
  - MDC Docs<br><a href="https://developer.mozilla.org/en/WebSockets">https://developer.mozilla.org/en/WebSockets</a><br><br>Stackoverflow - What are good resources for learning HTML 5 WebSockets?<br><a href="http://stackoverflow.com/questions/4262543/what-are-good-resources-for-learning-html-5-websockets">http://stackoverflow.com/questions/4262543/what-are-good-resources-for-learning-html-5-websockets</a><br><br>HTML
  Labs - WebSocket<br><a href="http://html5labs.interoperabilitybridges.com/prototypes/websockets/websockets/info">http://html5labs.interoperabilitybridges.com/prototypes/websockets/websockets/info</a><br><br>Start using HTML5 WebSocket today<br><a href="http://net.tutsplus.com/tutorials/javascript-ajax/start-using-html5-websockets-today/">http://net.tutsplus.com/tutorials/javascript-ajax/start-using-html5-websockets-today/</a><br><br>HTML
  5 Web Sockets vs. Comet and Ajax <br><a href="http://www.infoq.com/news/2008/12/websockets-vs-comet-ajax">http://www.infoq.com/news/2008/12/websockets-vs-comet-ajax</a><br><br>Internet Socket<br><a href="http://en.wikipedia.org/wiki/Internet_socket">http://en.wikipedia.org/wiki/Internet_socket</a></p>
<p>Real-time web test – does html5 websockets work for you?<br><a href="http://websocketstest.com/">http://websocketstest.com/</a> </p>
</section>
</div>

        
      

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#hack" class="page__taxonomy-item" rel="tag">Hack</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hack" class="page__taxonomy-item" rel="tag">Hack</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2011-06-10T00:00:00-07:00">June 10, 2011</time></p>
        
      </footer>

      <section class="page__share">
  <!---->
    <!--<h4 class="page__share-title">Share on</h4>-->
  <!---->

  <!--<a href="https://twitter.com/intent/tweet?via=wayneye&text=HTML5+Web+Socket+in+Essence%20https%3A%2F%2Fwayneye.me%2FHTML5-Web-Socket-In-Essence" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>-->

  <!--<a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwayneye.me%2FHTML5-Web-Socket-In-Essence" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>-->

  <!--<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwayneye.me%2FHTML5-Web-Socket-In-Essence" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>-->

  
  <figure style="margin-top: 10px; width: 380px;">
      <a href="/assets/images/dashang.jpg"><img src="/assets/images/dashang.jpg" alt="微信打赏"></a>
  </figure>
</section>


      
  <nav class="pagination">
    
      <a href="/Ajax-Cross-Origin-HTTP-request" class="pagination--pager" title="AJAX Cross-Origin HTTP request
">Previous</a>
    
    
      <a href="/Exception-Handling-Particulars-In-Csharp" class="pagination--pager" title="Exception handling particulars in C#
">Next</a>
    
  </nav>

    </article>
</div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/BMW-Convertible-As-My-Beater-Car" rel="permalink">BMW Convertible As My Beater Car
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
  Life is too short to drive boring cars





I bought a 2015 BMW X5 Dec last year, it has been half a year so far (with 2 months she stayed inside the garage for most of the time due to the pandemic), I am pretty satisfied with it, her condition is absolutely excellent, everything works, yes you see it correctly, after 5 years of its life, there was nothing broken, as BMW vehicle built in recent years, this is something not VERY easy.  My plan is to keep it as long as possible before it turns into an endless money pit, and keeping her value as high as possible, one of the major reason I b...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2019-12-07-SkyJump-Las-Vegas" rel="permalink">SkyJump from Stratosphere Tower at Las Vegas - Smile all the way down
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Instead of spending any cent in the money pit casinos, I’d chose to do something more meaningful and exciting :)


    
    
    
    SkyJump Las Vegas




  SkyJump Las Vegas holds the Guinness World Record for highest commercial decelerator descent with an official height of 829 ft (253 m) and is located at Stratosphere Las Vegas. As part of its grand opening event, Las Vegas Mayor Oscar Goodman presented a written proclamation deeming April 20, 2010 as SkyJump Day in Las Vegas.
  – Wikipedia (https://en.wikipedia.org/wiki/SkyJump_Las_Vegas)





  



</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/AWS-reinvent-Las-Vegas" rel="permalink">AWS reinvent 2019 - Las Vegas
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This is my second time attending AWS re-Invent, last time was year 2017, the purpose of this blog is to summarize what I’ve learned, impressed and entertained <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">


    
    At reinvent logo



    
    Crazy crowd at midnight madness party


Overall during my week staying my daily schedule was listening to sessions mixed with slack/emails during the daylight, and party/social in the evening time.

All the keynotes/sessions have been uploaded here:  https://reinvent.awsevents.com/learn/keynotes/  and all announcements were summarized at this page, my personal top 5 thrilled announcement...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Ireland-Trip-2019" rel="permalink">Ireland Trip 2019
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
  WHEN YOU ARE OLD



  When you are old and grey and full of sleep, 
And nodding by the fire, take down this book, 
And slowly read, and dream of the soft look 
Your eyes had once, and of their shadows deep; 
How many loved your moments of glad grace, 
And loved your beauty with love false or true, 
But one man loved the pilgrim soul in you, 
And loved the sorrows of your changing face; 
And bending down beside the glowing bars, 
Murmur, a little sadly, how Love fled 
And paced upon the mountains overhead 
And hid his face amid a crowd of stars. 
– By William Butler Yeats



  当你年老时 
　　 　...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4ea2897777c94202"></script>

    

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto:hi@wayneye.me" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://wayneye.me" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://twitter.com/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://facebook.com/WayneYeDotCom" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/WayneYe/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2022 Wayne Ye. All rights reserved.
 
  <!--Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>-->

      
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>







    
  <script>
    var disqus_config = function () {
      this.page.url = "https://wayneye.me/HTML5-Web-Socket-In-Essence";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/HTML5-Web-Socket-in-Essence"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://wayneye.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  





  </footer>
</div></body>
</html>
