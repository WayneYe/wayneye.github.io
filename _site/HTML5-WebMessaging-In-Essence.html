<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>HTML5 WebMessaging In Essence - Wayneâ€™s Geek Life</title>
<meta name="description" content="Download HTML5_Cross-Domain_WebMessaging_Demo.zip - 2.97 KBAs a web developer, sometimes we are easy to encounter one problem: Cross-Domain communication, conforming Same-Origin-Policy, JavaScript code cannot access code stay in different domain(or sub-domain) or&nbsp;protocol (HTTP/HTTPs) or&nbsp;port, so there was no direct (or I can say: simple) way to achieve Cross-Domain Communication. However, those kinds of requirements does happen: page A and page B are in different domain, &nbsp;B is &quot;embedded&quot; in A, i.e., there is an &quot;iframe&quot; in page A whose &quot;src&quot; is page B&#39;s URL, now page A wants to control page B and vise-versa.&nbsp;By limiting the solution to be done by 100% client JavaScript, beforehand HTML5, there are a number of tricky &quot;hacks&quot;, such as:URL long polling: container page A changes the iframe page B&#39;s URL hash, and B periodically checks the hash, once the hash changed, it takes action according to the contracted hash value. [BTW, the pattern can be revised to be non-polling by HTML5 onchashchange event]CrossFrame, a Safe Communication Mechanism Across Documents and Across Domains.Window Size Monitoring: update the iframe&#39;s window size once, and the containning window subscribes its &quot;onresize&quot; event then takes corresponding action(s). Google Mapplets adopted this pattern.Well, personally I really don&#39;t like all of them... either inelegant, or violates the original functionalities of DOM elements, or too complecated. I believe many people don&#39;t like them too even the pattern inventors I bet... That why WHATWG created Cross-Domain communication in HTML5: Web Messaging.As an HTML5 crazy advocator I like it very much, complete client communication, no server impact, efficient, secure (at least in theory).How to&quot;Child&quot; can be an iframe or an popup window by invocking window.open, &quot;parent page&quot; A contains source code is like below: &lt;iframe id=&quot;ifr&quot; src=&quot;http://domainB.com/B.htm&quot; onload=&quot;sendCommand();&quot;&gt; &nbsp; No frame! &lt;/iframe&gt;  &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;  &nbsp; function sendCommand() { &nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(&quot;Hello&quot;, &quot;http://domainB.com&quot;); &nbsp; } &lt;/script&gt;Notice, make sure post message only when the iframe is loaded, otherwise the contentWindow will be still in same domain with the container page.Child page B contains code like below: &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;sendMsg();&quot; /&gt;  &lt;script&gt; window.addEventListener(&quot;message&quot;, receiveMessage, false);  function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; console.log(&quot;Page B received message from origin: %s.&quot;, evt.origin); &nbsp;&nbsp;&nbsp; console.log(&quot;Event data: %s&quot;, evt.data); &nbsp;&nbsp;&nbsp; //evt.source will be a window who sent the message, it can be used to post message to it &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp; // Take action(s) } &lt;/script&gt;The demo code above is one direction: parent sends message to child (iframe), actually bi-directional message trasfer can also be done, similar with &quot;Parent control child&quot;, child page posts message to container window, only different is call &quot;parent.postMessage&quot;. function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; evt.source.postmessage(&quot;Hello caller&quot;); &nbsp;&nbsp;&nbsp; // or parent.postmessage(&quot;Hello parent&quot;); }Web Messaging EssentialIn a nutshell, HTML5 Web Messaging is a suite of JavaScript API exposed by web browser, to communicate between different&nbsp;browsing context, when JavaScript code in one browser tab/window trys to deliver a message to another tab/window, web browser locates the target tab/window under the specified domain, and file a MessageEvent&nbsp;(which inherits from DOMEvent) to the target tab/window, so if the target tab/window already subscribed the message event, it will gets notified, eventually the message got delivered through MessageEvent.data.Live DemoI&#39;ve done a demo in my dev machine, I override my local hosts file to let &nbsp;Container.com, DomainA.com, DomainB.com and DomainC.com all point to 127.0.0.1:127.0.1.1 Container.com127.0.0.1 DomainA.com127.0.0.1 DomainB.com127.0.0.1 DomainC.comI prepared a Container page which contains code below: &lt;h3&gt;HTML5 Cross-Domain post message demo&lt;/h3&gt; &lt;p id=&quot;infoBar&quot;&gt;&lt;/p&gt; &lt;div id=&quot;wrapperA&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtA&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;A&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrA&quot; src=&quot;http://DomainA.com/A.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperB&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtB&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;B&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrB&quot; src=&quot;http://DomainB.com/B.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperC&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtC&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;C&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrC&quot; src=&quot;http://DomainC.com/C.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div style=&quot;clear: both&quot;&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; var infoBar = document.getElementById(&quot;infoBar&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; infoBar.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; function postMsgToIfr(domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;A&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrA&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtA&quot;).value, &quot;http://DomainA.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;B&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrB&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtB&quot;).value, &quot;http://DomainB.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;C&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrC&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtC&quot;).value, &quot;http://DomainC.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new error(&quot;No such domain!&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/script&gt;And three pages: A.htm located in DomainA.com,&nbsp;B.htm located in DomainB.com,&nbsp;C.htm located in DomainC.com, phisically they all located under C:\inetpub\wwwrooot, while in the browser I manually type DomainA/B/C.com to make the cheat, the code in the A/B/C page are similar, showing below: &lt;h4&gt;DomainA/A.htm1&lt;/h4&gt; &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;doClick();&quot; /&gt; &lt;div id=&quot;d&quot;&gt; &lt;/div&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; function doClick() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parent.postMessage(&quot;Message sent from &quot; + location.host, &quot;http://container.com&quot;); &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; var d = document.getElementById(&quot;d&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d.innerHTML += &quot;Received message \&quot;&lt;span style=\&quot;color:red\&quot;&gt;&quot; + evt.data + &quot;&lt;/span&gt;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; } &lt;/script&gt;I recorded a gif image below to demonstrate the Cross-Domain messaging:See the message passed through different domain in bi-direction? Isn&#39;t it cool?MessageChannelTo support independent communication under different browsing context, HTML5 introduced&nbsp;Message Channel&nbsp;to post message independently, its official definition is showing below:Communication channels in this mechanisms are implemented as two-ways pipes, with a port at each end. Messages sent in one port are delivered at the other port, and vice-versa. Messages are asynchronous, and delivered as DOM events.&nbsp;I spent about half a day in investigating the Message Channel and finally got it worked, my code is showing below:Container page source code &lt;iframe id=&quot;ifr&quot; src=&quot;http://wayneye.site/WebProjects/HRMS/Opener.html&quot; onload=&quot;initMessaging()&quot;&gt;&lt;/iframe&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;div id=&quot;d&quot;&gt;&lt;/div&gt; &lt;script&gt; var d = document.getElementById(&quot;d&quot;); var channel = new MessageChannel(); channel.port1.onmessage = function (evt) { &nbsp;&nbsp;&nbsp; d.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; };  function initMessaging() { &nbsp;&nbsp;&nbsp; var child = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; child.contentWindow.postMessage(&#39;hello&#39;, &#39;http://wayneye.site&#39;, [channel.port2]); }  function postMsg() { &nbsp;&nbsp;&nbsp; channel.port1.postMessage(&#39;Message sent from &#39; + location.host); } &lt;/script&gt;iframe page source code &lt;div id=&quot;info&quot;&gt;&lt;/div&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;script&gt; var info = document.getElementById(&quot;info&quot;); var port = null; window.addEventListener(&quot;message&quot;, function (e) { console.log(e); &nbsp;&nbsp;&nbsp; if(e.ports &amp;&amp; e.ports.length &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = e.ports[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.start(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.addEventListener(&quot;message&quot;, function (evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.innerHTML += &quot;Received message \&quot;&quot; + evt.data + &quot;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, false); &nbsp;&nbsp;&nbsp; } }, false);  function postMsg() { &nbsp;&nbsp;&nbsp; if(port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.postMessage(&quot;Data sent from &quot; + location.host); &nbsp;&nbsp;&nbsp; } } &lt;/script&gt;The entire process can be described as:Container page (A) embedded an iframe whose src is pointing to a page (B) in different domain.Once the iframe loaded, the container posts a message to page B with a MessagePortArray. &nbsp;Page B received the message as well as the array containing a list of MessagePort objects.Page B registers onmessage event on port instance.Page B invokes port.postmessage to send a message to page A through this MessageChannel.&nbsp;At this timestamp, I seems only Opera correctly supports MessageChannel, Google Chrome and IE10 Platform Preview 2 failed to deliver the ports array, Safari cannot gets the onmessage event fired. Firefox 7.0 beta event doesn&#39;t support MessageChannel object.Note: Ports can also enable communication between HTML5 Web Workers.One more thing (plagiarize Steve Jobs), to use Message Channel one noticable point is, web developer should explicitly close the channel once there is no need, otherwise there will be a strong reference between two pages, as W3 official page emphasized below:Authors are strongly encouraged to explicitly close&nbsp;MessagePort&nbsp;objects to disentangle them, so that their resources can be recollected. Creating many&nbsp;MessagePort&nbsp;objects and discarding them without closing them can lead to high memory usage.Further readingHTML5 Web Messagingwindow.postMessage - MDN DocsHTML5 Demo: postMessage (cross domain)HTML5&prime;s window.postMessage APInternet Explorer 10 Platform Preview: HTML5http://ithelp.ithome.com.tw/question/10057709&nbsp;Also posted on CodeProject:&nbsp;http://www.codeproject.com/KB/HTML/HTML5-WebMessaging.aspx">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Wayne's Geek Life">
<meta property="og:title" content="HTML5 WebMessaging In Essence">
<meta property="og:url" content="https://wayneye.site/HTML5-WebMessaging-In-Essence">


  <meta property="og:description" content="Download HTML5_Cross-Domain_WebMessaging_Demo.zip - 2.97 KBAs a web developer, sometimes we are easy to encounter one problem: Cross-Domain communication, conforming Same-Origin-Policy, JavaScript code cannot access code stay in different domain(or sub-domain) or&nbsp;protocol (HTTP/HTTPs) or&nbsp;port, so there was no direct (or I can say: simple) way to achieve Cross-Domain Communication. However, those kinds of requirements does happen: page A and page B are in different domain, &nbsp;B is &quot;embedded&quot; in A, i.e., there is an &quot;iframe&quot; in page A whose &quot;src&quot; is page B&#39;s URL, now page A wants to control page B and vise-versa.&nbsp;By limiting the solution to be done by 100% client JavaScript, beforehand HTML5, there are a number of tricky &quot;hacks&quot;, such as:URL long polling: container page A changes the iframe page B&#39;s URL hash, and B periodically checks the hash, once the hash changed, it takes action according to the contracted hash value. [BTW, the pattern can be revised to be non-polling by HTML5 onchashchange event]CrossFrame, a Safe Communication Mechanism Across Documents and Across Domains.Window Size Monitoring: update the iframe&#39;s window size once, and the containning window subscribes its &quot;onresize&quot; event then takes corresponding action(s). Google Mapplets adopted this pattern.Well, personally I really don&#39;t like all of them... either inelegant, or violates the original functionalities of DOM elements, or too complecated. I believe many people don&#39;t like them too even the pattern inventors I bet... That why WHATWG created Cross-Domain communication in HTML5: Web Messaging.As an HTML5 crazy advocator I like it very much, complete client communication, no server impact, efficient, secure (at least in theory).How to&quot;Child&quot; can be an iframe or an popup window by invocking window.open, &quot;parent page&quot; A contains source code is like below: &lt;iframe id=&quot;ifr&quot; src=&quot;http://domainB.com/B.htm&quot; onload=&quot;sendCommand();&quot;&gt; &nbsp; No frame! &lt;/iframe&gt;  &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;  &nbsp; function sendCommand() { &nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(&quot;Hello&quot;, &quot;http://domainB.com&quot;); &nbsp; } &lt;/script&gt;Notice, make sure post message only when the iframe is loaded, otherwise the contentWindow will be still in same domain with the container page.Child page B contains code like below: &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;sendMsg();&quot; /&gt;  &lt;script&gt; window.addEventListener(&quot;message&quot;, receiveMessage, false);  function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; console.log(&quot;Page B received message from origin: %s.&quot;, evt.origin); &nbsp;&nbsp;&nbsp; console.log(&quot;Event data: %s&quot;, evt.data); &nbsp;&nbsp;&nbsp; //evt.source will be a window who sent the message, it can be used to post message to it &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp; // Take action(s) } &lt;/script&gt;The demo code above is one direction: parent sends message to child (iframe), actually bi-directional message trasfer can also be done, similar with &quot;Parent control child&quot;, child page posts message to container window, only different is call &quot;parent.postMessage&quot;. function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; evt.source.postmessage(&quot;Hello caller&quot;); &nbsp;&nbsp;&nbsp; // or parent.postmessage(&quot;Hello parent&quot;); }Web Messaging EssentialIn a nutshell, HTML5 Web Messaging is a suite of JavaScript API exposed by web browser, to communicate between different&nbsp;browsing context, when JavaScript code in one browser tab/window trys to deliver a message to another tab/window, web browser locates the target tab/window under the specified domain, and file a MessageEvent&nbsp;(which inherits from DOMEvent) to the target tab/window, so if the target tab/window already subscribed the message event, it will gets notified, eventually the message got delivered through MessageEvent.data.Live DemoI&#39;ve done a demo in my dev machine, I override my local hosts file to let &nbsp;Container.com, DomainA.com, DomainB.com and DomainC.com all point to 127.0.0.1:127.0.1.1 Container.com127.0.0.1 DomainA.com127.0.0.1 DomainB.com127.0.0.1 DomainC.comI prepared a Container page which contains code below: &lt;h3&gt;HTML5 Cross-Domain post message demo&lt;/h3&gt; &lt;p id=&quot;infoBar&quot;&gt;&lt;/p&gt; &lt;div id=&quot;wrapperA&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtA&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;A&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrA&quot; src=&quot;http://DomainA.com/A.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperB&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtB&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;B&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrB&quot; src=&quot;http://DomainB.com/B.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperC&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtC&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;C&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrC&quot; src=&quot;http://DomainC.com/C.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div style=&quot;clear: both&quot;&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; var infoBar = document.getElementById(&quot;infoBar&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; infoBar.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; function postMsgToIfr(domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;A&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrA&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtA&quot;).value, &quot;http://DomainA.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;B&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrB&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtB&quot;).value, &quot;http://DomainB.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;C&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrC&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtC&quot;).value, &quot;http://DomainC.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new error(&quot;No such domain!&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/script&gt;And three pages: A.htm located in DomainA.com,&nbsp;B.htm located in DomainB.com,&nbsp;C.htm located in DomainC.com, phisically they all located under C:\inetpub\wwwrooot, while in the browser I manually type DomainA/B/C.com to make the cheat, the code in the A/B/C page are similar, showing below: &lt;h4&gt;DomainA/A.htm1&lt;/h4&gt; &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;doClick();&quot; /&gt; &lt;div id=&quot;d&quot;&gt; &lt;/div&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; function doClick() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parent.postMessage(&quot;Message sent from &quot; + location.host, &quot;http://container.com&quot;); &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; var d = document.getElementById(&quot;d&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d.innerHTML += &quot;Received message \&quot;&lt;span style=\&quot;color:red\&quot;&gt;&quot; + evt.data + &quot;&lt;/span&gt;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; } &lt;/script&gt;I recorded a gif image below to demonstrate the Cross-Domain messaging:See the message passed through different domain in bi-direction? Isn&#39;t it cool?MessageChannelTo support independent communication under different browsing context, HTML5 introduced&nbsp;Message Channel&nbsp;to post message independently, its official definition is showing below:Communication channels in this mechanisms are implemented as two-ways pipes, with a port at each end. Messages sent in one port are delivered at the other port, and vice-versa. Messages are asynchronous, and delivered as DOM events.&nbsp;I spent about half a day in investigating the Message Channel and finally got it worked, my code is showing below:Container page source code &lt;iframe id=&quot;ifr&quot; src=&quot;http://wayneye.site/WebProjects/HRMS/Opener.html&quot; onload=&quot;initMessaging()&quot;&gt;&lt;/iframe&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;div id=&quot;d&quot;&gt;&lt;/div&gt; &lt;script&gt; var d = document.getElementById(&quot;d&quot;); var channel = new MessageChannel(); channel.port1.onmessage = function (evt) { &nbsp;&nbsp;&nbsp; d.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; };  function initMessaging() { &nbsp;&nbsp;&nbsp; var child = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; child.contentWindow.postMessage(&#39;hello&#39;, &#39;http://wayneye.site&#39;, [channel.port2]); }  function postMsg() { &nbsp;&nbsp;&nbsp; channel.port1.postMessage(&#39;Message sent from &#39; + location.host); } &lt;/script&gt;iframe page source code &lt;div id=&quot;info&quot;&gt;&lt;/div&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;script&gt; var info = document.getElementById(&quot;info&quot;); var port = null; window.addEventListener(&quot;message&quot;, function (e) { console.log(e); &nbsp;&nbsp;&nbsp; if(e.ports &amp;&amp; e.ports.length &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = e.ports[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.start(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.addEventListener(&quot;message&quot;, function (evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.innerHTML += &quot;Received message \&quot;&quot; + evt.data + &quot;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, false); &nbsp;&nbsp;&nbsp; } }, false);  function postMsg() { &nbsp;&nbsp;&nbsp; if(port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.postMessage(&quot;Data sent from &quot; + location.host); &nbsp;&nbsp;&nbsp; } } &lt;/script&gt;The entire process can be described as:Container page (A) embedded an iframe whose src is pointing to a page (B) in different domain.Once the iframe loaded, the container posts a message to page B with a MessagePortArray. &nbsp;Page B received the message as well as the array containing a list of MessagePort objects.Page B registers onmessage event on port instance.Page B invokes port.postmessage to send a message to page A through this MessageChannel.&nbsp;At this timestamp, I seems only Opera correctly supports MessageChannel, Google Chrome and IE10 Platform Preview 2 failed to deliver the ports array, Safari cannot gets the onmessage event fired. Firefox 7.0 beta event doesn&#39;t support MessageChannel object.Note: Ports can also enable communication between HTML5 Web Workers.One more thing (plagiarize Steve Jobs), to use Message Channel one noticable point is, web developer should explicitly close the channel once there is no need, otherwise there will be a strong reference between two pages, as W3 official page emphasized below:Authors are strongly encouraged to explicitly close&nbsp;MessagePort&nbsp;objects to disentangle them, so that their resources can be recollected. Creating many&nbsp;MessagePort&nbsp;objects and discarding them without closing them can lead to high memory usage.Further readingHTML5 Web Messagingwindow.postMessage - MDN DocsHTML5 Demo: postMessage (cross domain)HTML5&prime;s window.postMessage APInternet Explorer 10 Platform Preview: HTML5http://ithelp.ithome.com.tw/question/10057709&nbsp;Also posted on CodeProject:&nbsp;http://www.codeproject.com/KB/HTML/HTML5-WebMessaging.aspx">





  <meta name="twitter:site" content="@wayneye">
  <meta name="twitter:title" content="HTML5 WebMessaging In Essence">
  <meta name="twitter:description" content="Download HTML5_Cross-Domain_WebMessaging_Demo.zip - 2.97 KBAs a web developer, sometimes we are easy to encounter one problem: Cross-Domain communication, conforming Same-Origin-Policy, JavaScript code cannot access code stay in different domain(or sub-domain) or&nbsp;protocol (HTTP/HTTPs) or&nbsp;port, so there was no direct (or I can say: simple) way to achieve Cross-Domain Communication. However, those kinds of requirements does happen: page A and page B are in different domain, &nbsp;B is &quot;embedded&quot; in A, i.e., there is an &quot;iframe&quot; in page A whose &quot;src&quot; is page B&#39;s URL, now page A wants to control page B and vise-versa.&nbsp;By limiting the solution to be done by 100% client JavaScript, beforehand HTML5, there are a number of tricky &quot;hacks&quot;, such as:URL long polling: container page A changes the iframe page B&#39;s URL hash, and B periodically checks the hash, once the hash changed, it takes action according to the contracted hash value. [BTW, the pattern can be revised to be non-polling by HTML5 onchashchange event]CrossFrame, a Safe Communication Mechanism Across Documents and Across Domains.Window Size Monitoring: update the iframe&#39;s window size once, and the containning window subscribes its &quot;onresize&quot; event then takes corresponding action(s). Google Mapplets adopted this pattern.Well, personally I really don&#39;t like all of them... either inelegant, or violates the original functionalities of DOM elements, or too complecated. I believe many people don&#39;t like them too even the pattern inventors I bet... That why WHATWG created Cross-Domain communication in HTML5: Web Messaging.As an HTML5 crazy advocator I like it very much, complete client communication, no server impact, efficient, secure (at least in theory).How to&quot;Child&quot; can be an iframe or an popup window by invocking window.open, &quot;parent page&quot; A contains source code is like below: &lt;iframe id=&quot;ifr&quot; src=&quot;http://domainB.com/B.htm&quot; onload=&quot;sendCommand();&quot;&gt; &nbsp; No frame! &lt;/iframe&gt;  &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;  &nbsp; function sendCommand() { &nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(&quot;Hello&quot;, &quot;http://domainB.com&quot;); &nbsp; } &lt;/script&gt;Notice, make sure post message only when the iframe is loaded, otherwise the contentWindow will be still in same domain with the container page.Child page B contains code like below: &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;sendMsg();&quot; /&gt;  &lt;script&gt; window.addEventListener(&quot;message&quot;, receiveMessage, false);  function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; console.log(&quot;Page B received message from origin: %s.&quot;, evt.origin); &nbsp;&nbsp;&nbsp; console.log(&quot;Event data: %s&quot;, evt.data); &nbsp;&nbsp;&nbsp; //evt.source will be a window who sent the message, it can be used to post message to it &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp; // Take action(s) } &lt;/script&gt;The demo code above is one direction: parent sends message to child (iframe), actually bi-directional message trasfer can also be done, similar with &quot;Parent control child&quot;, child page posts message to container window, only different is call &quot;parent.postMessage&quot;. function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; evt.source.postmessage(&quot;Hello caller&quot;); &nbsp;&nbsp;&nbsp; // or parent.postmessage(&quot;Hello parent&quot;); }Web Messaging EssentialIn a nutshell, HTML5 Web Messaging is a suite of JavaScript API exposed by web browser, to communicate between different&nbsp;browsing context, when JavaScript code in one browser tab/window trys to deliver a message to another tab/window, web browser locates the target tab/window under the specified domain, and file a MessageEvent&nbsp;(which inherits from DOMEvent) to the target tab/window, so if the target tab/window already subscribed the message event, it will gets notified, eventually the message got delivered through MessageEvent.data.Live DemoI&#39;ve done a demo in my dev machine, I override my local hosts file to let &nbsp;Container.com, DomainA.com, DomainB.com and DomainC.com all point to 127.0.0.1:127.0.1.1 Container.com127.0.0.1 DomainA.com127.0.0.1 DomainB.com127.0.0.1 DomainC.comI prepared a Container page which contains code below: &lt;h3&gt;HTML5 Cross-Domain post message demo&lt;/h3&gt; &lt;p id=&quot;infoBar&quot;&gt;&lt;/p&gt; &lt;div id=&quot;wrapperA&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtA&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;A&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrA&quot; src=&quot;http://DomainA.com/A.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperB&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtB&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;B&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrB&quot; src=&quot;http://DomainB.com/B.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperC&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtC&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;C&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrC&quot; src=&quot;http://DomainC.com/C.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div style=&quot;clear: both&quot;&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; var infoBar = document.getElementById(&quot;infoBar&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; infoBar.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; function postMsgToIfr(domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;A&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrA&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtA&quot;).value, &quot;http://DomainA.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;B&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrB&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtB&quot;).value, &quot;http://DomainB.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;C&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrC&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtC&quot;).value, &quot;http://DomainC.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new error(&quot;No such domain!&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/script&gt;And three pages: A.htm located in DomainA.com,&nbsp;B.htm located in DomainB.com,&nbsp;C.htm located in DomainC.com, phisically they all located under C:\inetpub\wwwrooot, while in the browser I manually type DomainA/B/C.com to make the cheat, the code in the A/B/C page are similar, showing below: &lt;h4&gt;DomainA/A.htm1&lt;/h4&gt; &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;doClick();&quot; /&gt; &lt;div id=&quot;d&quot;&gt; &lt;/div&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; function doClick() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parent.postMessage(&quot;Message sent from &quot; + location.host, &quot;http://container.com&quot;); &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; var d = document.getElementById(&quot;d&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d.innerHTML += &quot;Received message \&quot;&lt;span style=\&quot;color:red\&quot;&gt;&quot; + evt.data + &quot;&lt;/span&gt;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; } &lt;/script&gt;I recorded a gif image below to demonstrate the Cross-Domain messaging:See the message passed through different domain in bi-direction? Isn&#39;t it cool?MessageChannelTo support independent communication under different browsing context, HTML5 introduced&nbsp;Message Channel&nbsp;to post message independently, its official definition is showing below:Communication channels in this mechanisms are implemented as two-ways pipes, with a port at each end. Messages sent in one port are delivered at the other port, and vice-versa. Messages are asynchronous, and delivered as DOM events.&nbsp;I spent about half a day in investigating the Message Channel and finally got it worked, my code is showing below:Container page source code &lt;iframe id=&quot;ifr&quot; src=&quot;http://wayneye.site/WebProjects/HRMS/Opener.html&quot; onload=&quot;initMessaging()&quot;&gt;&lt;/iframe&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;div id=&quot;d&quot;&gt;&lt;/div&gt; &lt;script&gt; var d = document.getElementById(&quot;d&quot;); var channel = new MessageChannel(); channel.port1.onmessage = function (evt) { &nbsp;&nbsp;&nbsp; d.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; };  function initMessaging() { &nbsp;&nbsp;&nbsp; var child = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; child.contentWindow.postMessage(&#39;hello&#39;, &#39;http://wayneye.site&#39;, [channel.port2]); }  function postMsg() { &nbsp;&nbsp;&nbsp; channel.port1.postMessage(&#39;Message sent from &#39; + location.host); } &lt;/script&gt;iframe page source code &lt;div id=&quot;info&quot;&gt;&lt;/div&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;script&gt; var info = document.getElementById(&quot;info&quot;); var port = null; window.addEventListener(&quot;message&quot;, function (e) { console.log(e); &nbsp;&nbsp;&nbsp; if(e.ports &amp;&amp; e.ports.length &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = e.ports[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.start(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.addEventListener(&quot;message&quot;, function (evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.innerHTML += &quot;Received message \&quot;&quot; + evt.data + &quot;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, false); &nbsp;&nbsp;&nbsp; } }, false);  function postMsg() { &nbsp;&nbsp;&nbsp; if(port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.postMessage(&quot;Data sent from &quot; + location.host); &nbsp;&nbsp;&nbsp; } } &lt;/script&gt;The entire process can be described as:Container page (A) embedded an iframe whose src is pointing to a page (B) in different domain.Once the iframe loaded, the container posts a message to page B with a MessagePortArray. &nbsp;Page B received the message as well as the array containing a list of MessagePort objects.Page B registers onmessage event on port instance.Page B invokes port.postmessage to send a message to page A through this MessageChannel.&nbsp;At this timestamp, I seems only Opera correctly supports MessageChannel, Google Chrome and IE10 Platform Preview 2 failed to deliver the ports array, Safari cannot gets the onmessage event fired. Firefox 7.0 beta event doesn&#39;t support MessageChannel object.Note: Ports can also enable communication between HTML5 Web Workers.One more thing (plagiarize Steve Jobs), to use Message Channel one noticable point is, web developer should explicitly close the channel once there is no need, otherwise there will be a strong reference between two pages, as W3 official page emphasized below:Authors are strongly encouraged to explicitly close&nbsp;MessagePort&nbsp;objects to disentangle them, so that their resources can be recollected. Creating many&nbsp;MessagePort&nbsp;objects and discarding them without closing them can lead to high memory usage.Further readingHTML5 Web Messagingwindow.postMessage - MDN DocsHTML5 Demo: postMessage (cross domain)HTML5&prime;s window.postMessage APInternet Explorer 10 Platform Preview: HTML5http://ithelp.ithome.com.tw/question/10057709&nbsp;Also posted on CodeProject:&nbsp;http://www.codeproject.com/KB/HTML/HTML5-WebMessaging.aspx">
  <meta name="twitter:url" content="https://wayneye.site/HTML5-WebMessaging-In-Essence">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2011-08-30T00:00:00-07:00">






<link rel="canonical" href="https://wayneye.site/HTML5-WebMessaging-In-Essence">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Wayne's Geek Life Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">Wayne's Geek Life</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/search/" >Search</a>
            </li><li class="masthead__menu-item">
              <a href="/gallery/" >Gallery</a>
            </li><li class="masthead__menu-item">
              <a href="/vlog/" >Vlog</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/me.jpg" alt="Wayne Ye" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Wayne Ye</h3>
    
    
      <p class="author__bio" itemprop="description">
        Whatever is worth doing is worth doing well!
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco</span>
        </li>
      

      
        
          
            <li><a href="mailto:hi@wayneye.site" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://wayneye.site" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://github.com/WayneYe/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://twitter.com/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="HTML5 WebMessaging In Essence">
    <meta itemprop="description" content="Download HTML5_Cross-Domain_WebMessaging_Demo.zip - 2.97 KBAs a web developer, sometimes we are easy to encounter one problem: Cross-Domain communication, conforming Same-Origin-Policy, JavaScript code cannot access code stay in different domain(or sub-domain) or&nbsp;protocol (HTTP/HTTPs) or&nbsp;port, so there was no direct (or I can say: simple) way to achieve Cross-Domain Communication. However, those kinds of requirements does happen: page A and page B are in different domain, &nbsp;B is &quot;embedded&quot; in A, i.e., there is an &quot;iframe&quot; in page A whose &quot;src&quot; is page B&#39;s URL, now page A wants to control page B and vise-versa.&nbsp;By limiting the solution to be done by 100% client JavaScript, beforehand HTML5, there are a number of tricky &quot;hacks&quot;, such as:URL long polling: container page A changes the iframe page B&#39;s URL hash, and B periodically checks the hash, once the hash changed, it takes action according to the contracted hash value. [BTW, the pattern can be revised to be non-polling by HTML5 onchashchange event]CrossFrame, a Safe Communication Mechanism Across Documents and Across Domains.Window Size Monitoring: update the iframe&#39;s window size once, and the containning window subscribes its &quot;onresize&quot; event then takes corresponding action(s). Google Mapplets adopted this pattern.Well, personally I really don&#39;t like all of them... either inelegant, or violates the original functionalities of DOM elements, or too complecated. I believe many people don&#39;t like them too even the pattern inventors I bet... That why WHATWG created Cross-Domain communication in HTML5: Web Messaging.As an HTML5 crazy advocator I like it very much, complete client communication, no server impact, efficient, secure (at least in theory).How to&quot;Child&quot; can be an iframe or an popup window by invocking window.open, &quot;parent page&quot; A contains source code is like below: &lt;iframe id=&quot;ifr&quot; src=&quot;http://domainB.com/B.htm&quot; onload=&quot;sendCommand();&quot;&gt; &nbsp; No frame! &lt;/iframe&gt;  &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;  &nbsp; function sendCommand() { &nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(&quot;Hello&quot;, &quot;http://domainB.com&quot;); &nbsp; } &lt;/script&gt;Notice, make sure post message only when the iframe is loaded, otherwise the contentWindow will be still in same domain with the container page.Child page B contains code like below: &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;sendMsg();&quot; /&gt;  &lt;script&gt; window.addEventListener(&quot;message&quot;, receiveMessage, false);  function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; console.log(&quot;Page B received message from origin: %s.&quot;, evt.origin); &nbsp;&nbsp;&nbsp; console.log(&quot;Event data: %s&quot;, evt.data); &nbsp;&nbsp;&nbsp; //evt.source will be a window who sent the message, it can be used to post message to it &nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp; // Take action(s) } &lt;/script&gt;The demo code above is one direction: parent sends message to child (iframe), actually bi-directional message trasfer can also be done, similar with &quot;Parent control child&quot;, child page posts message to container window, only different is call &quot;parent.postMessage&quot;. function receiveMessage(evt) { &nbsp;&nbsp;&nbsp; evt.source.postmessage(&quot;Hello caller&quot;); &nbsp;&nbsp;&nbsp; // or parent.postmessage(&quot;Hello parent&quot;); }Web Messaging EssentialIn a nutshell, HTML5 Web Messaging is a suite of JavaScript API exposed by web browser, to communicate between different&nbsp;browsing context, when JavaScript code in one browser tab/window trys to deliver a message to another tab/window, web browser locates the target tab/window under the specified domain, and file a MessageEvent&nbsp;(which inherits from DOMEvent) to the target tab/window, so if the target tab/window already subscribed the message event, it will gets notified, eventually the message got delivered through MessageEvent.data.Live DemoI&#39;ve done a demo in my dev machine, I override my local hosts file to let &nbsp;Container.com, DomainA.com, DomainB.com and DomainC.com all point to 127.0.0.1:127.0.1.1 Container.com127.0.0.1 DomainA.com127.0.0.1 DomainB.com127.0.0.1 DomainC.comI prepared a Container page which contains code below: &lt;h3&gt;HTML5 Cross-Domain post message demo&lt;/h3&gt; &lt;p id=&quot;infoBar&quot;&gt;&lt;/p&gt; &lt;div id=&quot;wrapperA&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtA&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;A&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrA&quot; src=&quot;http://DomainA.com/A.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperB&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtB&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;B&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrB&quot; src=&quot;http://DomainB.com/B.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div id=&quot;wrapperC&quot;&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;text&quot; id=&quot;txtC&quot; /&gt;&lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsgToIfr(&#39;C&#39;);&quot; /&gt; &nbsp;&nbsp;&nbsp; &lt;br /&gt; &nbsp;&nbsp;&nbsp; &lt;iframe id=&quot;ifrC&quot; src=&quot;http://DomainC.com/C.htm&quot;&gt;&lt;/iframe&gt; &lt;/div&gt; &lt;div style=&quot;clear: both&quot;&gt; &lt;/div&gt; &lt;script type=&quot;text/javascript&quot;&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; var infoBar = document.getElementById(&quot;infoBar&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; infoBar.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; function postMsgToIfr(domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; switch (domain) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;A&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrA&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtA&quot;).value, &quot;http://DomainA.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;B&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrB&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtB&quot;).value, &quot;http://DomainB.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case &quot;C&quot;: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var ifr = document.getElementById(&quot;ifrC&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifr.contentWindow.postMessage(document.getElementById(&quot;txtC&quot;).value, &quot;http://DomainC.com&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new error(&quot;No such domain!&quot;); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  &lt;/script&gt;And three pages: A.htm located in DomainA.com,&nbsp;B.htm located in DomainB.com,&nbsp;C.htm located in DomainC.com, phisically they all located under C:\inetpub\wwwrooot, while in the browser I manually type DomainA/B/C.com to make the cheat, the code in the A/B/C page are similar, showing below: &lt;h4&gt;DomainA/A.htm1&lt;/h4&gt; &lt;input type=&quot;button&quot; value=&quot;Cross domain call&quot; onclick=&quot;doClick();&quot; /&gt; &lt;div id=&quot;d&quot;&gt; &lt;/div&gt; &lt;script&gt; &nbsp;&nbsp;&nbsp; window.addEventListener(&quot;message&quot;, receiveMessage, false);  &nbsp;&nbsp;&nbsp; function doClick() { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parent.postMessage(&quot;Message sent from &quot; + location.host, &quot;http://container.com&quot;); &nbsp;&nbsp;&nbsp; }  &nbsp;&nbsp;&nbsp; var d = document.getElementById(&quot;d&quot;); &nbsp;&nbsp;&nbsp; function receiveMessage(evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d.innerHTML += &quot;Received message \&quot;&lt;span style=\&quot;color:red\&quot;&gt;&quot; + evt.data + &quot;&lt;/span&gt;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp; } &lt;/script&gt;I recorded a gif image below to demonstrate the Cross-Domain messaging:See the message passed through different domain in bi-direction? Isn&#39;t it cool?MessageChannelTo support independent communication under different browsing context, HTML5 introduced&nbsp;Message Channel&nbsp;to post message independently, its official definition is showing below:Communication channels in this mechanisms are implemented as two-ways pipes, with a port at each end. Messages sent in one port are delivered at the other port, and vice-versa. Messages are asynchronous, and delivered as DOM events.&nbsp;I spent about half a day in investigating the Message Channel and finally got it worked, my code is showing below:Container page source code &lt;iframe id=&quot;ifr&quot; src=&quot;http://wayneye.site/WebProjects/HRMS/Opener.html&quot; onload=&quot;initMessaging()&quot;&gt;&lt;/iframe&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;div id=&quot;d&quot;&gt;&lt;/div&gt; &lt;script&gt; var d = document.getElementById(&quot;d&quot;); var channel = new MessageChannel(); channel.port1.onmessage = function (evt) { &nbsp;&nbsp;&nbsp; d.innerHTML += evt.origin + &quot;: &quot; + evt.data + &quot;&lt;br /&gt;&quot;; };  function initMessaging() { &nbsp;&nbsp;&nbsp; var child = document.getElementById(&quot;ifr&quot;); &nbsp;&nbsp;&nbsp; child.contentWindow.postMessage(&#39;hello&#39;, &#39;http://wayneye.site&#39;, [channel.port2]); }  function postMsg() { &nbsp;&nbsp;&nbsp; channel.port1.postMessage(&#39;Message sent from &#39; + location.host); } &lt;/script&gt;iframe page source code &lt;div id=&quot;info&quot;&gt;&lt;/div&gt; &lt;input type=&quot;button&quot; value=&quot;Post Message&quot; onclick=&quot;postMsg();&quot; /&gt; &lt;script&gt; var info = document.getElementById(&quot;info&quot;); var port = null; window.addEventListener(&quot;message&quot;, function (e) { console.log(e); &nbsp;&nbsp;&nbsp; if(e.ports &amp;&amp; e.ports.length &gt; 0) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port = e.ports[0]; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.start(); &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.addEventListener(&quot;message&quot;, function (evt) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; info.innerHTML += &quot;Received message \&quot;&quot; + evt.data + &quot;\&quot; from domain: &quot; + evt.origin + &quot;&lt;br /&gt;&quot;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, false); &nbsp;&nbsp;&nbsp; } }, false);  function postMsg() { &nbsp;&nbsp;&nbsp; if(port) { &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port.postMessage(&quot;Data sent from &quot; + location.host); &nbsp;&nbsp;&nbsp; } } &lt;/script&gt;The entire process can be described as:Container page (A) embedded an iframe whose src is pointing to a page (B) in different domain.Once the iframe loaded, the container posts a message to page B with a MessagePortArray. &nbsp;Page B received the message as well as the array containing a list of MessagePort objects.Page B registers onmessage event on port instance.Page B invokes port.postmessage to send a message to page A through this MessageChannel.&nbsp;At this timestamp, I seems only Opera correctly supports MessageChannel, Google Chrome and IE10 Platform Preview 2 failed to deliver the ports array, Safari cannot gets the onmessage event fired. Firefox 7.0 beta event doesn&#39;t support MessageChannel object.Note: Ports can also enable communication between HTML5 Web Workers.One more thing (plagiarize Steve Jobs), to use Message Channel one noticable point is, web developer should explicitly close the channel once there is no need, otherwise there will be a strong reference between two pages, as W3 official page emphasized below:Authors are strongly encouraged to explicitly close&nbsp;MessagePort&nbsp;objects to disentangle them, so that their resources can be recollected. Creating many&nbsp;MessagePort&nbsp;objects and discarding them without closing them can lead to high memory usage.Further readingHTML5 Web Messagingwindow.postMessage - MDN DocsHTML5 Demo: postMessage (cross domain)HTML5&prime;s window.postMessage APInternet Explorer 10 Platform Preview: HTML5http://ithelp.ithome.com.tw/question/10057709&nbsp;Also posted on CodeProject:&nbsp;http://www.codeproject.com/KB/HTML/HTML5-WebMessaging.aspx">
    <meta itemprop="datePublished" content="August 30, 2011">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">HTML5 WebMessaging In Essence
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#">How to</a></li>
  <li><a href="#">Web Messaging Essential</a></li>
  <li><a href="#">Live Demo</a></li>
  <li><a href="#">MessageChannel</a>
    <ul>
      <li><a href="#">Container page source code</a></li>
      <li><a href="#">iframe page source code</a></li>
    </ul>
  </li>
  <li><a href="#">Further reading</a></li>
</ul>
            </nav>
          </aside>
        
        <p><a href="http://www.codeproject.com/KB/HTML/HTML5-WebMessaging/HTML5_Cross-Domain_WebMessaging_Demo.zip">Download HTML5_Cross-Domain_WebMessaging_Demo.zip - 2.97 KB</a></p>
<p>As a web developer, sometimes we are easy to encounter one problem:<strong> Cross-Domain communication</strong>, conforming <a title="Same-Origin-Policy" href="http://en.wikipedia.org/wiki/Same_origin_policy" target="_blank">Same-Origin-Policy</a>, JavaScript code cannot access code stay in different <strong>domain</strong>(or sub-domain) or&nbsp;<strong>protocol </strong>(HTTP/HTTPs) or&nbsp;<strong>port</strong>, so there was no direct (or I can say: simple) way to achieve Cross-Domain Communication. However, those kinds of requirements does happen: page A and page B are in different domain, &nbsp;B is "embedded" in A, i.e., there is an "iframe" in page A whose "src" is page B's URL, now page A wants to control page B and vise-versa.&nbsp;</p>
<p>By limiting the solution to be done by 100% client JavaScript, beforehand HTML5, there are a number of tricky "hacks", such as:</p>
<ol>
<li>URL long polling: container page A changes the iframe page B's URL hash, and B periodically checks the hash, once the hash changed, it takes action according to the contracted hash value. [BTW, the pattern can be revised to be non-polling by HTML5 <a title="onhashchange event" href="http://www.w3.org/TR/html5/history.html#event-hashchange" target="_blank">onchashchange event</a>]</li>
<li><a title="CrossFrame" href="http://www.julienlecomte.net/blog/2007/11/31/" target="_blank">CrossFrame</a>, a Safe Communication Mechanism Across Documents and Across Domains.</li>
<li>Window Size Monitoring: update the iframe's window size once, and the containning window subscribes its "onresize" event then takes corresponding action(s). <a title="Google Mapplets" href="http://code.google.com/apis/maps/documentation/mapplets/basics.html" target="_blank">Google Mapplets</a> adopted this pattern.</li>
</ol>
<p>Well, personally I really don't like all of them... either inelegant, or violates the original functionalities of DOM elements, or too complecated. I believe many people don't like them too even the pattern inventors I bet... That why WHATWG created Cross-Domain communication in HTML5: <strong><a href="http://www.w3.org/TR/webmessaging" target="_blank">Web Messaging</a></strong>.</p>
<p>As an HTML5 crazy advocator I like it very much, complete client communication, no server impact, efficient, secure (at least in theory).</p>
<h3>How to</h3>
<p>"Child" can be an iframe or an popup window by invocking window.open, "parent page" A contains source code is like below:</p>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #e3ceab;">&lt;iframe</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"ifr"</span> <span style="color: #efef8f;">src=</span><span style="color: #cc9393;">"http://domainB.com/B.htm" onload="sendCommand();"</span><span style="color: #e3ceab;">&gt;</span><br /> &nbsp; No frame!<br /> <span style="color: #e3ceab;">&lt;/iframe&gt;</span><br /> <br /> <span style="color: #e3ceab;">&lt;script </span><span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"text/javascript"</span><span style="color: #e3ceab;">&gt;</span> &nbsp; <br /> &nbsp; <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">sendCommand</span>() <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">ifr</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"ifr"</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">ifr</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">contentWindow</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #cc9393;">"Hello"</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">"http://domainB.com"</span>);<br /> &nbsp; <span style="color: #dcdccc;">}</span><br /> <span style="color: #e3ceab;">&lt;/script&gt;</span></pre>
<blockquote>
<p>Notice, make sure post message <strong>only when the iframe is loaded</strong>, otherwise the contentWindow will be still in same domain with the container page.</p>
</blockquote>
<p>Child page B contains code like below:</p>
<pre class="source" style="font-family: Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Cross domain call"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"sendMsg();"</span> <span style="color: #e3ceab;">/&gt;</span><br /> <br /> <span style="color: #e3ceab;">&lt;script&gt;</span><br /> <span style="color: #f0dfaf; font-weight: bold;">window</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">addEventListener</span>(<span style="color: #cc9393;">"message"</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">receiveMessage</span><span style="color: #dcdccc;">,</span> <span style="color: #e3ceab;">false</span>);<br /> <br /> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">receiveMessage</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">"Page B received message from origin: %s."</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">origin</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #cc9393;">"Event data: %s"</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #7f9f7f;">//evt.source will be a window who sent the message, it can be used to post message to it</span><br /> &nbsp;&nbsp;&nbsp; <br /> &nbsp;&nbsp;&nbsp; <span style="color: #7f9f7f;">// Take action(s)</span><br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #e3ceab;">&lt;/script&gt;</span></pre>
<p>The demo code above is one direction: parent sends message to child (iframe), actually bi-directional message trasfer can also be done, similar with "Parent control child", child page posts message to container window, only different is call "<code>parent.postMessage</code>".</p>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">receiveMessage</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">source</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postmessage</span>(<span style="color: #cc9393;">"Hello caller"</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #7f9f7f;">// or parent.postmessage("Hello parent");</span><br /> <span style="color: #dcdccc;">}</span></pre>
<h3>Web Messaging Essential</h3>
<p>In a nutshell, HTML5 Web Messaging is a suite of JavaScript API exposed by web browser, to communicate between different&nbsp;<a title="Browsing context" href="http://www.w3.org/TR/html5/browsers.html#browsing-context" target="_blank">browsing context</a>, when JavaScript code in one browser tab/window trys to deliver a message to another tab/window, web browser locates the target tab/window under the specified domain, and file a <a href="http://www.w3.org/TR/webmessaging/#messageevent" target="_blank">MessageEvent</a>&nbsp;(which inherits from DOMEvent) to the target tab/window, so if the target tab/window already subscribed the message event, it will gets notified, eventually the message got delivered through <code>MessageEvent.data</code>.</p>
<h3>Live Demo</h3>
<p>I've done a demo in my dev machine, I override my local hosts file to let &nbsp;Container.com, DomainA.com, DomainB.com and DomainC.com all point to 127.0.0.1:</p>
<blockquote><strong>127.0.1.1 Container.com<br />127.0.0.1 DomainA.com</strong><br /><strong>127.0.0.1 DomainB.com</strong><br /><strong>127.0.0.1 DomainC.com</strong></blockquote>
<p>I prepared a Container page which contains code below:</p>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #e3ceab;">&lt;h3&gt;</span>HTML5 Cross-Domain post message demo<span style="color: #e3ceab;">&lt;/h3&gt;</span><br /> <span style="color: #e3ceab;">&lt;p</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"infoBar"</span><span style="color: #e3ceab;">&gt;&lt;/p&gt;</span><br /> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"wrapperA"</span><span style="color: #e3ceab;">&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"text"</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"txtA"</span> <span style="color: #e3ceab;">/&gt;&lt;br</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Post Message"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"postMsgToIfr('A');"</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;br</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;iframe</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"ifrA"</span> <span style="color: #efef8f;">src=</span><span style="color: #cc9393;">"http://DomainA.com/A.htm"</span><span style="color: #e3ceab;">&gt;&lt;/iframe&gt;</span><br /> <span style="color: #e3ceab;">&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"wrapperB"</span><span style="color: #e3ceab;">&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"text"</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"txtB"</span> <span style="color: #e3ceab;">/&gt;&lt;br</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Post Message"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"postMsgToIfr('B');"</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;br</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;iframe</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"ifrB"</span> <span style="color: #efef8f;">src=</span><span style="color: #cc9393;">"http://DomainB.com/B.htm"</span><span style="color: #e3ceab;">&gt;&lt;/iframe&gt;</span><br /> <span style="color: #e3ceab;">&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"wrapperC"</span><span style="color: #e3ceab;">&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"text"</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"txtC"</span> <span style="color: #e3ceab;">/&gt;&lt;br</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Post Message"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"postMsgToIfr('C');"</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;br</span> <span style="color: #e3ceab;">/&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">&lt;iframe</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"ifrC"</span> <span style="color: #efef8f;">src=</span><span style="color: #cc9393;">"http://DomainC.com/C.htm"</span><span style="color: #e3ceab;">&gt;&lt;/iframe&gt;</span><br /> <span style="color: #e3ceab;">&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">style=</span><span style="color: #cc9393;">"clear: both"</span><span style="color: #e3ceab;">&gt;</span><br /> <span style="color: #e3ceab;">&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;script </span><span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"text/javascript"</span><span style="color: #e3ceab;">&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #f0dfaf; font-weight: bold;">window</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">addEventListener</span>(<span style="color: #cc9393;">"message"</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">receiveMessage</span><span style="color: #dcdccc;">,</span> <span style="color: #e3ceab;">false</span>);<br /> <br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">infoBar</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"infoBar"</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">receiveMessage</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">infoBar</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">innerHTML</span> <span style="color: #dcdccc;">+=</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">origin</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">": "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">"&lt;br /&gt;"</span>;<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span><br /> <br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">postMsgToIfr</span>(<span style="color: #dcdccc;">domain</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">switch</span> (<span style="color: #dcdccc;">domain</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">case</span> <span style="color: #cc9393;">"A"</span><span style="color: #dcdccc;">:</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">ifr</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"ifrA"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">ifr</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">contentWindow</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"txtA"</span><span style="color: #dcdccc;">).</span><span style="color: #dcdccc;">value</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">"http://DomainA.com"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">break</span>;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">case</span> <span style="color: #cc9393;">"B"</span><span style="color: #dcdccc;">:</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">ifr</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"ifrB"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">ifr</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">contentWindow</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"txtB"</span><span style="color: #dcdccc;">).</span><span style="color: #dcdccc;">value</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">"http://DomainB.com"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">break</span>;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">case</span> <span style="color: #cc9393;">"C"</span><span style="color: #dcdccc;">:</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">ifr</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"ifrC"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">ifr</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">contentWindow</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"txtC"</span><span style="color: #dcdccc;">).</span><span style="color: #dcdccc;">value</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">"http://DomainC.com"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">break</span>;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">default</span><span style="color: #dcdccc;">:</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">throw</span> <span style="color: #e3ceab;">new</span> <span style="color: #dcdccc;">error</span>(<span style="color: #cc9393;">"No such domain!"</span>);<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /> <span style="color: #e3ceab;">&lt;/script&gt;</span></pre>
<p>And three pages: A.htm located in DomainA.com,&nbsp;B.htm located in DomainB.com,&nbsp;C.htm located in DomainC.com, phisically they all located under C:\inetpub\wwwrooot, while in the browser I manually type DomainA/B/C.com to make the cheat<img style="background-image: url('http://wayneye.com/Images/winLiveEmotions.gif'); background-position: -0px -0px; width: 19px; height: 19px;" src="http://wayneye.com/Images/invis.gif" alt="Smile" />, the code in the A/B/C page are similar, showing below:</p>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #e3ceab;">&lt;h4&gt;</span>DomainA/A.htm1<span style="color: #e3ceab;">&lt;/h4&gt;</span><br /> <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Cross domain call"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"doClick();"</span> <span style="color: #e3ceab;">/&gt;</span><br /> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"d"</span><span style="color: #e3ceab;">&gt;</span><br /> <span style="color: #e3ceab;">&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;script&gt;</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #f0dfaf; font-weight: bold;">window</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">addEventListener</span>(<span style="color: #cc9393;">"message"</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">receiveMessage</span><span style="color: #dcdccc;">,</span> <span style="color: #e3ceab;">false</span>);<br /> <br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">doClick</span>() <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">parent</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #cc9393;">"Message sent from "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">location</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">host</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">"http://container.com"</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span><br /> <br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">d</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"d"</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">receiveMessage</span>(<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">d</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">innerHTML</span> <span style="color: #dcdccc;">+=</span> <span style="color: #cc9393;">"Received message \"&lt;span style=\"color:red\"&gt;"</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">"&lt;/span&gt;\" from domain: "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">origin</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">"&lt;br /&gt;"</span>;<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span><br /> <span style="color: #e3ceab;">&lt;/script&gt;</span></pre>
<p>I recorded a gif image below to demonstrate the Cross-Domain messaging:</p>
<p><img title="HTML5 Cross-Domain Messaging Demo" src="http://ww2.sinaimg.cn/large/76a6d6a2gw1dkq13gnv6ig.gif" alt="HTML5 Cross-Domain Messaging Demo" width="567" height="382" /></p>
<p>See the message passed through different domain in bi-direction? Isn't it cool?</p>
<h3>MessageChannel</h3>
<p>To support independent communication under different <a title="Browsing context" href="http://www.w3.org/TR/html5/browsers.html#browsing-context" target="_blank">browsing context</a>, HTML5 introduced&nbsp;<strong><a title="Message Channel" href="http://www.w3.org/TR/html5/comms.html#message-channels">Message Channel</a></strong>&nbsp;to post message independently, its official definition is showing below:</p>
<blockquote>
<p>Communication channels in this mechanisms are implemented as two-ways pipes, with a port at each end. Messages sent in one port are delivered at the other port, and vice-versa. Messages are asynchronous, and delivered as DOM events.&nbsp;</p>
</blockquote>
<p>I spent about half a day in investigating the Message Channel and finally got it worked, my code is showing below:</p>
<h4>Container page source code</h4>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #e3ceab;">&lt;iframe</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"ifr"</span> <span style="color: #efef8f;">src=</span><span style="color: #cc9393;">"http://wayneye.site/WebProjects/HRMS/Opener.html"</span> <span style="color: #efef8f;">onload=</span><span style="color: #cc9393;">"initMessaging()"</span><span style="color: #e3ceab;">&gt;&lt;/iframe&gt;</span><br /> <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Post Message"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"postMsg();"</span> <span style="color: #e3ceab;">/&gt;</span><br /> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"d"</span><span style="color: #e3ceab;">&gt;&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;script&gt;</span><br /> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">d</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"d"</span>);<br /> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">channel</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">new</span> <span style="color: #dcdccc;">MessageChannel</span>();<br /> <span style="color: #dcdccc;">channel</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">port1</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">onmessage</span> <span style="color: #dcdccc;">=</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">d</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">innerHTML</span> <span style="color: #dcdccc;">+=</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">origin</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">": "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">"&lt;br /&gt;"</span>;<br /> <span style="color: #dcdccc;">};</span><br /> <br /> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">initMessaging</span>() <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">child</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"ifr"</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">child</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">contentWindow</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #cc9393;">'hello'</span><span style="color: #dcdccc;">,</span> <span style="color: #cc9393;">'http://wayneye.site'</span><span style="color: #dcdccc;">,</span> <span style="color: #dcdccc;">[</span><span style="color: #dcdccc;">channel</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">port2</span><span style="color: #dcdccc;">]);</span><br /> <span style="color: #dcdccc;">}</span><br /> <br /> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">postMsg</span>() <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">channel</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">port1</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #cc9393;">'Message sent from '</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">location</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">host</span>);<br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #e3ceab;">&lt;/script&gt;</span></pre>
<h4>iframe page source code</h4>
<pre class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #dcdccc; background-color: #3f3f3f;"> <span style="color: #e3ceab;">&lt;div</span> <span style="color: #efef8f;">id=</span><span style="color: #cc9393;">"info"</span><span style="color: #e3ceab;">&gt;&lt;/div&gt;</span><br /> <span style="color: #e3ceab;">&lt;input</span> <span style="color: #efef8f;">type=</span><span style="color: #cc9393;">"button"</span> <span style="color: #efef8f;">value=</span><span style="color: #cc9393;">"Post Message"</span> <span style="color: #efef8f;">onclick=</span><span style="color: #cc9393;">"postMsg();"</span> <span style="color: #e3ceab;">/&gt;</span><br /> <span style="color: #e3ceab;">&lt;script&gt;</span><br /> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">info</span> <span style="color: #dcdccc;">=</span> <span style="color: #f0dfaf; font-weight: bold;">document</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">getElementById</span>(<span style="color: #cc9393;">"info"</span>);<br /> <span style="color: #efefaf; font-weight: bold;">var</span> <span style="color: #dcdccc;">port</span> <span style="color: #dcdccc;">=</span> <span style="color: #e3ceab;">null</span>;<br /> <span style="color: #f0dfaf; font-weight: bold;">window</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">addEventListener</span>(<span style="color: #cc9393;">"message"</span><span style="color: #dcdccc;">,</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">e</span>) <span style="color: #dcdccc;">{</span><br /> <span style="color: #dcdccc;">console</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">log</span>(<span style="color: #dcdccc;">e</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">if</span>(<span style="color: #dcdccc;">e</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ports</span> <span style="color: #dcdccc;">&amp;&amp;</span> <span style="color: #dcdccc;">e</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ports</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">length</span> <span style="color: #dcdccc;">&gt;</span> <span style="color: #8cd0d3;">0</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">port</span> <span style="color: #dcdccc;">=</span> <span style="color: #dcdccc;">e</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">ports</span><span style="color: #dcdccc;">[</span><span style="color: #8cd0d3;">0</span><span style="color: #dcdccc;">];</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">port</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">start</span>();<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">port</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">addEventListener</span>(<span style="color: #cc9393;">"message"</span><span style="color: #dcdccc;">,</span> <span style="color: #efefaf; font-weight: bold;">function</span> (<span style="color: #dcdccc;">evt</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">info</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">innerHTML</span> <span style="color: #dcdccc;">+=</span> <span style="color: #cc9393;">"Received message \""</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">data</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">"\" from domain: "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">evt</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">origin</span> <span style="color: #dcdccc;">+</span> <span style="color: #cc9393;">"&lt;br /&gt;"</span>;<br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">},</span> <span style="color: #e3ceab;">false</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span><br /> <span style="color: #dcdccc;">},</span> <span style="color: #e3ceab;">false</span>);<br /> <br /> <span style="color: #efefaf; font-weight: bold;">function</span> <span style="color: #dcdccc;">postMsg</span>() <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp; <span style="color: #e3ceab;">if</span>(<span style="color: #dcdccc;">port</span>) <span style="color: #dcdccc;">{</span><br /> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">port</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">postMessage</span>(<span style="color: #cc9393;">"Data sent from "</span> <span style="color: #dcdccc;">+</span> <span style="color: #dcdccc;">location</span><span style="color: #dcdccc;">.</span><span style="color: #dcdccc;">host</span>);<br /> &nbsp;&nbsp;&nbsp; <span style="color: #dcdccc;">}</span><br /> <span style="color: #dcdccc;">}</span><br /> <span style="color: #e3ceab;">&lt;/script&gt;</span></pre>
<p>The entire process can be described as:</p>
<ol>
<li>Container page (A) embedded an iframe whose src is pointing to a page (B) in different domain.</li>
<li>Once the iframe loaded, the container posts a message to page B with a <a title="MessagePortArray" href="http://www.w3.org/TR/webmessaging/#messageportarray" target="_blank">MessagePortArray</a>. &nbsp;</li>
<li>Page B received the message as well as the array containing a list of MessagePort objects.</li>
<li>Page B registers onmessage event on port instance.</li>
<li>Page B invokes <code>port.postmessage</code> to send a message to page A through this MessageChannel.&nbsp;</li>
</ol>
<blockquote>At this timestamp, I seems only Opera correctly supports MessageChannel, Google Chrome and IE10 Platform Preview 2 failed to deliver the ports array, Safari cannot gets the onmessage event fired. Firefox 7.0 beta event doesn't support MessageChannel object.</blockquote>
<blockquote>Note: Ports can also enable communication between HTML5 Web Workers.</blockquote>
<p>One more thing (plagiarize Steve Jobs<img style="background-image: url('http://wayneye.com/Images/winLiveEmotions.gif'); background-position: -0px -0px; width: 19px; height: 19px;" src="http://wayneye.com/Images/invis.gif" alt="Smile" />), to use Message Channel one noticable point is, web developer should explicitly close the channel once there is no need, otherwise there will be a strong reference between two pages, as W3 official page emphasized below:</p>
<blockquote>
<p>Authors are strongly encouraged to explicitly close&nbsp;<code>MessagePort</code>&nbsp;objects to disentangle them, so that their resources can be recollected. Creating many&nbsp;<code>MessagePort</code>&nbsp;objects and discarding them without closing them can lead to high memory usage.</p>
</blockquote>
<h3>Further reading</h3>
<p><a href="http://www.w3.org/TR/webmessaging" target="_blank">HTML5 Web Messaging</a></p>
<p><a href="https://developer.mozilla.org/en/DOM/window.postMessage" target="_blank">window.postMessage - MDN Docs</a></p>
<p><a href="http://html5demos.com/postmessage2" target="_blank">HTML5 Demo: postMessage (cross domain)</a></p>
<p><a href="http://davidwalsh.name/window-postmessage" target="_blank">HTML5&prime;s window.postMessage AP</a></p>
<p><a href="http://msdn.microsoft.com/en-us/ie/hh272905" target="_blank">Internet Explorer 10 Platform Preview: HTML5</a></p>
<p><a href="http://ithelp.ithome.com.tw/question/10057709" target="_blank">http://ithelp.ithome.com.tw/question/10057709</a></p>
<p>&nbsp;</p>
<p>Also posted on CodeProject:&nbsp;<a href="http://www.codeproject.com/KB/HTML/HTML5-WebMessaging.aspx">http://www.codeproject.com/KB/HTML/HTML5-WebMessaging.aspx</a></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#hack" class="page__taxonomy-item" rel="tag">Hack</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hack" class="page__taxonomy-item" rel="tag">Hack</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2011-08-30T00:00:00-07:00">August 30, 2011</time></p>
        
      </footer>

      <section class="page__share">
  <!---->
    <!--<h4 class="page__share-title">Share on</h4>-->
  <!---->

  <!--<a href="https://twitter.com/intent/tweet?via=wayneye&text=HTML5+WebMessaging+In+Essence%20https%3A%2F%2Fwayneye.site%2FHTML5-WebMessaging-In-Essence" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>-->

  <!--<a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwayneye.site%2FHTML5-WebMessaging-In-Essence" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>-->

  <!--<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwayneye.site%2FHTML5-WebMessaging-In-Essence" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>-->

  
  <figure style="margin-top: 10px; width: 380px;">
      <a href="/assets/images/dashang.jpg"><img src="/assets/images/dashang.jpg" alt="å¾®ä¿¡æ‰“èµ"></a>
  </figure>
</section>


      
  <nav class="pagination">
    
      <a href="/nodejs-express-jade-socketio-On-Ubuntu" class="pagination--pager" title="nodejs+express+jade+socket.io on Ubuntu 11.04
">Previous</a>
    
    
      <a href="/HTML5-WebMessaging-In-Essence" class="pagination--pager" title="HTML5 WebMessaging In Essence
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/RIP-Bram-Moolenaar" rel="permalink">RIP Bram Moolenaar - Father of Vim
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">From the most recent MacVim release note:

  As some of you may have read, Bram Moolenaar, the creator and maintainer of Vim, has passed away recently. He has worked tirelessly on Vim for more than 30 years and this release is dedicated to him. If you would like, you could pay your respects at this discussion thread.



  The Vim project has transitioned to new maintainers, and MacVim will continue to be supported as long as Vim is around.


I decided to use Vim as my all time text editor since 12 years ago, it completely changed my mind and my life, there were some times I felt like my typ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/RIP-Bram-Moolenaar" rel="permalink">RIP Bram Moolenaar - Father of Vim
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">From the most recent MacVim release note:

  As some of you may have read, Bram Moolenaar, the creator and maintainer of Vim, has passed away recently. He has worked tirelessly on Vim for more than 30 years and this release is dedicated to him. If you would like, you could pay your respects at this discussion thread.



  The Vim project has transitioned to new maintainers, and MacVim will continue to be supported as long as Vim is around.


I decided to use Vim as my all time text editor since 12 years ago, it completely changed my mind and my life, there were some times I felt like my typ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/BMW-Convertible-As-My-Beater-Car" rel="permalink">BMW Convertible As My Beater Car
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">
  Life is too short to drive boring cars





I bought a 2015 BMW X5 Dec last year, it has been half a year so far (with 2 months she stayed inside the garage for most of the time due to the pandemic), I am pretty satisfied with it, her condition is absolutely excellent, everything works, yes you see it correctly, after 5 years of its life, there was nothing broken, as BMW vehicle built in recent years, this is something not VERY easy.  My plan is to keep it as long as possible before it turns into an endless money pit, and keeping her value as high as possible, one of the major reason I b...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2019-12-07-SkyJump-Las-Vegas" rel="permalink">SkyJump from Stratosphere Tower at Las Vegas - Smile all the way down
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Instead of spending any cent in the money pit casinos, Iâ€™d chose to do something more meaningful and exciting :)


    
    
    
    SkyJump Las Vegas




  SkyJump Las Vegas holds the Guinness World Record for highest commercial decelerator descent with an official height of 829 ft (253 m) and is located at Stratosphere Las Vegas. As part of its grand opening event, Las Vegas Mayor Oscar Goodman presented a written proclamation deeming April 20, 2010 as SkyJump Day in Las Vegas.
  â€“ Wikipedia (https://en.wikipedia.org/wiki/SkyJump_Las_Vegas)





  



</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4ea2897777c94202"></script>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto:hi@wayneye.site" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://wayneye.site" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://twitter.com/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://facebook.com/WayneYeDotCom" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/WayneYe/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Wayne Ye. All rights reserved.
 
  <!--Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>-->

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>







    
  <script>
    var disqus_config = function () {
      this.page.url = "https://wayneye.site/HTML5-WebMessaging-In-Essence";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/HTML5-WebMessaging-In-Essence"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://wayneye.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
