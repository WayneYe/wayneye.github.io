<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>MongoDB Schema Design and Common Practices - Wayneâ€™s Geek Life</title>
<meta name="description" content="InstallationExhaustive documentation:&nbsp;http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/Mongo executables will be installed into&nbsp;/use/bin/, database files will under&nbsp;/data/db/Log file location:&nbsp;/var/log/mongodb/mongodb.logTerminologyAdminstrationsudo service mongodb start/stop/restart&nbsp;or simply issue&nbsp;mongod&nbsp;to start MongoDB processmongo&nbsp;to enter MongoDB Console&gt; show dbs &nbsp;#Show all databases&gt; db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #Show current db&gt; db.help() &nbsp; #View commands related with db# &quot;Create&quot; a new database named foo_db&gt; use foo_db &nbsp;# Mongo will create this DB virutally, if we save anything into any collections, it will really creates the db.# Create a new document into a collection (implicitly)&gt; db.user_profiles.save({ first_name: &quot;Wayne&quot;, last_name: &quot;Ye&quot; })# Explicitly create a new collection ()db.createCollection(&quot;user_profile&quot;)# Query the collection&gt; db.user_profiles.find(){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;first_name&quot; : &quot;Wayne&quot;, &quot;last_name&quot; : &quot;Ye&quot; }&gt; db.user_profiles.save({ first_name: &quot;Wendy&quot;, last_name: &quot;Shen&quot;, gender: &quot;Female&quot; })&gt; db.user_profiles.find()# Update&gt; db.collection.update( { field: value1 }, { $set: { field1: value2 } } ); # View status&gt; db.stats()&gt; db.mycol.stats()# Query subdocument using Dot Notation&gt; db.demo.insert({ &quot;Items&quot;: [ { &quot;Name&quot;: &quot;Milk Powder&quot;, &quot;Price&quot;: 9.9 }, { &quot;Name&quot;: &quot;Toy Car&quot;, &quot;Price&quot;: 26 } ] })&gt; db.demo.find({ &quot;Items.Price&quot;: { $gt: 20 } }){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;Items&quot; : [ &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Milk Powder&quot;, &nbsp;&quot;Price&quot; : 9.9 }, &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Toy Car&quot;, &nbsp;&quot;Price&quot; : 26 } ] }&nbsp;Batch administration from JavaScripthttp://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-hosthttp://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/&nbsp;http://docs.mongodb.org/manual/reference/method/&nbsp;&nbsp;(Mongo shell JS references)mongo&nbsp;localhost:27017/mydb&nbsp;db_schema.jsOrload(&quot;scripts/myjstest.js&quot;) OR&nbsp;load(&quot;/data/db/scripts/myjstest.js&quot;)Schema DesignEmbedding (de-normalize data)Store two related pieces of data in a single document.When:There is a &quot;contains&quot; relationship between entities.There is a &quot;one-to-many&quot; relationship, and the &quot;many&quot; objects always appear inline with the &quot;one&quot;.Example 1: Blog with commentsDenormalized blog with commentsdb.blogs.insert({ &nbsp;_id: 1, &nbsp;title: &quot;Investigation on MongoDB&quot;, &nbsp;content: &quot;some investigation contents&quot;, &nbsp;post_date: Date.now(), &nbsp;permalink: &quot;http://foo.bar/investigation_on_mongodb&quot;, &nbsp;comments: [ &nbsp; &nbsp;{ content: &quot;Gorgeous post!!!&quot;, nickname: &quot;Scott&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ content: &quot;Splendid article!!!&quot;, nickname: &quot;Guthrie&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;]} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );Example 2: Dishes and ChevesNormalized Dishes and Chevesdb.dishes.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Kong Bao Ji Ding&quot;, &nbsp;price: 5.5, &nbsp;rate: 4.5, &nbsp;cheves: [ &quot;Flora Zhang&quot;, &quot;Cristina Wang&quot; ] &nbsp;}); &nbsp;db.cheves.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Flora Zhang&quot;, &nbsp;age: 32, &nbsp;avatar: &quot;http://www.gravatar.com/avatar.php?gravatar_id=dc654756c7c&quot;,  &nbsp;dishes: [ &quot;Kong Bao Ji Ding&quot;, &quot;Knight Zhang Beef&quot;, &quot;Ma Po Tou Fu&quot; ] &nbsp;});&nbsp;Benefits:Better performance for read operationsRequest and retrieve related data in a single database operation.Referencing (Normalize-data)store references between two documents to indicate a relationship between the data represented in each document.When:when embedding would result in duplication of data but would not provide sufficient read performance advantages to outweigh the implications of the duplication.to represent more complex many-to-many relationships.to model large hierarchical data sets.Benefits:Separation of ConcernsData model independent of logicDrawback:Referencing provides more flexibility than embedding; however, to resolve the references, client-side applications must issue follow-up queries. In other words, using references requires more roundtrips to the server.&nbsp;Example 3: Books and publisherBooks and publishersdb.books.insert({ &nbsp;_id: 1, &nbsp;name: &quot;MongoDB Applied Design Patterns&quot;, &nbsp;price: 35, &nbsp;rate: 5, &nbsp;author: &quot;Rick Copeland&quot;, &nbsp;ISBN: &quot;1449340040&quot;, &nbsp;publisher_id: 1, &nbsp;reviews: [ &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Dick&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Xiaoshen&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;] &nbsp;});&nbsp;&nbsp;db.publishers.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Packtpub INC&quot;, &nbsp;address: &quot;2nd Floor, Livery Place 35 Livery Street Birmingham&quot;, &nbsp;telephone: &quot;+44 0121 265 6484&quot;, &nbsp;});Advanced FeaturesMultikey-IndexesMongo supports indexing subdocument&#39;s key, consider the above &quot;Books and Publishers&quot; collection, Mongo can index the reviewer key by telling him this:db.books.ensureIndex({&nbsp;&quot;reviews.reviewer&quot;:&nbsp;1&nbsp;})Aggregation frameworkA MongoDB aggregation is a series of special operators applied to a collection. An operator is a JavaScript object with a single property, the operator name, which value is an option object. The core point of aggregation framework is the aggregation pipeline which is a framework for data aggregation modeled on the concept of data processing pipelines.Aggregation was introduced in Mongo version 2.2, below is a table of comparison between Mongo and traditional relational DB from the aspect of aggregation functionalities:SQL Terms, Functions, and ConceptsMongoDB Aggregation OperatorsWHERE$matchGROUP BY$groupHAVING$matchSELECT$projectORDER BY$sortLIMIT$limitSUM()$sumCOUNT()$sumjoinNo direct corresponding operator;&nbsp;however, the&nbsp;$unwind&nbsp;operator allows for somewhat similar functionality, but with fields embedded within the document.For example, still using the above &quot;Books and Publishers&quot; example, image I want to query &quot;a specific reviewer with the book(s) he/she reviewed&quot;, I can do this:&gt; &gt; db.books.aggregate({ $unwind: &quot;$reviews&quot; }, { $match: { &quot;reviews.reviewer&quot;: &quot;Xiaoshen&quot;} }){&nbsp;&quot;result&quot; : [&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&quot;_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;name&quot; : &quot;MongoDB Applied Design Patterns&quot;,&nbsp;&nbsp;&nbsp;&quot;price&quot; : 35,&nbsp;&nbsp;&nbsp;&quot;rate&quot; : 5,&nbsp;&nbsp;&nbsp;&quot;author&quot; : &quot;Rick Copeland&quot;,&nbsp;&nbsp;&nbsp;&quot;ISBN&quot; : &quot;1449340040&quot;,&nbsp;&nbsp;&nbsp;&quot;publisher_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;reviews&quot; : {&nbsp;&nbsp;&nbsp;&nbsp;&quot;isUseful&quot; : true,&nbsp;&nbsp;&nbsp;&nbsp;&quot;content&quot; : &quot;Cool book!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;reviewer&quot; : &quot;Xiaoshen&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;timestamp&quot; : &quot;1377742184305&quot;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;],&nbsp;&quot;ok&quot; : 1}Aggregation introduction: http://docs.mongodb.org/manual/applications/aggregation/One caveat: Aggregation is running upon JavaScript VM, which means - V8 after MongoDB version 2.4, although V8 is deadly fast, it cannot compete with native compiled/optimized C/C++ implementation, refer:http://stackoverflow.com/questions/2599943/mongodbs-performance-on-aggregation-queriesCommon Practices&nbsp;Denormalize data when frequently read together (one-to-one, one-to-many)Normalize data when where are separated queries happened frequently for both entities; or when there are too many data duplicationsReduce collection size by always using short field names as a convention. This will help you save memory over time.Avoid using DBRef!&nbsp;WhyAlways test queries with .explain() to check that you&rsquo;re hitting the right index.Useful resourcesThe ultimate manualhttp://docs.mongodb.org/manual/&nbsp;Greate article explains differences between MongoDB and other famous Relational DBs:http://docs.mongodb.org/manual/reference/sql-comparison/Data Modeling Considerations for MongoDB Applicationshttp://docs.mongodb.org/manual/core/data-modeling/MongoDB-sharding-guide.pdf&nbsp;Serialize Documents with the CSharp Driverhttp://docs.mongodb.org/ecosystem/tutorial/serialize-documents-with-the-csharp-driver/&nbsp;Schema Design --Indexes!!http://www.slideshare.net/jrosoff/mongodb-advanced-schema-design-inboxes&nbsp;Sharding and Mongo DBhttp://docs.mongodb.org/master/MongoDB-sharding-guide.pdfMongoDB Operations Best Practiceshttp://info.10gen.com/rs/10gen/images/10gen-MongoDB_Operations_Best_Practices.pdf&nbsp;Sharding and Replica Sets Illustratedhttp://www.kchodorow.com/blog/2010/08/09/sharding-and-replica-sets-illustrated/">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Wayne's Geek Life">
<meta property="og:title" content="MongoDB Schema Design and Common Practices">
<meta property="og:url" content="https://wayneye.com/MongoDB_Schema_Design_And_Common_Practices">


  <meta property="og:description" content="InstallationExhaustive documentation:&nbsp;http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/Mongo executables will be installed into&nbsp;/use/bin/, database files will under&nbsp;/data/db/Log file location:&nbsp;/var/log/mongodb/mongodb.logTerminologyAdminstrationsudo service mongodb start/stop/restart&nbsp;or simply issue&nbsp;mongod&nbsp;to start MongoDB processmongo&nbsp;to enter MongoDB Console&gt; show dbs &nbsp;#Show all databases&gt; db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #Show current db&gt; db.help() &nbsp; #View commands related with db# &quot;Create&quot; a new database named foo_db&gt; use foo_db &nbsp;# Mongo will create this DB virutally, if we save anything into any collections, it will really creates the db.# Create a new document into a collection (implicitly)&gt; db.user_profiles.save({ first_name: &quot;Wayne&quot;, last_name: &quot;Ye&quot; })# Explicitly create a new collection ()db.createCollection(&quot;user_profile&quot;)# Query the collection&gt; db.user_profiles.find(){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;first_name&quot; : &quot;Wayne&quot;, &quot;last_name&quot; : &quot;Ye&quot; }&gt; db.user_profiles.save({ first_name: &quot;Wendy&quot;, last_name: &quot;Shen&quot;, gender: &quot;Female&quot; })&gt; db.user_profiles.find()# Update&gt; db.collection.update( { field: value1 }, { $set: { field1: value2 } } ); # View status&gt; db.stats()&gt; db.mycol.stats()# Query subdocument using Dot Notation&gt; db.demo.insert({ &quot;Items&quot;: [ { &quot;Name&quot;: &quot;Milk Powder&quot;, &quot;Price&quot;: 9.9 }, { &quot;Name&quot;: &quot;Toy Car&quot;, &quot;Price&quot;: 26 } ] })&gt; db.demo.find({ &quot;Items.Price&quot;: { $gt: 20 } }){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;Items&quot; : [ &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Milk Powder&quot;, &nbsp;&quot;Price&quot; : 9.9 }, &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Toy Car&quot;, &nbsp;&quot;Price&quot; : 26 } ] }&nbsp;Batch administration from JavaScripthttp://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-hosthttp://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/&nbsp;http://docs.mongodb.org/manual/reference/method/&nbsp;&nbsp;(Mongo shell JS references)mongo&nbsp;localhost:27017/mydb&nbsp;db_schema.jsOrload(&quot;scripts/myjstest.js&quot;) OR&nbsp;load(&quot;/data/db/scripts/myjstest.js&quot;)Schema DesignEmbedding (de-normalize data)Store two related pieces of data in a single document.When:There is a &quot;contains&quot; relationship between entities.There is a &quot;one-to-many&quot; relationship, and the &quot;many&quot; objects always appear inline with the &quot;one&quot;.Example 1: Blog with commentsDenormalized blog with commentsdb.blogs.insert({ &nbsp;_id: 1, &nbsp;title: &quot;Investigation on MongoDB&quot;, &nbsp;content: &quot;some investigation contents&quot;, &nbsp;post_date: Date.now(), &nbsp;permalink: &quot;http://foo.bar/investigation_on_mongodb&quot;, &nbsp;comments: [ &nbsp; &nbsp;{ content: &quot;Gorgeous post!!!&quot;, nickname: &quot;Scott&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ content: &quot;Splendid article!!!&quot;, nickname: &quot;Guthrie&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;]} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );Example 2: Dishes and ChevesNormalized Dishes and Chevesdb.dishes.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Kong Bao Ji Ding&quot;, &nbsp;price: 5.5, &nbsp;rate: 4.5, &nbsp;cheves: [ &quot;Flora Zhang&quot;, &quot;Cristina Wang&quot; ] &nbsp;}); &nbsp;db.cheves.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Flora Zhang&quot;, &nbsp;age: 32, &nbsp;avatar: &quot;http://www.gravatar.com/avatar.php?gravatar_id=dc654756c7c&quot;,  &nbsp;dishes: [ &quot;Kong Bao Ji Ding&quot;, &quot;Knight Zhang Beef&quot;, &quot;Ma Po Tou Fu&quot; ] &nbsp;});&nbsp;Benefits:Better performance for read operationsRequest and retrieve related data in a single database operation.Referencing (Normalize-data)store references between two documents to indicate a relationship between the data represented in each document.When:when embedding would result in duplication of data but would not provide sufficient read performance advantages to outweigh the implications of the duplication.to represent more complex many-to-many relationships.to model large hierarchical data sets.Benefits:Separation of ConcernsData model independent of logicDrawback:Referencing provides more flexibility than embedding; however, to resolve the references, client-side applications must issue follow-up queries. In other words, using references requires more roundtrips to the server.&nbsp;Example 3: Books and publisherBooks and publishersdb.books.insert({ &nbsp;_id: 1, &nbsp;name: &quot;MongoDB Applied Design Patterns&quot;, &nbsp;price: 35, &nbsp;rate: 5, &nbsp;author: &quot;Rick Copeland&quot;, &nbsp;ISBN: &quot;1449340040&quot;, &nbsp;publisher_id: 1, &nbsp;reviews: [ &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Dick&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Xiaoshen&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;] &nbsp;});&nbsp;&nbsp;db.publishers.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Packtpub INC&quot;, &nbsp;address: &quot;2nd Floor, Livery Place 35 Livery Street Birmingham&quot;, &nbsp;telephone: &quot;+44 0121 265 6484&quot;, &nbsp;});Advanced FeaturesMultikey-IndexesMongo supports indexing subdocument&#39;s key, consider the above &quot;Books and Publishers&quot; collection, Mongo can index the reviewer key by telling him this:db.books.ensureIndex({&nbsp;&quot;reviews.reviewer&quot;:&nbsp;1&nbsp;})Aggregation frameworkA MongoDB aggregation is a series of special operators applied to a collection. An operator is a JavaScript object with a single property, the operator name, which value is an option object. The core point of aggregation framework is the aggregation pipeline which is a framework for data aggregation modeled on the concept of data processing pipelines.Aggregation was introduced in Mongo version 2.2, below is a table of comparison between Mongo and traditional relational DB from the aspect of aggregation functionalities:SQL Terms, Functions, and ConceptsMongoDB Aggregation OperatorsWHERE$matchGROUP BY$groupHAVING$matchSELECT$projectORDER BY$sortLIMIT$limitSUM()$sumCOUNT()$sumjoinNo direct corresponding operator;&nbsp;however, the&nbsp;$unwind&nbsp;operator allows for somewhat similar functionality, but with fields embedded within the document.For example, still using the above &quot;Books and Publishers&quot; example, image I want to query &quot;a specific reviewer with the book(s) he/she reviewed&quot;, I can do this:&gt; &gt; db.books.aggregate({ $unwind: &quot;$reviews&quot; }, { $match: { &quot;reviews.reviewer&quot;: &quot;Xiaoshen&quot;} }){&nbsp;&quot;result&quot; : [&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&quot;_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;name&quot; : &quot;MongoDB Applied Design Patterns&quot;,&nbsp;&nbsp;&nbsp;&quot;price&quot; : 35,&nbsp;&nbsp;&nbsp;&quot;rate&quot; : 5,&nbsp;&nbsp;&nbsp;&quot;author&quot; : &quot;Rick Copeland&quot;,&nbsp;&nbsp;&nbsp;&quot;ISBN&quot; : &quot;1449340040&quot;,&nbsp;&nbsp;&nbsp;&quot;publisher_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;reviews&quot; : {&nbsp;&nbsp;&nbsp;&nbsp;&quot;isUseful&quot; : true,&nbsp;&nbsp;&nbsp;&nbsp;&quot;content&quot; : &quot;Cool book!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;reviewer&quot; : &quot;Xiaoshen&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;timestamp&quot; : &quot;1377742184305&quot;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;],&nbsp;&quot;ok&quot; : 1}Aggregation introduction: http://docs.mongodb.org/manual/applications/aggregation/One caveat: Aggregation is running upon JavaScript VM, which means - V8 after MongoDB version 2.4, although V8 is deadly fast, it cannot compete with native compiled/optimized C/C++ implementation, refer:http://stackoverflow.com/questions/2599943/mongodbs-performance-on-aggregation-queriesCommon Practices&nbsp;Denormalize data when frequently read together (one-to-one, one-to-many)Normalize data when where are separated queries happened frequently for both entities; or when there are too many data duplicationsReduce collection size by always using short field names as a convention. This will help you save memory over time.Avoid using DBRef!&nbsp;WhyAlways test queries with .explain() to check that you&rsquo;re hitting the right index.Useful resourcesThe ultimate manualhttp://docs.mongodb.org/manual/&nbsp;Greate article explains differences between MongoDB and other famous Relational DBs:http://docs.mongodb.org/manual/reference/sql-comparison/Data Modeling Considerations for MongoDB Applicationshttp://docs.mongodb.org/manual/core/data-modeling/MongoDB-sharding-guide.pdf&nbsp;Serialize Documents with the CSharp Driverhttp://docs.mongodb.org/ecosystem/tutorial/serialize-documents-with-the-csharp-driver/&nbsp;Schema Design --Indexes!!http://www.slideshare.net/jrosoff/mongodb-advanced-schema-design-inboxes&nbsp;Sharding and Mongo DBhttp://docs.mongodb.org/master/MongoDB-sharding-guide.pdfMongoDB Operations Best Practiceshttp://info.10gen.com/rs/10gen/images/10gen-MongoDB_Operations_Best_Practices.pdf&nbsp;Sharding and Replica Sets Illustratedhttp://www.kchodorow.com/blog/2010/08/09/sharding-and-replica-sets-illustrated/">





  <meta name="twitter:site" content="@wayneye">
  <meta name="twitter:title" content="MongoDB Schema Design and Common Practices">
  <meta name="twitter:description" content="InstallationExhaustive documentation:&nbsp;http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/Mongo executables will be installed into&nbsp;/use/bin/, database files will under&nbsp;/data/db/Log file location:&nbsp;/var/log/mongodb/mongodb.logTerminologyAdminstrationsudo service mongodb start/stop/restart&nbsp;or simply issue&nbsp;mongod&nbsp;to start MongoDB processmongo&nbsp;to enter MongoDB Console&gt; show dbs &nbsp;#Show all databases&gt; db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #Show current db&gt; db.help() &nbsp; #View commands related with db# &quot;Create&quot; a new database named foo_db&gt; use foo_db &nbsp;# Mongo will create this DB virutally, if we save anything into any collections, it will really creates the db.# Create a new document into a collection (implicitly)&gt; db.user_profiles.save({ first_name: &quot;Wayne&quot;, last_name: &quot;Ye&quot; })# Explicitly create a new collection ()db.createCollection(&quot;user_profile&quot;)# Query the collection&gt; db.user_profiles.find(){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;first_name&quot; : &quot;Wayne&quot;, &quot;last_name&quot; : &quot;Ye&quot; }&gt; db.user_profiles.save({ first_name: &quot;Wendy&quot;, last_name: &quot;Shen&quot;, gender: &quot;Female&quot; })&gt; db.user_profiles.find()# Update&gt; db.collection.update( { field: value1 }, { $set: { field1: value2 } } ); # View status&gt; db.stats()&gt; db.mycol.stats()# Query subdocument using Dot Notation&gt; db.demo.insert({ &quot;Items&quot;: [ { &quot;Name&quot;: &quot;Milk Powder&quot;, &quot;Price&quot;: 9.9 }, { &quot;Name&quot;: &quot;Toy Car&quot;, &quot;Price&quot;: 26 } ] })&gt; db.demo.find({ &quot;Items.Price&quot;: { $gt: 20 } }){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;Items&quot; : [ &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Milk Powder&quot;, &nbsp;&quot;Price&quot; : 9.9 }, &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Toy Car&quot;, &nbsp;&quot;Price&quot; : 26 } ] }&nbsp;Batch administration from JavaScripthttp://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-hosthttp://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/&nbsp;http://docs.mongodb.org/manual/reference/method/&nbsp;&nbsp;(Mongo shell JS references)mongo&nbsp;localhost:27017/mydb&nbsp;db_schema.jsOrload(&quot;scripts/myjstest.js&quot;) OR&nbsp;load(&quot;/data/db/scripts/myjstest.js&quot;)Schema DesignEmbedding (de-normalize data)Store two related pieces of data in a single document.When:There is a &quot;contains&quot; relationship between entities.There is a &quot;one-to-many&quot; relationship, and the &quot;many&quot; objects always appear inline with the &quot;one&quot;.Example 1: Blog with commentsDenormalized blog with commentsdb.blogs.insert({ &nbsp;_id: 1, &nbsp;title: &quot;Investigation on MongoDB&quot;, &nbsp;content: &quot;some investigation contents&quot;, &nbsp;post_date: Date.now(), &nbsp;permalink: &quot;http://foo.bar/investigation_on_mongodb&quot;, &nbsp;comments: [ &nbsp; &nbsp;{ content: &quot;Gorgeous post!!!&quot;, nickname: &quot;Scott&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ content: &quot;Splendid article!!!&quot;, nickname: &quot;Guthrie&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;]} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );Example 2: Dishes and ChevesNormalized Dishes and Chevesdb.dishes.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Kong Bao Ji Ding&quot;, &nbsp;price: 5.5, &nbsp;rate: 4.5, &nbsp;cheves: [ &quot;Flora Zhang&quot;, &quot;Cristina Wang&quot; ] &nbsp;}); &nbsp;db.cheves.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Flora Zhang&quot;, &nbsp;age: 32, &nbsp;avatar: &quot;http://www.gravatar.com/avatar.php?gravatar_id=dc654756c7c&quot;,  &nbsp;dishes: [ &quot;Kong Bao Ji Ding&quot;, &quot;Knight Zhang Beef&quot;, &quot;Ma Po Tou Fu&quot; ] &nbsp;});&nbsp;Benefits:Better performance for read operationsRequest and retrieve related data in a single database operation.Referencing (Normalize-data)store references between two documents to indicate a relationship between the data represented in each document.When:when embedding would result in duplication of data but would not provide sufficient read performance advantages to outweigh the implications of the duplication.to represent more complex many-to-many relationships.to model large hierarchical data sets.Benefits:Separation of ConcernsData model independent of logicDrawback:Referencing provides more flexibility than embedding; however, to resolve the references, client-side applications must issue follow-up queries. In other words, using references requires more roundtrips to the server.&nbsp;Example 3: Books and publisherBooks and publishersdb.books.insert({ &nbsp;_id: 1, &nbsp;name: &quot;MongoDB Applied Design Patterns&quot;, &nbsp;price: 35, &nbsp;rate: 5, &nbsp;author: &quot;Rick Copeland&quot;, &nbsp;ISBN: &quot;1449340040&quot;, &nbsp;publisher_id: 1, &nbsp;reviews: [ &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Dick&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Xiaoshen&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;] &nbsp;});&nbsp;&nbsp;db.publishers.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Packtpub INC&quot;, &nbsp;address: &quot;2nd Floor, Livery Place 35 Livery Street Birmingham&quot;, &nbsp;telephone: &quot;+44 0121 265 6484&quot;, &nbsp;});Advanced FeaturesMultikey-IndexesMongo supports indexing subdocument&#39;s key, consider the above &quot;Books and Publishers&quot; collection, Mongo can index the reviewer key by telling him this:db.books.ensureIndex({&nbsp;&quot;reviews.reviewer&quot;:&nbsp;1&nbsp;})Aggregation frameworkA MongoDB aggregation is a series of special operators applied to a collection. An operator is a JavaScript object with a single property, the operator name, which value is an option object. The core point of aggregation framework is the aggregation pipeline which is a framework for data aggregation modeled on the concept of data processing pipelines.Aggregation was introduced in Mongo version 2.2, below is a table of comparison between Mongo and traditional relational DB from the aspect of aggregation functionalities:SQL Terms, Functions, and ConceptsMongoDB Aggregation OperatorsWHERE$matchGROUP BY$groupHAVING$matchSELECT$projectORDER BY$sortLIMIT$limitSUM()$sumCOUNT()$sumjoinNo direct corresponding operator;&nbsp;however, the&nbsp;$unwind&nbsp;operator allows for somewhat similar functionality, but with fields embedded within the document.For example, still using the above &quot;Books and Publishers&quot; example, image I want to query &quot;a specific reviewer with the book(s) he/she reviewed&quot;, I can do this:&gt; &gt; db.books.aggregate({ $unwind: &quot;$reviews&quot; }, { $match: { &quot;reviews.reviewer&quot;: &quot;Xiaoshen&quot;} }){&nbsp;&quot;result&quot; : [&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&quot;_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;name&quot; : &quot;MongoDB Applied Design Patterns&quot;,&nbsp;&nbsp;&nbsp;&quot;price&quot; : 35,&nbsp;&nbsp;&nbsp;&quot;rate&quot; : 5,&nbsp;&nbsp;&nbsp;&quot;author&quot; : &quot;Rick Copeland&quot;,&nbsp;&nbsp;&nbsp;&quot;ISBN&quot; : &quot;1449340040&quot;,&nbsp;&nbsp;&nbsp;&quot;publisher_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;reviews&quot; : {&nbsp;&nbsp;&nbsp;&nbsp;&quot;isUseful&quot; : true,&nbsp;&nbsp;&nbsp;&nbsp;&quot;content&quot; : &quot;Cool book!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;reviewer&quot; : &quot;Xiaoshen&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;timestamp&quot; : &quot;1377742184305&quot;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;],&nbsp;&quot;ok&quot; : 1}Aggregation introduction: http://docs.mongodb.org/manual/applications/aggregation/One caveat: Aggregation is running upon JavaScript VM, which means - V8 after MongoDB version 2.4, although V8 is deadly fast, it cannot compete with native compiled/optimized C/C++ implementation, refer:http://stackoverflow.com/questions/2599943/mongodbs-performance-on-aggregation-queriesCommon Practices&nbsp;Denormalize data when frequently read together (one-to-one, one-to-many)Normalize data when where are separated queries happened frequently for both entities; or when there are too many data duplicationsReduce collection size by always using short field names as a convention. This will help you save memory over time.Avoid using DBRef!&nbsp;WhyAlways test queries with .explain() to check that you&rsquo;re hitting the right index.Useful resourcesThe ultimate manualhttp://docs.mongodb.org/manual/&nbsp;Greate article explains differences between MongoDB and other famous Relational DBs:http://docs.mongodb.org/manual/reference/sql-comparison/Data Modeling Considerations for MongoDB Applicationshttp://docs.mongodb.org/manual/core/data-modeling/MongoDB-sharding-guide.pdf&nbsp;Serialize Documents with the CSharp Driverhttp://docs.mongodb.org/ecosystem/tutorial/serialize-documents-with-the-csharp-driver/&nbsp;Schema Design --Indexes!!http://www.slideshare.net/jrosoff/mongodb-advanced-schema-design-inboxes&nbsp;Sharding and Mongo DBhttp://docs.mongodb.org/master/MongoDB-sharding-guide.pdfMongoDB Operations Best Practiceshttp://info.10gen.com/rs/10gen/images/10gen-MongoDB_Operations_Best_Practices.pdf&nbsp;Sharding and Replica Sets Illustratedhttp://www.kchodorow.com/blog/2010/08/09/sharding-and-replica-sets-illustrated/">
  <meta name="twitter:url" content="https://wayneye.com/MongoDB_Schema_Design_And_Common_Practices">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2013-08-30T00:00:00-07:00">





  

  
    <meta property="fb:app_id" content="374223339969060">
  


<link rel="canonical" href="https://wayneye.com/MongoDB_Schema_Design_And_Common_Practices">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Wayne's Geek Life Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon/favicon-16x16.png">
<link rel="manifest" href="assets/images/favicon/site.webmanifest">
<link rel="mask-icon" href="assets/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">Wayne's Geek Life</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/search/" >Search</a>
            </li><li class="masthead__menu-item">
              <a href="/album/" >Album</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/me.jpg" alt="Wayne Ye" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Wayne Ye</h3>
    
    
      <p class="author__bio" itemprop="description">
        Whatever is worth doing is worth doing well!
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">San Francisco</span>
        </li>
      

      
        
          
            <li><a href="mailto:me@wayneye.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://wayneye.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://facebook.com/WayneYeDotCom" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
          
        
          
            <li><a href="https://github.com/WayneYe/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="MongoDB Schema Design and Common Practices">
    <meta itemprop="description" content="InstallationExhaustive documentation:&nbsp;http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/Mongo executables will be installed into&nbsp;/use/bin/, database files will under&nbsp;/data/db/Log file location:&nbsp;/var/log/mongodb/mongodb.logTerminologyAdminstrationsudo service mongodb start/stop/restart&nbsp;or simply issue&nbsp;mongod&nbsp;to start MongoDB processmongo&nbsp;to enter MongoDB Console&gt; show dbs &nbsp;#Show all databases&gt; db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #Show current db&gt; db.help() &nbsp; #View commands related with db# &quot;Create&quot; a new database named foo_db&gt; use foo_db &nbsp;# Mongo will create this DB virutally, if we save anything into any collections, it will really creates the db.# Create a new document into a collection (implicitly)&gt; db.user_profiles.save({ first_name: &quot;Wayne&quot;, last_name: &quot;Ye&quot; })# Explicitly create a new collection ()db.createCollection(&quot;user_profile&quot;)# Query the collection&gt; db.user_profiles.find(){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;first_name&quot; : &quot;Wayne&quot;, &quot;last_name&quot; : &quot;Ye&quot; }&gt; db.user_profiles.save({ first_name: &quot;Wendy&quot;, last_name: &quot;Shen&quot;, gender: &quot;Female&quot; })&gt; db.user_profiles.find()# Update&gt; db.collection.update( { field: value1 }, { $set: { field1: value2 } } ); # View status&gt; db.stats()&gt; db.mycol.stats()# Query subdocument using Dot Notation&gt; db.demo.insert({ &quot;Items&quot;: [ { &quot;Name&quot;: &quot;Milk Powder&quot;, &quot;Price&quot;: 9.9 }, { &quot;Name&quot;: &quot;Toy Car&quot;, &quot;Price&quot;: 26 } ] })&gt; db.demo.find({ &quot;Items.Price&quot;: { $gt: 20 } }){ &quot;_id&quot; : ObjectId(&quot;5216fa545b4a83d66587d397&quot;), &quot;Items&quot; : [ &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Milk Powder&quot;, &nbsp;&quot;Price&quot; : 9.9 }, &nbsp;{ &nbsp;&quot;Name&quot; : &quot;Toy Car&quot;, &nbsp;&quot;Price&quot; : 26 } ] }&nbsp;Batch administration from JavaScripthttp://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-hosthttp://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/&nbsp;http://docs.mongodb.org/manual/reference/method/&nbsp;&nbsp;(Mongo shell JS references)mongo&nbsp;localhost:27017/mydb&nbsp;db_schema.jsOrload(&quot;scripts/myjstest.js&quot;) OR&nbsp;load(&quot;/data/db/scripts/myjstest.js&quot;)Schema DesignEmbedding (de-normalize data)Store two related pieces of data in a single document.When:There is a &quot;contains&quot; relationship between entities.There is a &quot;one-to-many&quot; relationship, and the &quot;many&quot; objects always appear inline with the &quot;one&quot;.Example 1: Blog with commentsDenormalized blog with commentsdb.blogs.insert({ &nbsp;_id: 1, &nbsp;title: &quot;Investigation on MongoDB&quot;, &nbsp;content: &quot;some investigation contents&quot;, &nbsp;post_date: Date.now(), &nbsp;permalink: &quot;http://foo.bar/investigation_on_mongodb&quot;, &nbsp;comments: [ &nbsp; &nbsp;{ content: &quot;Gorgeous post!!!&quot;, nickname: &quot;Scott&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ content: &quot;Splendid article!!!&quot;, nickname: &quot;Guthrie&quot;, email: &quot;foo@bar.org&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;]} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );Example 2: Dishes and ChevesNormalized Dishes and Chevesdb.dishes.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Kong Bao Ji Ding&quot;, &nbsp;price: 5.5, &nbsp;rate: 4.5, &nbsp;cheves: [ &quot;Flora Zhang&quot;, &quot;Cristina Wang&quot; ] &nbsp;}); &nbsp;db.cheves.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Flora Zhang&quot;, &nbsp;age: 32, &nbsp;avatar: &quot;http://www.gravatar.com/avatar.php?gravatar_id=dc654756c7c&quot;,  &nbsp;dishes: [ &quot;Kong Bao Ji Ding&quot;, &quot;Knight Zhang Beef&quot;, &quot;Ma Po Tou Fu&quot; ] &nbsp;});&nbsp;Benefits:Better performance for read operationsRequest and retrieve related data in a single database operation.Referencing (Normalize-data)store references between two documents to indicate a relationship between the data represented in each document.When:when embedding would result in duplication of data but would not provide sufficient read performance advantages to outweigh the implications of the duplication.to represent more complex many-to-many relationships.to model large hierarchical data sets.Benefits:Separation of ConcernsData model independent of logicDrawback:Referencing provides more flexibility than embedding; however, to resolve the references, client-side applications must issue follow-up queries. In other words, using references requires more roundtrips to the server.&nbsp;Example 3: Books and publisherBooks and publishersdb.books.insert({ &nbsp;_id: 1, &nbsp;name: &quot;MongoDB Applied Design Patterns&quot;, &nbsp;price: 35, &nbsp;rate: 5, &nbsp;author: &quot;Rick Copeland&quot;, &nbsp;ISBN: &quot;1449340040&quot;, &nbsp;publisher_id: 1, &nbsp;reviews: [ &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Dick&quot;, timestamp: &quot;1377742184305&quot; }, &nbsp; &nbsp;{ isUseful: true, content: &quot;Cool book!&quot;, reviewer: &quot;Xiaoshen&quot;, timestamp: &quot;1377742184305&quot; } &nbsp;] &nbsp;});&nbsp;&nbsp;db.publishers.insert({ &nbsp;_id: 1, &nbsp;name: &quot;Packtpub INC&quot;, &nbsp;address: &quot;2nd Floor, Livery Place 35 Livery Street Birmingham&quot;, &nbsp;telephone: &quot;+44 0121 265 6484&quot;, &nbsp;});Advanced FeaturesMultikey-IndexesMongo supports indexing subdocument&#39;s key, consider the above &quot;Books and Publishers&quot; collection, Mongo can index the reviewer key by telling him this:db.books.ensureIndex({&nbsp;&quot;reviews.reviewer&quot;:&nbsp;1&nbsp;})Aggregation frameworkA MongoDB aggregation is a series of special operators applied to a collection. An operator is a JavaScript object with a single property, the operator name, which value is an option object. The core point of aggregation framework is the aggregation pipeline which is a framework for data aggregation modeled on the concept of data processing pipelines.Aggregation was introduced in Mongo version 2.2, below is a table of comparison between Mongo and traditional relational DB from the aspect of aggregation functionalities:SQL Terms, Functions, and ConceptsMongoDB Aggregation OperatorsWHERE$matchGROUP BY$groupHAVING$matchSELECT$projectORDER BY$sortLIMIT$limitSUM()$sumCOUNT()$sumjoinNo direct corresponding operator;&nbsp;however, the&nbsp;$unwind&nbsp;operator allows for somewhat similar functionality, but with fields embedded within the document.For example, still using the above &quot;Books and Publishers&quot; example, image I want to query &quot;a specific reviewer with the book(s) he/she reviewed&quot;, I can do this:&gt; &gt; db.books.aggregate({ $unwind: &quot;$reviews&quot; }, { $match: { &quot;reviews.reviewer&quot;: &quot;Xiaoshen&quot;} }){&nbsp;&quot;result&quot; : [&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&quot;_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;name&quot; : &quot;MongoDB Applied Design Patterns&quot;,&nbsp;&nbsp;&nbsp;&quot;price&quot; : 35,&nbsp;&nbsp;&nbsp;&quot;rate&quot; : 5,&nbsp;&nbsp;&nbsp;&quot;author&quot; : &quot;Rick Copeland&quot;,&nbsp;&nbsp;&nbsp;&quot;ISBN&quot; : &quot;1449340040&quot;,&nbsp;&nbsp;&nbsp;&quot;publisher_id&quot; : 1,&nbsp;&nbsp;&nbsp;&quot;reviews&quot; : {&nbsp;&nbsp;&nbsp;&nbsp;&quot;isUseful&quot; : true,&nbsp;&nbsp;&nbsp;&nbsp;&quot;content&quot; : &quot;Cool book!&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;reviewer&quot; : &quot;Xiaoshen&quot;,&nbsp;&nbsp;&nbsp;&nbsp;&quot;timestamp&quot; : &quot;1377742184305&quot;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}&nbsp;],&nbsp;&quot;ok&quot; : 1}Aggregation introduction: http://docs.mongodb.org/manual/applications/aggregation/One caveat: Aggregation is running upon JavaScript VM, which means - V8 after MongoDB version 2.4, although V8 is deadly fast, it cannot compete with native compiled/optimized C/C++ implementation, refer:http://stackoverflow.com/questions/2599943/mongodbs-performance-on-aggregation-queriesCommon Practices&nbsp;Denormalize data when frequently read together (one-to-one, one-to-many)Normalize data when where are separated queries happened frequently for both entities; or when there are too many data duplicationsReduce collection size by always using short field names as a convention. This will help you save memory over time.Avoid using DBRef!&nbsp;WhyAlways test queries with .explain() to check that you&rsquo;re hitting the right index.Useful resourcesThe ultimate manualhttp://docs.mongodb.org/manual/&nbsp;Greate article explains differences between MongoDB and other famous Relational DBs:http://docs.mongodb.org/manual/reference/sql-comparison/Data Modeling Considerations for MongoDB Applicationshttp://docs.mongodb.org/manual/core/data-modeling/MongoDB-sharding-guide.pdf&nbsp;Serialize Documents with the CSharp Driverhttp://docs.mongodb.org/ecosystem/tutorial/serialize-documents-with-the-csharp-driver/&nbsp;Schema Design --Indexes!!http://www.slideshare.net/jrosoff/mongodb-advanced-schema-design-inboxes&nbsp;Sharding and Mongo DBhttp://docs.mongodb.org/master/MongoDB-sharding-guide.pdfMongoDB Operations Best Practiceshttp://info.10gen.com/rs/10gen/images/10gen-MongoDB_Operations_Best_Practices.pdf&nbsp;Sharding and Replica Sets Illustratedhttp://www.kchodorow.com/blog/2010/08/09/sharding-and-replica-sets-illustrated/">
    <meta itemprop="datePublished" content="August 30, 2013">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">MongoDB Schema Design and Common Practices
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#MongoDB-ExtendedProfile-Installation">Installation</a></li>
  <li><a href="#MongoDB-ExtendedProfile-Terminology">Terminology</a></li>
  <li><a href="#MongoDB-ExtendedProfile-Adminstration">Adminstration</a>
             -  <a href="#">Â </a>
             -  <a href="#MongoDB-ExtendedProfile-BatchadministrationfromJavaScripthttp%3A%2F%2Fdocs.mongodb.org%2Fmanual%2Ftutorial%2Fwrite-scripts-for-the-mongo-shell%2Fhttp%3A%2F%2Fdocs.mongodb.org%2Fmanual%2Fcore%2Fserver-side-javascript%2F%23running-js-scripts-in-mongo-on-mon">Batch administration from JavaScripthttp://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-hosthttp://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/Â http://docs.mongodb.org/manual/reference/method/Â Â (Mongo shell JS references)</a></li>
  <li><a href="#MongoDB-ExtendedProfile-SchemaDesign">Schema Design</a>
             -  <a href="#MongoDB-ExtendedProfile-Embedding%28de-normalizedata%29">Embedding (de-normalize data)</a>
         -  <a href="#">Example 1: Blog with comments</a>
         -  <a href="#">Example 2: Dishes and Cheves</a>
             -  <a href="#MongoDB-ExtendedProfile-Referencing%28Normalize-data%29">Referencing (Normalize-data)</a></li>
  <li><a href="#">Advanced Features</a>
     -  <a href="#">Multikey-Indexes</a>
     -  <a href="#">Aggregation framework</a></li>
  <li><a href="#MongoDB-ExtendedProfile-CommonPractices">Common PracticesÂ </a></li>
  <li><a href="#MongoDB-ExtendedProfile-Usefulresources">Useful resources</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="MongoDB-ExtendedProfile-Installation">Installation</h2>
<p>Exhaustive documentation:&nbsp;<a class="external-link" href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/" rel="nofollow">http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/</a></p>
<p>Mongo executables will be installed into&nbsp;<b>/use/bin/</b>, database files will under&nbsp;<b>/data/db/</b></p>
<p>Log file location:&nbsp;<b>/var/log/mongodb/mongodb.log</b></p>
<p><!--more--></p>
<h2 id="MongoDB-ExtendedProfile-Terminology">Terminology</h2>
<p><b><img class="confluence-embedded-image" alt="" src="https://ejlfia.bn1.livefilestore.com/y2pyy1aQvaVlhOQRU2m_HhWMirImZPQbroZm6R5D5mHIit6JqQQeO2t0NoYMkfgjsyQhFhVxHQQQHuKI14Fg6DHG8F_8tODx8_3VtGFWDWwVC4/Terminology.png?psid=1" /><br /></b></p>
<h2 id="MongoDB-ExtendedProfile-Adminstration">Adminstration</h2>
<div><b><em>sudo service mongodb start/</em><em>stop/restart</em>&nbsp;</b>or simply issue&nbsp;<b><em>mongod&nbsp;</em></b>to start MongoDB process</div>
<div><b><em>mongo&nbsp;</em></b>to enter MongoDB Console</div>
<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #f6f3e8; background-color: #242424;">&gt; show dbs &nbsp;<span style="color: #99968b; font-style: italic;">#Show all databases</span><br />&gt; db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #99968b; font-style: italic;">#Show current db</span><br />&gt; db.help() &nbsp; <span style="color: #99968b; font-style: italic;">#View commands related with db</span><br /><br /><span style="color: #99968b; font-style: italic;"># "Create" a new database named foo_db</span><br />&gt; use foo_db &nbsp;<span style="color: #99968b; font-style: italic;"># Mongo will create this DB virutally, if we save anything into any collections, it will really creates the db.</span><br /><span style="color: #99968b; font-style: italic;"># Create a new document into a collection (implicitly)</span><br />&gt; db.user_profiles.save<span style="color: #f6f3e8;">({</span> first_name: <span style="color: #95e454; font-style: italic;">"Wayne"</span>, last_name: <span style="color: #95e454; font-style: italic;">"Ye"</span> <span style="color: #f6f3e8;">})</span><br /><span style="color: #99968b; font-style: italic;"># Explicitly create a new collection ()</span><br />db.createCollection(<span style="color: #95e454; font-style: italic;">"user_profile"</span>)<br /><span style="color: #99968b; font-style: italic;"># Query the collection</span><br />&gt; db.user_profiles.find()<br /><span style="color: #f6f3e8;">{</span> <span style="color: #95e454; font-style: italic;">"_id"</span> : ObjectId(<span style="color: #95e454; font-style: italic;">"5216fa545b4a83d66587d397"</span>), <span style="color: #95e454; font-style: italic;">"first_name"</span> : <span style="color: #95e454; font-style: italic;">"Wayne"</span>, <span style="color: #95e454; font-style: italic;">"last_name"</span> : <span style="color: #95e454; font-style: italic;">"Ye"</span> <span style="color: #f6f3e8;">}</span><br />&gt; db.user_profiles.save<span style="color: #f6f3e8;">({</span> first_name: <span style="color: #95e454; font-style: italic;">"Wendy"</span>, last_name: <span style="color: #95e454; font-style: italic;">"Shen"</span>, gender: <span style="color: #95e454; font-style: italic;">"Female"</span> <span style="color: #f6f3e8;">})</span><br />&gt; db.user_profiles.find()<br /><span style="color: #99968b; font-style: italic;"># Update</span><br />&gt; db.collection.update( <span style="color: #f6f3e8;">{</span> field: value1 <span style="color: #f6f3e8;">}</span>, <span style="color: #f6f3e8;">{</span> <span style="color: #cae682;">$set</span>: <span style="color: #f6f3e8;">{</span> field1: value2 <span style="color: #f6f3e8;">}</span> <span style="color: #f6f3e8;">}</span> ); <br /><span style="color: #99968b; font-style: italic;"># View status</span><br />&gt; db.stats()<br />&gt; db.mycol.stats()</div>
<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #f6f3e8; background-color: #242424;"><span style="color: #99968b; font-style: italic;"># Query subdocument using <a title="Dot Noation" href="http://docs.mongodb.org/manual/core/document/#dot-notation" target="_blank">Dot Notation</a></span><br />&gt; db.demo.insert({ "Items": [ { "Name": "Milk Powder", "Price": 9.9 }, { "Name": "Toy Car", "Price": 26 } ] })<br />&gt; db.demo.find({ "Items.Price": { $gt: 20 } })<br />{ <span style="color: #95e454; font-style: italic;">"_id"</span> : ObjectId(<span style="color: #95e454; font-style: italic;">"5216fa545b4a83d66587d397"</span>), "Items" : [ &nbsp;{ &nbsp;"Name" : "Milk Powder", &nbsp;"Price" : 9.9 }, &nbsp;{ &nbsp;"Name" : "Toy Car", &nbsp;"Price" : 26 } ] }</div>
<h6>&nbsp;</h6>
<h6 id="MongoDB-ExtendedProfile-BatchadministrationfromJavaScripthttp%3A%2F%2Fdocs.mongodb.org%2Fmanual%2Ftutorial%2Fwrite-scripts-for-the-mongo-shell%2Fhttp%3A%2F%2Fdocs.mongodb.org%2Fmanual%2Fcore%2Fserver-side-javascript%2F%23running-js-scripts-in-mongo-on-mon">Batch administration from JavaScript<br /><a class="external-link" href="http://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/" rel="nofollow">http://docs.mongodb.org/manual/tutorial/write-scripts-for-the-mongo-shell/</a><br /><a class="external-link" href="http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-host" rel="nofollow">http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-host<br /></a><a class="external-link" href="http://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/" rel="nofollow">http://docs.mongodb.org/manual/tutorial/store-javascript-function-on-server/</a><a class="external-link" href="http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-host" rel="nofollow">&nbsp;<br /></a><a class="external-link" href="http://docs.mongodb.org/manual/reference/method/" rel="nofollow">http://docs.mongodb.org/manual/reference/method/</a><a class="external-link" href="http://docs.mongodb.org/manual/core/server-side-javascript/#running-js-scripts-in-mongo-on-mongod-host" rel="nofollow">&nbsp;</a>&nbsp;(Mongo shell JS references)</h6>
<p><em>mongo&nbsp;<a class="external-link" href="http://localhost:27017/mydb" rel="nofollow">localhost:27017/mydb</a>&nbsp;db_schema.js</em></p>
<p><em>Or</em></p>
<p><em><span>load("scripts/myjstest.js") OR&nbsp;load("/data/db/scripts/myjstest.js")</span></em></p>
<h2 id="MongoDB-ExtendedProfile-SchemaDesign"><em>Schema Design</em></h2>
<h6 id="MongoDB-ExtendedProfile-Embedding%28de-normalizedata%29">Embedding (de-normalize data)</h6>
<p>Store two related pieces of data in a single document.</p>
<p>When:</p>
<ul>
<li>There is a "contains" relationship between entities.</li>
<li>There is a "one-to-many" relationship, and the "many" objects always appear inline with the "one".</li>
</ul>
<h5>Example 1: Blog with comments</h5>
<p><b>Denormalized blog with comments</b></p>
<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #f6f3e8; background-color: #242424;"><span style="color: #f6f3e8;">db</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">blogs</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">insert</span><span style="color: #f6f3e8;">({</span><br /> &nbsp;<span style="color: #f6f3e8;">_id</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">1</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">title</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Investigation on MongoDB"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">content</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"some investigation contents"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">post_date</span><span style="color: #f6f3e8;">:</span> <span style="color: #f6f3e8;">Date</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">now</span><span style="color: #f6f3e8;">(),</span><br /> &nbsp;<span style="color: #f6f3e8;">permalink</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"http://foo.bar/investigation_on_mongodb"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">comments</span><span style="color: #f6f3e8;">:</span> <span style="color: #f6f3e8;">[</span><br /> &nbsp; &nbsp;<span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">content</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Gorgeous post!!!"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">nickname</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Scott"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">email</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"foo@bar.org"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">timestamp</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"1377742184305"</span> <span style="color: #f6f3e8;">},</span><br /> &nbsp; &nbsp;<span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">content</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Splendid article!!!"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">nickname</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Guthrie"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">email</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"foo@bar.org"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">timestamp</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"1377742184305"</span> <span style="color: #f6f3e8;">}</span><br /> &nbsp;<span style="color: #f6f3e8;">]}</span><br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</div>
<h5>Example 2: Dishes and Cheves</h5>
<p><b>Normalized Dishes and Cheves</b></p>
<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #f6f3e8; background-color: #242424;"><span style="color: #f6f3e8;">db</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">dishes</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">insert</span><span style="color: #f6f3e8;">({</span><br /> &nbsp;<span style="color: #f6f3e8;">_id</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">1</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">name</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Kong Bao Ji Ding"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">price</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">5.5</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">rate</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">4.5</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">cheves</span><span style="color: #f6f3e8;">:</span> <span style="color: #f6f3e8;">[</span> <span style="color: #95e454; font-style: italic;">"Flora Zhang"</span><span style="color: #f6f3e8;">,</span> <span style="color: #95e454; font-style: italic;">"Cristina Wang"</span> <span style="color: #f6f3e8;">]</span><br /> &nbsp;<span style="color: #f6f3e8;">}</span><br />);<br /> &nbsp;<br /><span style="color: #f6f3e8;">db</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">cheves</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">insert</span><span style="color: #f6f3e8;">({</span><br /> &nbsp;<span style="color: #f6f3e8;">_id</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">1</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">name</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Flora Zhang"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">age</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">32</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">avatar</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"http://www.gravatar.com/avatar.php?gravatar_id=dc654756c7c"</span><span style="color: #f6f3e8;">,</span> <br /> &nbsp;<span style="color: #f6f3e8;">dishes</span><span style="color: #f6f3e8;">:</span> <span style="color: #f6f3e8;">[</span> <span style="color: #95e454; font-style: italic;">"Kong Bao Ji Ding"</span><span style="color: #f6f3e8;">,</span> <span style="color: #95e454; font-style: italic;">"Knight Zhang Beef"</span><span style="color: #f6f3e8;">,</span> <span style="color: #95e454; font-style: italic;">"Ma Po Tou Fu"</span> <span style="color: #f6f3e8;">]</span><br /> &nbsp;<span style="color: #f6f3e8;">}</span><br />);</div>
<p>&nbsp;</p>
<p><b>Benefits</b>:<br />Better performance for read operations<br />Request and retrieve related data in a single database operation.</p>
<h6 id="MongoDB-ExtendedProfile-Referencing%28Normalize-data%29">Referencing (Normalize-data)</h6>
<p>store references between two documents to indicate a relationship between the data represented in each document.</p>
<p>When:</p>
<ul>
<li>when embedding would result in duplication of data but would not provide sufficient read performance advantages to outweigh the implications of the duplication.</li>
<li><span>to represent more complex many-to-many relationships.</span></li>
<li><span>to model large hierarchical data sets.</span></li>
</ul>
<p><span><span><b>Benefits</b>:<br /></span></span></p>
<ul>
<li><span><span>Separation of Concerns</span></span></li>
<li><span><span>Data model independent of logic<br /></span></span><span><br /></span></li>
</ul>
<p><span><b>Drawback</b>:<br />Referencing provides more flexibility than embedding; however, to resolve the references, client-side applications must issue follow-up queries. In other words, using references requires more roundtrips to the server.&nbsp;</span></p>
<p>Example 3: Books and publisher</p>
<p><b>Books and publishers</b></p>
<div class="source" style="font-family: '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; color: #f6f3e8; background-color: #242424;"><span style="color: #f6f3e8;">db</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">books</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">insert</span><span style="color: #f6f3e8;">({</span><br /> &nbsp;<span style="color: #f6f3e8;">_id</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">1</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">name</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"MongoDB Applied Design Patterns"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">price</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">35</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">rate</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">5</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">author</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Rick Copeland"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">ISBN</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"1449340040"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">publisher_id</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">1</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">reviews</span><span style="color: #f6f3e8;">:</span> <span style="color: #f6f3e8;">[</span><br /> &nbsp; &nbsp;<span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">isUseful</span><span style="color: #f6f3e8;">:</span> <span style="color: #8ac6f2;">true</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">content</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Cool book!"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">reviewer</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Dick"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">timestamp</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"1377742184305"</span> <span style="color: #f6f3e8;">},</span><br /> &nbsp; &nbsp;<span style="color: #f6f3e8;">{</span> <span style="color: #f6f3e8;">isUseful</span><span style="color: #f6f3e8;">:</span> <span style="color: #8ac6f2;">true</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">content</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Cool book!"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">reviewer</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Xiaoshen"</span><span style="color: #f6f3e8;">,</span> <span style="color: #f6f3e8;">timestamp</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"1377742184305"</span> <span style="color: #f6f3e8;">}</span><br /> &nbsp;<span style="color: #f6f3e8;">]</span><br /> &nbsp;<span style="color: #f6f3e8;">}</span><br />);<br />&nbsp;&nbsp;<br /><span style="color: #f6f3e8;">db</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">publishers</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">insert</span><span style="color: #f6f3e8;">({</span><br /> &nbsp;<span style="color: #f6f3e8;">_id</span><span style="color: #f6f3e8;">:</span> <span style="color: #e5786d;">1</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">name</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"Packtpub INC"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">address</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"2nd Floor, Livery Place 35 Livery Street Birmingham"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">telephone</span><span style="color: #f6f3e8;">:</span> <span style="color: #95e454; font-style: italic;">"+44 0121 265 6484"</span><span style="color: #f6f3e8;">,</span><br /> &nbsp;<span style="color: #f6f3e8;">}</span><br />);</div>
<h2>Advanced Features</h2>
<h4>Multikey-Indexes</h4>
<p>Mongo supports indexing subdocument's key, consider the above "Books and Publishers" collection, Mongo can index the <i>reviewer</i> key by telling him this:</p>
<div class="source" style="font: 14px/normal '[object HTMLOptionElement]', Consolas, 'Lucida Console', 'Courier New'; text-align: left; color: #f6f3e8; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; font-size-adjust: none; font-stretch: normal; background-color: #242424; -webkit-text-stroke-width: 0px;"><span style="color: #f6f3e8;">db</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">books</span><span style="color: #f6f3e8;">.</span><span style="color: #f6f3e8;">ensureIndex</span><span style="color: #f6f3e8;">({</span><span class="Apple-converted-space">&nbsp;</span><span style="color: #95e454; font-style: italic;">"reviews.reviewer"</span><span style="color: #f6f3e8;">:</span><span class="Apple-converted-space">&nbsp;</span><span style="color: #e5786d;">1</span><span class="Apple-converted-space">&nbsp;</span><span style="color: #f6f3e8;">})</span></div>
<h4>Aggregation framework</h4>
<blockquote>A MongoDB aggregation is a series of special operators applied to a collection. An operator is a JavaScript object with a single property, the operator name, which value is an option object. The core point of aggregation framework is <strong>the aggregation pipeline</strong> which is a framework for data aggregation modeled on the concept of data processing pipelines.</blockquote>
<p>Aggregation was introduced in Mongo version 2.2, below is a table of comparison between Mongo and traditional relational DB from the aspect of aggregation functionalities:</p>
<table style="font: 12px/normal helvetica, arial, sans-serif; border: 0px currentColor; width: 600px; color: #ffffff; text-transform: none; text-indent: 0px; letter-spacing: normal; margin-top: 1.1em; margin-bottom: 1.1em; word-spacing: 0px; white-space: normal; border-collapse: collapse; font-size-adjust: none; font-stretch: normal; background-color: transparent; -webkit-text-stroke-width: 0px;" border="1">
<thead>
<tr class="row-odd"><th class="head" style="border-width: 0px 0px 1px; padding: 5px 8px 5px 5px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><span style="font-size: small;">SQL Terms, Functions, and Concepts</span></th><th class="head" style="border-width: 0px 0px 1px; padding: 5px 8px 5px 5px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><span style="font-size: small;">MongoDB Aggregation Operators</span></th></tr>
</thead>
<tbody>
<tr class="row-even">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">WHERE</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$match" href="http://docs.mongodb.org/manual/reference/aggregation/match/#pipe._S_match"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$match</span></a></td>
</tr>
<tr class="row-odd">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">GROUP BY</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$group" href="http://docs.mongodb.org/manual/reference/aggregation/group/#pipe._S_group"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$group</span></a></td>
</tr>
<tr class="row-even">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">HAVING</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$match" href="http://docs.mongodb.org/manual/reference/aggregation/match/#pipe._S_match"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$match</span></a></td>
</tr>
<tr class="row-odd">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">SELECT</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$project" href="http://docs.mongodb.org/manual/reference/aggregation/project/#pipe._S_project"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$project</span></a></td>
</tr>
<tr class="row-even">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">ORDER BY</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$sort" href="http://docs.mongodb.org/manual/reference/aggregation/sort/#pipe._S_sort"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$sort</span></a></td>
</tr>
<tr class="row-odd">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">LIMIT</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$limit" href="http://docs.mongodb.org/manual/reference/aggregation/limit/#pipe._S_limit"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$limit</span></a></td>
</tr>
<tr class="row-even">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">SUM()</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$sum" href="http://docs.mongodb.org/manual/reference/aggregation/sum/#grp._S_sum"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$sum</span></a></td>
</tr>
<tr class="row-odd">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">COUNT()</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;"><a class="reference internal" style="color: #003594; text-decoration: none;" title="$sum" href="http://docs.mongodb.org/manual/reference/aggregation/sum/#grp._S_sum"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$sum</span></a></td>
</tr>
<tr class="row-even">
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">join</td>
<td style="border-width: 0px 0px 1px; padding: 8px; text-align: left; border-bottom-color: #aaaaaa; border-bottom-style: solid;">No direct corresponding operator;<span class="Apple-converted-space">&nbsp;</span><em>however</em>, the<span class="Apple-converted-space">&nbsp;</span><a class="reference internal" style="color: #003594; text-decoration: none;" title="$unwind" href="http://docs.mongodb.org/manual/reference/aggregation/unwind/#pipe._S_unwind"><span class="pre" style="font-family: 'Courier New', Courier, monospace; font-weight: bold;">$unwind</span></a><span class="Apple-converted-space">&nbsp;</span>operator allows for somewhat similar functionality, but with fields embedded within the document.</td>
</tr>
</tbody>
</table>
<p>For example, still using the above "Books and Publishers" example, image I want to query "<strong>a specific reviewer with the book(s) he/she reviewed</strong>", I can do this:</p>
<p>&gt; &gt; db.books.aggregate({ $unwind: "$reviews" }, { $match: { "reviews.reviewer": "Xiaoshen"} })<br />{<br />&nbsp;"result" : [<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;"_id" : 1,<br />&nbsp;&nbsp;&nbsp;"name" : "MongoDB Applied Design Patterns",<br />&nbsp;&nbsp;&nbsp;"price" : 35,<br />&nbsp;&nbsp;&nbsp;"rate" : 5,<br />&nbsp;&nbsp;&nbsp;"author" : "Rick Copeland",<br />&nbsp;&nbsp;&nbsp;"ISBN" : "1449340040",<br />&nbsp;&nbsp;&nbsp;"publisher_id" : 1,<br />&nbsp;&nbsp;&nbsp;"reviews" : {<br />&nbsp;&nbsp;&nbsp;&nbsp;"isUseful" : true,<br />&nbsp;&nbsp;&nbsp;&nbsp;"content" : "Cool book!",<br />&nbsp;&nbsp;&nbsp;&nbsp;"reviewer" : "Xiaoshen",<br />&nbsp;&nbsp;&nbsp;&nbsp;"timestamp" : "1377742184305"<br />&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br />&nbsp;],<br />&nbsp;"ok" : 1<br />}</p>
<p>Aggregation introduction: <a href="http://docs.mongodb.org/manual/applications/aggregation/">http://docs.mongodb.org/manual/applications/aggregation/</a></p>
<p>One caveat: Aggregation is running upon JavaScript VM, which means - V8 after MongoDB version 2.4, although V8 is deadly fast, it cannot compete with native compiled/optimized C/C++ implementation, refer:<br /><a href="http://stackoverflow.com/questions/2599943/mongodbs-performance-on-aggregation-queries">http://stackoverflow.com/questions/2599943/mongodbs-performance-on-aggregation-queries</a></p>
<h2 id="MongoDB-ExtendedProfile-CommonPractices"><em>Common Practices&nbsp;</em></h2>
<ul>
<li><em>Denormalize data when frequently read together (one-to-one, one-to-many)</em></li>
<li><em>Normalize data when where are separated queries happened frequently for both entities; or when there are too many data duplications</em></li>
<li><em>Reduce collection size by always using short field names as a convention. This will help you save memory over time.</em></li>
<li><em>Avoid using DBRef!&nbsp;<a class="external-link" href="http://stackoverflow.com/questions/9412341/mongodb-is-dbref-neccessary" rel="nofollow">Why</a></em></li>
<li><em>Always test queries with .explain() to check that you&rsquo;re hitting the right index.</em></li>
</ul>
<h2 id="MongoDB-ExtendedProfile-Usefulresources">Useful resources</h2>
<p>The ultimate manual<br /><a class="external-link" href="http://docs.mongodb.org/manual/" rel="nofollow">http://docs.mongodb.org/manual/</a>&nbsp;</p>
<p>Greate article explains differences between MongoDB and other famous Relational DBs:<br /><a class="external-link" href="http://docs.mongodb.org/manual/reference/sql-comparison/" rel="nofollow">http://docs.mongodb.org/manual/reference/sql-comparison/</a></p>
<p>Data Modeling Considerations for MongoDB Applications<br /><a class="external-link" href="http://docs.mongodb.org/manual/core/data-modeling/" rel="nofollow">http://docs.mongodb.org/manual/core/data-modeling/</a><a href="http://wiki.autodesk.com/download/attachments/134319149/MongoDB-sharding-guide.pdf?version=1&amp;modificationDate=1377497767000&amp;api=v2">MongoDB-sharding-guide.pdf</a>&nbsp;</p>
<p>Serialize Documents with the CSharp Driver<br /><a class="external-link" href="http://docs.mongodb.org/ecosystem/tutorial/serialize-documents-with-the-csharp-driver/" rel="nofollow">http://docs.mongodb.org/ecosystem/tutorial/serialize-documents-with-the-csharp-driver/</a>&nbsp;</p>
<p>Schema Design --Indexes!!<br /><a class="external-link" href="http://www.slideshare.net/jrosoff/mongodb-advanced-schema-design-inboxes" rel="nofollow">http://www.slideshare.net/jrosoff/mongodb-advanced-schema-design-inboxes</a>&nbsp;</p>
<p><em>Sharding and Mongo DB<br /><a class="external-link" href="http://docs.mongodb.org/master/MongoDB-sharding-guide.pdf" rel="nofollow">http://docs.mongodb.org/master/MongoDB-sharding-guide.pdf</a></em></p>
<p><em>MongoDB Operations Best Practices<br /><a class="external-link" href="http://info.10gen.com/rs/10gen/images/10gen-MongoDB_Operations_Best_Practices.pdf" rel="nofollow">http://info.10gen.com/rs/10gen/images/10gen-MongoDB_Operations_Best_Practices.pdf</a>&nbsp;</em></p>
<p><em>Sharding and Replica Sets Illustrated<br /><a href="http://www.kchodorow.com/blog/2010/08/09/sharding-and-replica-sets-illustrated/">http://www.kchodorow.com/blog/2010/08/09/sharding-and-replica-sets-illustrated/</a><br /></em></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#hack" class="page__taxonomy-item" rel="tag">Hack</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hack" class="page__taxonomy-item" rel="tag">Hack</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-08-30T00:00:00-07:00">August 30, 2013</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=wayneye&text=MongoDB+Schema+Design+and+Common+Practices%20https%3A%2F%2Fwayneye.com%2FMongoDB_Schema_Design_And_Common_Practices" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwayneye.com%2FMongoDB_Schema_Design_And_Common_Practices" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwayneye.com%2FMongoDB_Schema_Design_And_Common_Practices" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/Brand-New-Life-In-SGP" class="pagination--pager" title="ç‹®åŸŽæ–°ç”Ÿæ´»
">Previous</a>
    
    
      <a href="/Setup_MongoDB_With_Sharding_Infrastructure" class="pagination--pager" title="Setup MongoDB with sharding infrastructure
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Apply-UK-Visit-VISA" rel="permalink">Apply UK Visit VISA
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Background

I was planning to attend #adskfootball2019 in Dublin, Ireland from Jun 14th to Jun 16th, 2019:

    
    Autodesk Football Tournament 2019


In order to attend, I needed applying Ireland VISA, and since I was planning to fly back to Shanghai later in June, so I thought I could just fly from SF to Dublin, then Dublin to Shanghai, and soon I realized that there is no direct flight from DUB to PVG, so a practical (and also very fun and economic) option is to fly from Dublin to London, and then London to Shanghai, bingo ^_^

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Master-AWS-Development-Video-Published" rel="permalink">Master AWS Development Video Published
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Publishing information

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/self-improvement/passing-aws-certified-solutions-architect/" rel="permalink">Passing AWS Certified Solutions Architect
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/geek/Storage-Media-Home-Server-Less-Than-300/" rel="permalink">Storage+Media home server for less than $300
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Background

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto:admin@wayneye.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://wayneye.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://twitter.com/wayneye" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://facebook.com/WayneYeDotCom" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/WayneYe/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Wayne Ye. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>







    
  <script>
    var disqus_config = function () {
      this.page.url = "https://wayneye.com/MongoDB_Schema_Design_And_Common_Practices";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/MongoDB-Schema-Design-and-Common-Practices"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://wayneye.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
